define("block_reportdashboard/reportdashboard",["core/ajax","block_learnerscript/report","block_learnerscript/reportwidget","block_learnerscript/schedule","block_learnerscript/helper","block_learnerscript/ajax","block_learnerscript/select2","block_learnerscript/jquery.dataTables","block_learnerscript/radioslider","block_learnerscript/flatpickr","core/str","jquery","jqueryui","block_learnerscript/bootstrapnotify","block_reportdashboard/inplace_editable"],(function(Ajax,report,reportwidget,schedule,helper,ajax,select2,DataTable,RadiosToSlider,flatpickr,Str,$){return{init:function(){$(document).ajaxStop((function(){$(".loader").fadeOut("slow")})),"All"==$("#compliancedashboardfilter").find(":selected").text()?setTimeout((function(){$(".select2-selection.select2-selection--multiple").append("<span title='All' class='complianceselect' style='padding-left:8px'>All</span>")}),1e3):setTimeout((function(){$(".select2-selection.select2-selection--multiple").append("<span title='Selected'  class='complianceselect' style='padding-left:8px'>Selected</span>")}),1e3),helper.Select2Ajax({}),$(".dashboardcourses").change((function(){var courseid=$(this).val();$(".report_courses").val(courseid),reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text())})),$(".dashboardcompliance").change((function(){if((selected=$(this).val()).includes("0")){var data=$("select.dashboardcompliance option[value='0']").attr("class");if("complianceall"==data){var array=$("select.dashboardcompliance option:selected").map((function(){return $(this).text()})).get().join(",").split(",");for(let i=1;i<selected.length;i++)$(".dashboardcompliance option[value="+selected[i]+"]").remove();var complianceid=$(this).val();for(let i=1;i<selected.length;i++)$(".dashboardcompliance option").eq(selected[i]).before($("<option class='optioncompliance'></option>").val(selected[i]).text(array[i]));$(".complianceselect").text("All");complianceid=0;$("#compliancedashboardfilter option[value='0']").attr("class","selectedcompliance")}else if("selectedcompliance"==data){$(".complianceselect").text("Selected"),$("#compliancedashboardfilter option[value='0']").remove();var selected;complianceid=selected=$(this).val();$(".dashboardcompliance").prepend("<option value='0' class='complianceall'>All</option>")}}else{complianceid=selected;$(".complianceselect").text("Selected")}var costcenterid=$(".dashboardcostcenters").find(":selected").val(),departmentid=$(".dashboarddepartment").find(":selected").val(),subdepartmentid=$(".dashboardsubdepartment").find(":selected").val();if(""==costcenterid||null==costcenterid)costcenterid=$(".report_costcenter").val();if(""==departmentid||null==departmentid)departmentid=$(".report_department").val();if(""==subdepartmentid||null==subdepartmentid)subdepartmentid=$(".report_subdepartment").val();$(".report_compliance").val(complianceid);var params={};params.costcenter=costcenterid,params.department=departmentid,params.subdepartment=subdepartmentid,params.complianceid=JSON.stringify(complianceid),Ajax.call([{methodname:"block_reportdashboard_complianceslist",args:params}])[0].done((function(data){$(".compliancetabs").html(JSON.parse(data.compliancetabs));var cid=$(".compliance").data("complianceid"),params={};params.complianceid=cid,params.costcenter=costcenterid,params.department=departmentid,params.subdepartment=subdepartmentid,Ajax.call([{methodname:"block_reportdashboard_compliancedetails",args:params}])[0].done((function(data){$(".allpercentage").html(data.overallpercentage+"%"),$(".compliancetracking").html(data.tracking),$(".section_content").html(JSON.parse(data.sections)),$("td a").click((function(){var url=$(this).attr("href");event.preventDefault();var reportid=$(this).data("reportid"),instanceid=$(this).data("reportid");require(["block_learnerscript/helper"],(function(helper){helper.ReportModelFromLink({container:$(this),url:url,dashboard:"compliance",tableid:"popupoverlay",reportid:reportid,reporttype:"table",instanceid:instanceid})}))}))})),$(".compliance").click((function(){var complianceid=$(this).data("complianceid"),params={};params.complianceid=complianceid,params.costcenter=costcenterid,params.department=departmentid,params.subdepartment=subdepartmentid,Ajax.call([{methodname:"block_reportdashboard_compliancedetails",args:params}])[0].done((function(data){$(".allpercentage").html(data.overallpercentage+"%"),$(".compliancetracking").html(data.tracking),$(".section_content").html(JSON.parse(data.sections)),$("td a").click((function(){var url=$(this).attr("href");event.preventDefault();var reportid=$(this).data("reportid"),instanceid=$(this).data("reportid");require(["block_learnerscript/helper"],(function(helper){helper.ReportModelFromLink({container:$(this),url:url,dashboard:"compliance",tableid:"popupoverlay",reportid:reportid,reporttype:"table",instanceid:instanceid})}))}))}))}))}))})),$("#ls_onlinecourseid").change((function(){var onlinecourseid=$(this).val();onlinecourseid>0&&($(".report_onlinecourse").val(onlinecourseid),reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$("#ls_labid").change((function(){var labid=$(this).val();$(".report_lab").val(labid),labid>0&&(reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$("#ls_assessmentid").change((function(){var assessmentid=$(this).val();$(".report_assessments").val(assessmentid),assessmentid>0&&(reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$("#ls_webinarid").change((function(){var webinarid=$(this).val();$(".report_webinars").val(webinarid),webinarid>0&&(reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$("#ls_classroomid").change((function(){var classroomid=$(this).val();$(".report_classrooms").val(classroomid),classroomid>0&&(reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$("#ls_learningpathid").change((function(){var learningpathid=$(this).val();$(".report_learningpath").val(learningpathid),learningpathid>0&&(reportwidget.DashboardTiles(),reportwidget.DashboardWidgets(),$(".viewmore").each((function(){$(this).attr("href")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text()))})),$(".dashboardcostcenters").change((function(){var costcenterid=$(this).val();$(".report_costcenter").val(costcenterid),$(".viewmore").each((function(){$(this).attr("href")}));var args={action:"departmentlist"};args.costcenter=costcenterid,senddata=JSON.stringify(args),ajax.call({args:args,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"}).done((function(response){var template="";$.each(response,(function(key,value){template+="<option value = "+key+">"+value+"</option>"})),$("#dashboarddepartment").html(template),$("#dashboarddepartment").val($(" #dashboarddepartment option:eq(0)").val()),$("#dashboarddepartment").trigger("change")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text())})),$(".dashboarddepartment").change((function(){var costcenterid=$(".report_costcenter").val(),departmentid=$(this).val();$(".report_department").val(departmentid),$(".viewmore").each((function(){$(this).attr("href")}));var args={action:"subdepartmentlist"};args.costcenter=costcenterid,args.department=departmentid,senddata=JSON.stringify(args),ajax.call({args:args,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"}).done((function(response){var template="";$.each(response,(function(key,value){template+="<option value = "+key+">"+value+"</option>"})),$("#dashboardsubdepartment").html(template),$("#dashboardsubdepartment").val($(" #dashboardsubdepartment option:eq(0)").val()),$("#dashboardsubdepartment").trigger("change")}))})),$(".dashboardsubdepartment").change((function(){var costcenterid=$(".report_costcenter").val(),departmentid=$(".report_department").val(),subdepartmentid=$(this).val();$(".report_subdepartment").val(subdepartmentid),$(".report_department").val(departmentid),$(".viewmore").each((function(){$(this).attr("href")}));var args={action:"l4departmentlist"};args.costcenter=costcenterid,args.department=departmentid,args.subdepartment=subdepartmentid,senddata=JSON.stringify(args),ajax.call({args:args,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"}).done((function(response){var template="";$.each(response,(function(key,value){template+="<option value = "+key+">"+value+"</option>"})),$("#dashboardl4department").html(template),$("#dashboardl4department").val($("#dashboardl4department option:eq(0)").val()),$("#dashboardl4department").trigger("change")})),$(".breadcrumb-button.pull-xs-right").html($(this).find("option:selected").text())})),$(".dashboardl4department").change((function(){reportwidget.DashboardTiles(),reportwidget.DashboardWidgets()})),$("#createdashbaord_form").submit((function(event){var name=$("#id_dashboard").val().trim();""!=name&&null!=name||($("#id_error_dashboard").css("display","block"),$("#id_error_dashboard_nospaces").css("display","none"),event.preventDefault()),spaceexist=name.indexOf(" "),spaceexist>0&&""!=spaceexist&&($("#id_error_dashboard").css("display","none"),$("#id_error_dashboard_nospaces").css("display","block"),event.preventDefault())})),$.ui.dialog.prototype._focusTabbable=$.noop;var DheaderPosition=$("#dashboard-header").position();$(".sidenav").offset({top:0}),$("#internalbsm").offset({top:DheaderPosition.top}),$("select[data-select2='1']").select2(),helper.Select2Ajax({action:"reportlist",multiple:!0}),$(document).on("click",".filterform #id_filter_clear",(function(e){$(this).parents(".mform").trigger("reset");var activityelement=$(this).parents(".mform").find("#id_filter_activities"),instancelement=$(this).parents(".block_reportdashboard").find(".report_dashboard_container"),reportid=instancelement.data("reportid"),reporttype=instancelement.data("reporttype"),instanceid=instancelement.data("blockinstance");$(this).parents(".mform").find("#id_filter_users");smartfilter.CourseActivities({courseid:0,element:activityelement}),$(".filterform select[data-select2-ajax='1']").val("0").trigger("change"),$(".filterform")[0].reset(),$(".filterform #id_filter_clear").attr("disabled","disabled"),reportwidget.CreateDashboardwidget({reportid:reportid,reporttype:reporttype,instanceid:instanceid})})),$(document).on("change","select[name='filter_coursecategories']",(function(){var categoryid=this.value,courseelement=$(this).closest(".mform").find("#id_filter_courses");0!=courseelement.length&&smartfilter.categoryCourses({categoryid:categoryid,element:courseelement})})),$(document).on("change","select[name='filter_courses']",(function(){var courseid=this.value,activityelement=$(this).closest(".mform").find("#id_filter_activities");$(this).closest(".mform").find("#id_filter_users");0!=activityelement.length&&smartfilter.CourseActivities({courseid:courseid,element:activityelement})})),RadiosToSlider.init($("#segmented-button"),{size:"medium",animation:!0,reportdashboard:!0}),flatpickr("#customrange",{mode:"range",onOpen:function(selectedDates,dateStr,instance){instance.clear()},onClose:function(selectedDates,dateStr,instance){$("#ls_fstartdate").val(selectedDates[0].getTime()/1e3),$("#ls_fenddate").val(selectedDates[1].getTime()/1e3+86400),require(["block_learnerscript/reportwidget"],(function(reportjs){reportwidget.DashboardTiles(),reportwidget.DashboardWidgets()}))}}),window.onclick=function(event){if(!event.target.matches(".dropbtn")){var i,dropdowns=document.getElementsByClassName("dropdown-content");for(i=0;i<dropdowns.length;i++){var openDropdown=dropdowns[i];$(openDropdown).hasClass("show")&&$(openDropdown).toggleClass("show")}}}},addblocks_to_dashboard:function(){Str.get_string("addblockstodashboard","block_reportdashboard").then((function(s){if($(".reportslist").html().length>0)console.log("here"),$(".reportslist").dialog();else{$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);return null===results||" "==results?null:results[1]||0};var role=$.urlParam("role"),dashboardurl=$.urlParam("dashboardurl");Ajax.call([{methodname:"block_reportdashboard_addwidget_to_dashboard",args:{role:role,dashboardurl:dashboardurl}}])[0].done((function(response){var widget_title_img="<img class='dialog_title_icon' alt='Add Widgets' src='"+M.util.image_url("add_widgets_icon","block_reportdashboard")+"'/>";$(".reportslist").dialog({title:"Add widgets to dashboard",modal:!0,minWidth:700,maxHeight:600}),$(".reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>"),$(".reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(widget_title_img+"Add widgets to dashboard"),resp=JSON.parse(response),console.log(resp),$(".reportslist").html(resp)})).fail((function(ex){console.log("Add Tiles")}))}}))},addtiles_to_dashboard:function(){Str.get_string("addtilestodashboard","block_reportdashboard").then((function(s){if($(".statistics_reportslist").html().length>0)$(".statistics_reportslist").dialog();else{$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);return null===results||" "==results?null:results[1]||0};var role=$.urlParam("role"),dashboardurl=$.urlParam("dashboardurl");Ajax.call([{methodname:"block_reportdashboard_addtiles_to_dashboard",args:{role:role,dashboardurl:dashboardurl}}])[0].done((function(response){var tile_title_img="<img class='dialog_title_icon' alt='Add Tiles' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";$(".statistics_reportslist").dialog({title:"Add tiles to dashboard",modal:!0,minWidth:600,maxHeight:600}),$(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>"),$(".statistics_reportslist").closest(".ui-dialog").find(".ui-dialog-title").html(tile_title_img+"Add tiles to dashboard"),resp=JSON.parse(response),$(".statistics_reportslist").html(resp)})).fail((function(ex){console.log("Add Tiles")}))}}))},getcompliance:function(arg){var costcenterid=$(".report_costcenter").val(),departmentid=$(".report_department").val(),subdepartmentid=$(".report_subdepartment").find(":selected").val(),params={};params.complianceid=arg,params.costcenter=costcenterid,params.department=departmentid,params.subdepartment=subdepartmentid,Ajax.call([{methodname:"block_reportdashboard_compliancedetails",args:params}])[0].done((function(data){$(".allpercentage").html(data.overallpercentage+"%"),$(".compliancetracking").html(data.tracking),$(".section_content").html(JSON.parse(data.sections)),$("td a").click((function(){var url=$(this).attr("href");event.preventDefault();var reportid=$(this).data("reportid"),instanceid=$(this).data("reportid");require(["block_learnerscript/helper"],(function(helper){helper.ReportModelFromLink({container:$(this),url:url,dashboard:"compliance",tableid:"popupoverlay",reportid:reportid,reporttype:"table",instanceid:instanceid})}))}))}))},addnewdashboard:function(){Str.get_string("addnewdashboard","block_reportdashboard").then((function(s){document.getElementById("id_dashboard").value="",$("#id_error_dashboard").css("display","none");var tile_title_img="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";$(".newreport_dashboard").dialog({title:s,modal:!0,minWidth:450,maxHeight:600}),$(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(tile_title_img+s)}))},updatedashboard:function(oldname,role){Str.get_string("updatedashboard","block_reportdashboard").then((function(s){$("#id_error_dashboard").css("display","none"),$("#id_error_dashboard_nospaces").css("display","none");var tile_title_img="<img class='dialog_title_icon' alt='Add new dashboard' src='"+M.util.image_url("add_tiles_icon","block_reportdashboard")+"'/>";$(".newreport_dashboard").dialog({title:s,modal:!0,minWidth:450,maxHeight:600}),$(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(".newreport_dashboard").closest(".ui-dialog").find(".ui-dialog-title").html(tile_title_img+s),document.getElementById("id_dashboard").value=oldname,$("#createdashbaord_form").submit((function(event){var name=$("#id_dashboard").val().trim();if(""==name||null==name)return $("#id_error_dashboard").css("display","block"),$("#id_error_dashboard_nospaces").css("display","none"),event.preventDefault(),!1;if(spaceexist=name.indexOf(" "),spaceexist>0&&""!=spaceexist)return $("#id_error_dashboard").css("display","none"),$("#id_error_dashboard_nospaces").css("display","block"),event.preventDefault(),!1;var args={action:"updatedashboard"};args.role=role,args.oldname=oldname,args.newname=document.getElementById("id_dashboard").value,senddata=JSON.stringify(args);ajax.call({args:args,url:M.cfg.wwwroot+"/blocks/reportdashboard/ajax.php"})}))}))},sendreportemail:function(args){Str.get_strings([{key:"sendemail",component:"block_reportdashboard"}]).then((function(s){var url=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";args.nodeContent="sendreportemail"+args.instanceid,args.action="sendreportemail",args.title=s,AjaxForms=require("block_learnerscript/ajaxforms"),AjaxForms.init(args,url)}))},reportfilter:function(args){var self=this;$(".report_filter_"+args.instanceid).length<1?Ajax.call([{methodname:"block_learnerscript_reportfilter",args:{action:"reportfilter",reportid:args.reportid,instance:args.instanceid}}])[0].done((function(resp){$("body").append("<div class='report_filter_"+args.instanceid+"' style='display:none;'>"+resp+"</div>"),$("select[data-action='tagfilters']").select2(),$("select[data-select2-ajax='1']").each((function(){$(this).hasClass("select2-hidden-accessible")||helper.Select2Ajax({})})),self.reportFilterFormModal(args),$(".filterform"+args.instanceid+" .fitemtitle").hide(),$(".filterform"+args.instanceid+" .felement").attr("style","margin:0")})):self.reportFilterFormModal(args)},reportFilterFormModal:function(args){Str.get_string("reportfilters","block_reportdashboard").then((function(s){var title_img="<img class='dialog_title_icon' alt='Filter' src='"+M.util.image_url("reportfilter","block_reportdashboard")+"'/>";$(".report_filter_"+args.instanceid).dialog({title:s,dialogClass:"reportfilter-popup",modal:!0,resizable:!0,autoOpen:!0,draggable:!1,width:517,height:"auto",appendTo:"#inst"+args.instanceid,position:{my:"center",at:"center",of:"#inst"+args.instanceid,within:"#inst"+args.instanceid},open:function(event,ui){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(this).closest(".ui-dialog").find(".ui-dialog-title").html(title_img+s),$(".report_filter_"+args.instanceid+" form  #id_filter_apply").click((function(e){e.preventDefault(),e.stopImmediatePropagation(),$("#reportcontainer"+args.instanceid).html().length>0?args.reporttype=$("#reportcontainer"+args.instanceid).data("reporttype"):args.reporttype=$("#plotreportcontainer"+args.instanceid).data("reporttype");$(".filterform"+args.instanceid).serializeArray();args.container="#reporttype_"+args.reportid,require(["block_learnerscript/reportwidget"],(function(reportwidget){reportwidget.CreateDashboardwidget({reportid:args.reportid,reporttype:args.reporttype,instanceid:args.instanceid}),$(".report_filter_"+args.instanceid).dialog("close")})),$(".report_filter_"+args.instanceid+" form #id_filter_clear").removeAttr("disabled")}))}}),$(".report_filter_"+args.instanceid+" form #id_filter_clear").click((function(e){e.preventDefault(),$(".filterform"+args.reportid).trigger("reset"),require(["block_learnerscript/reportwidget"],(function(reportwidget){reportwidget.DashboardWidgets(args),$(".report_filter_"+args.instanceid).dialog("close")})),$(".report_filter_"+args.instanceid).dialog("close")}))}))},DeleteWidget:function(args){Str.get_string("deletewidget","block_reportdashboard").then((function(s){$("#delete_dialog"+args.instanceid).dialog({resizable:!0,autoOpen:!0,width:460,height:210,title:s,modal:!0,appendTo:"#inst"+args.instanceid,position:{my:"center",at:"center",of:"#inst"+args.instanceid,within:"#inst"+args.instanceid},open:function(event,ui){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"})}})}))},Deletedashboard:function(args){Str.get_string("deletedashboard","block_reportdashboard").then((function(s){args.instance;$("#dashboard_delete_popup_"+args.random).dialog({resizable:!1,height:150,width:375,modal:!0,title:s,open:function(event){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"})},close:function(event,ui){$(this).dialog("destroy").hide()}})}))},schreportform:function(args){Str.get_string("schedulereport","block_reportdashboard").then((function(s){var url=M.cfg.wwwroot+"/blocks/learnerscript/ajax.php";args.title=s,args.nodeContent="schreportform"+args.instanceid,args.action="schreportform",AjaxForms=require("block_learnerscript/ajaxforms"),AjaxForms.init(args,url)}))}}}));

//# sourceMappingURL=reportdashboard.min.js.map