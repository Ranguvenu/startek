{"version":3,"file":"userdashboard.min.js","sources":["../src/userdashboard.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle selection changes and actions on the competency tree.\n *\n * @module     block_userdasboard/navigations\n * @package    block_userdasboard\n * @copyright  2018 hemalathacarun <hemalatha@eabyas.in>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/url',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/ajax',\n        'local_costcenter/cardPaginate',\n        'local_courses/jquery.dataTables'\n    ],\n    function($,url, Templates, notification, str, Ajax, cardPaginate, dataTable) {\n        var userdashboard = function(method, enabled_tab, thisdata){\n            var params = {};\n            // params.status = thisdata.status;\n            // params.searchterm = thisdata.filter_text;\n            // params.page = 0;//thisdata.page;\n            // params.perpage = 10;//thisdata.perpage;\n            params.filter = thisdata.status;\n            params.filter_text = thisdata.filter_text;\n            params.filter_offset = 0;\n            params.filter_limit = 10;\n            // console.log('<img src=\"'+M.cfg.wwwroot+'/local/ajax-loader.svg\">');\n            thisdata['container'].removeClass('justify-content-end');\n            thisdata['container'].addClass('justify-content-center d-flex align-items-center');\n            thisdata['container'].html('<img class=\"loading_img\" src=\"'+M.cfg.wwwroot+'/local/ajax-loader.svg\">');\n            var promise = Ajax.call ([{\n                methodname : method,\n                args : params\n            }]);\n\n            promise[0].done(function(resp){\n                var data_display_type = $('#card_list_view').data('displaytype');\n                if(data_display_type == 'card'){\n                    resp.card_view = 1;\n                }else if(data_display_type == 'table'){\n                    resp.list_view = 1;\n                }else{\n                    resp.card_view = 1;\n                }\n\n\n                Templates.render(thisdata.templatename, resp).then(function(html, js) {\n                    // console.log(html);\n                    // console.log(thisdata['container']);\n                    // Templates.replaceNodeContents(thisdata['container'], html, js);\n                    thisdata['container'].html(html);\n                    thisdata['container'].removeClass('justify-content-center d-flex align-items-center');\n                    thisdata['container'].addClass('justify-content-end');\n                }).done(function() {\n                    if(resp.list_view == 1){\n                        $('.userdashboard_filter_container').hide();\n                        $.fn.dataTable.ext.errMode = 'none';\n                        $('#userdashboard_table_content').dataTable({\n                            pageLength:2,\n                            ordering: false\n                        });\n                    }else{\n                        $('.userdashboard_filter_container').show();\n                    }\n                    \n                });\n\n                \n            });\n\n        };\n        return {        \n     \n        /**\n         * Initialise this page (attach event handlers etc).\n         *\n         * @method init\n         * @param {Object} model The tree model provides some useful functions for loading and searching competencies.\n         * @param {Number} pagectxid The page context ID.\n         * @param {Object} taxonomies Constants indexed by level.\n         * @param {Object} rulesMods The modules of the rules.\n         */\n        init: function() {\n\n            // var methods = {};\n            var container = $('.userdashboard_module_content');\n\n            // methods.local_courses = 'local_courses_userdashboard_content';\n            // methods.local_classroom = 'local_classroom_userdashboard_classrooms';\n            // methods.local_certification = 'local_certification_userdashboard_certification';\n            // methods.local_program = 'local_program_userdashboard_program';\n            // methods.local_learningplan = 'local_learningplan_userdashboard_learningplans';\n            // methods.local_evaluation = 'local_evaluation_userdashboard_evaluations';\n            // methods.local_onlinetests = 'local_onlinetests_userdashboard_onlinetests';\n\n            \n            \n            $(document).on('click', '.userdashboard_menu_link', function(){\n                var active = $(this).parent('.dashboard-stat').hasClass('active_main_tab');\n                // console.log(active);\n                if(!active){\n                    $('.dashboard-stat').removeClass('active_main_tab');\n                    $(this).parent('.dashboard-stat').addClass('active_main_tab');\n                    var filter_text = $('#userdashboard_filter').val();\n                    if(filter_text == undefined){\n                        filter_text = '';\n                    }\n                    var data = $(this).data();\n                    data.container = container;\n                    data.filter_text = filter_text;\n                    var pluginname = data.pluginname;\n                    var enabled_tab = data.tabname;\n                    var method = pluginname+'_userdashboard_content';\n                    return new userdashboard(method, enabled_tab, data);\n                }\n            });\n\n            $(document).on('click', '.userdashboard_tab_link', function(){\n                var filter_text = $('#userdashboard_filter').val();\n                if(filter_text == undefined){\n                    filter_text = '';\n                }\n                var data = $(this).data();\n                data.container = container.find('.divslide');\n                data.filter_text = filter_text;\n                var pluginname = data.pluginname;\n                var enabled_tab = data.tabname;\n                $(\"#userdashboard_filter\").data('filter', enabled_tab);\n                $(\"#userdashboard_filter\").data('status', enabled_tab);\n                console.log($(\"#userdashboard_filter\").data('filter'));\n                var method = pluginname+'_userdashboard_content';\n                return new userdashboard(method, enabled_tab, data);\n            });\n            $(document).on('keyup', '#userdashboard_filter', function(){\n                var filter_text = $(this).val();\n                var data = $(this).data();\n                // console.log(filter_text);\n                console.log(data);\n                \n                data.container = container.find('.divslide');\n                data.filter_text = filter_text;\n                var pluginname = data.pluginname;\n                var enabled_tab = data.tabname;\n                var method = pluginname+'_userdashboard_content';\n                return new userdashboard(method, enabled_tab, data);\n            });\n            $(document).on('click', '#card_list_view', function(){\n                var display_type = $(this).data('displaytype');\n                if(display_type == 'card'){\n                    $(this).data('displaytype','table');\n                    $(this).find('i').removeClass('fa-bars').addClass('fa-th');\n                    $(this).find('span').html('Card');\n                }else if(display_type == 'table'){\n                    $(this).data('displaytype','card');\n                    $(this).find('i').removeClass('fa-th').addClass('fa-bars');\n                    $(this).find('span').html('List');\n                }\n                var element = $('.userdashboard_module_content .userdashboard_tab_link.active');\n                var filter_text = $('#userdashboard_filter').val();\n                if(filter_text == undefined){\n                    filter_text = '';\n                }\n                var data = element.data();\n                console.log(element);\n                data.container = container.find('.divslide');\n                data.filter_text = filter_text;\n                var pluginname = data.pluginname;\n                var enabled_tab = data.tabname;\n                $(\"#userdashboard_filter\").data('filter', enabled_tab);\n                $(\"#userdashboard_filter\").data('status', enabled_tab);\n                // console.log($(\"#userdashboard_filter\").data('filter'));\n                var method = pluginname+'_userdashboard_content';\n                return new userdashboard(method, enabled_tab, data);\n            });\n            $(document).on('click', '#card_list_view_detailed', function(){\n                var display_type = $(this).data('displaytype');\n                if(display_type == 'card'){\n                    var newtype = 'table';\n                }else if(display_type == 'table'){\n                    var newtype = 'card';\n                }\n                var url = new URL(window.location.href);\n                url.searchParams.set(\"formattype\", newtype);\n                window.location.href = url.href;\n            });\n            $(document).ready(function(){\n                var elem = $('.active_main_tab').find('a');\n                var data = elem.data();\n                data.container = container;\n                data.filter_text = '';\n                var pluginname = data.pluginname;\n                var enabled_tab = data.tabname;\n                var method = pluginname+'_userdashboard_content';\n                return new userdashboard(method, enabled_tab, data);\n            });\n\n        },\n        makeActive: function(identifier){\n            $(document).ready(function(){\n                if(!$(\"#\"+identifier).hasClass('active')){\n                    $(\"li.nav-item .nav-link.active\").removeClass('active');\n                    $(\"#\"+identifier).addClass('active');\n                }\n            });\n        },\n        load: function(){\n            $(document).on('click', '.userdashboard_tab_link', function(){\n                var data = $(this).data();\n                var url = window.location.href;\n                var position = url.indexOf(\"?tab\");\n                var newurl = url.substr(0,url.indexOf(\"?tab\"))+'?tab='+data.tabname;\n                history.pushState('', '', newurl);\n                var pluginname = data.pluginname;\n                var targetid = pluginname.replace(\"local\", 'dashboard');\n                var content  = \"<div data-region='\"+targetid+\"-count-container'></div><div data-region='\"+targetid+\"-list-container' id ='\"+targetid+\"id'></div><span class='overlay-icon-container hidden' data-region='overlay-icon-container'><span class='loading-icon icon-no-margin'></span></span>\";\n                var paginatedata = $('.userdashboard_content_detailed').data();\n                var options = JSON.parse(JSON.parse(paginatedata.options));\n                var dataoptions = JSON.parse(JSON.parse(paginatedata.dataoptions));\n                var filterdata = JSON.parse(JSON.parse(paginatedata.filterdata));\n                options.filter = data.tabname;\n                var newoptions = options;\n                $(\"#global_filter\").val('');\n                $(\"#global_filter\").data('options', newoptions);\n                $('#'+targetid).html(content);\n                cardPaginate.reload(newoptions, dataoptions, filterdata);\n            });\n        }\n    }; \n});\n"],"names":["define","$","url","Templates","notification","str","Ajax","cardPaginate","dataTable","userdashboard","method","enabled_tab","thisdata","params","filter","status","filter_text","filter_offset","filter_limit","removeClass","addClass","html","M","cfg","wwwroot","call","methodname","args","done","resp","data_display_type","data","card_view","list_view","render","templatename","then","js","hide","fn","ext","errMode","pageLength","ordering","show","init","container","document","on","this","parent","hasClass","val","undefined","pluginname","tabname","find","console","log","display_type","element","newtype","URL","window","location","href","searchParams","set","ready","makeActive","identifier","load","newurl","indexOf","substr","history","pushState","targetid","replace","content","paginatedata","options","JSON","parse","dataoptions","filterdata","newoptions","reload"],"mappings":"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"}