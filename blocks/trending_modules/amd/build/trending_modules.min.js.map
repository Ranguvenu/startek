{"version":3,"file":"trending_modules.min.js","sources":["../src/trending_modules.js"],"sourcesContent":["/**\n *\n * @module     block_trending_modules/trending_modules\n * @class      trending_modules\n * @package    block_trending_modules\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/fragment', 'core/str', 'core/modal_factory', 'core/modal_events', 'local_costcenter/cardPaginate'], \n        function ($, Ajax, Templates, Fragment, Str, ModalFactory, ModalEvents, cardPaginate){\n\treturn trending_module = {\n\t\tinit: function(){\n\t\t\tvar search_interval = 200;\n        \t$(document).on('keyup', '#filter_trending_modules', function(){\n        \t\tvar searchvalue = $(this).val();\n                var data = $(this).data();\n                var target = data.target;\n                var navigatorElm = data.navigator; \n                var jsondata = JSON.stringify(data);\n            \tsetTimeout(function(){\n            \t\tvar params = {};\n            \t\tparams.indexid = 0;\n        \t\t\tparams.contextid = 1;\n            \t\tparams.search = searchvalue;\n            \t\tparams.jsondata = jsondata;\n\n            \t\tvar promise = Ajax.call([{\n                        methodname: 'block_trending_modules_display_content',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                    \tvar data = {};\n                    \tdata.records = resp.records; \n                    \tTemplates.render('block_trending_modules/trending_module', data).then(function(html,js) {\n                    \t\t$(target).html(html);\n                            $(navigatorElm).data('totalcount', resp.totalcount);\n                    \t});\n                    });\n            \t}, search_interval);\n\t\t\t});\n            $(document).on('click', '.block_trending_modules_navigator', function(){\n                var data = $(this).data();\n                if(data.action == 'right'){\n                    var new_offset = data.offset + 3;\n                }else if(data.action == 'left'){\n                    var new_offset = data.offset - 3;\n                }else{\n                    return;\n                }\n                $('.block_trending_modules_navigator').data('offset', new_offset);\n                // $('.block_trending_modules_navigator').attr('data-offset', new_offset);\n                if(new_offset+data.limit >= data.totalcount){\n                    $('.block_trending_modules_navigator.right_navigator').addClass('hidden');\n                }else if(data.totalcount > 3){\n                    $('.block_trending_modules_navigator.right_navigator').removeClass('hidden');\n                }\n                if(new_offset == 0){\n                    $('.block_trending_modules_navigator.left_navigator').addClass('hidden');\n                }else{\n                    $('.block_trending_modules_navigator.left_navigator').removeClass('hidden');\n                }\n\n                var params = {};\n                params.indexid = new_offset;\n                params.limitnum = 3;\n                params.contextid = 1;\n                params.search = '';\n                \n                var promise = Ajax.call([{\n                    methodname: 'block_trending_modules_display_content',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    // console.log(resp);\n                    var data = {};\n                    data.records = resp.records; \n                    Templates.render('block_trending_modules/trending_module', data).then(function(html,js) {\n                        $('#trending_modules_content').html(html);\n                    });\n                });\n            });\n            $(document).on('click', '.block_suggested_modules_navigator', function(){\n                var data = $(this).data();\n                var jsondata = JSON.stringify(data);\n                if(data.action == 'right'){\n                    var new_offset = data.offset + 3;\n                }else if(data.action == 'left'){\n                    var new_offset = data.offset - 3;\n                }else{\n                    return;\n                }\n                $('.block_suggested_modules_navigator').data('offset', new_offset);\n                // $('.block_trending_modules_navigator').attr('data-offset', new_offset);\n                if(new_offset+data.limit >= data.totalcount){\n                    $('.block_suggested_modules_navigator.right_navigator').addClass('hidden');\n                }else if(data.totalcount > 3){\n                    $('.block_suggested_modules_navigator.right_navigator').removeClass('hidden');\n                }\n                if(new_offset == 0){\n                    $('.block_suggested_modules_navigator.left_navigator').addClass('hidden');\n                }else{\n                    $('.block_suggested_modules_navigator.left_navigator').removeClass('hidden');\n                }\n\n                var params = {};\n                params.indexid = new_offset;\n                params.limitnum = 3;\n                params.contextid = 1;\n                params.search = '';\n                params.jsondata = jsondata;\n                \n                var promise = Ajax.call([{\n                    methodname: 'block_trending_modules_display_content',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    // console.log(resp);\n                    var data = {};\n                    data.records = resp.records; \n                    Templates.render('block_trending_modules/trending_module', data).then(function(html,js) {\n                        $('#suggested_modules_content').html(html);\n                    });\n                });\n            });\n\t\t\t\n\t\t},\n        display_popup :function(){\n            // var dontshowelement = \"<div class='trending-checkbox w-full d-inline-block text-right'><label class='trend-checkbox-label d-inline-block pull-left mr-1'><input type='checkbox' class = 'update_trending_preference' id = 'force_stop_populating_modules'/><span class='trend-checkbox-custom trend-rectangular'></span></label><div class='pull-left'>Don\\'t show this</div></div>\";\n            Fragment.loadFragment('block_trending_modules', 'get_trending_popup', 1, {}).done(function(html, js){\n                return Str.get_string('pluginname','block_trending_modules').then(function(s) {\n                    ModalFactory.create({\n                        title: s,\n                        type: ModalFactory.types.DEFAULT,\n                        body : html,\n                        // footer : dontshowelement\n                    }).done(function(modal) {\n                        this.modal = modal;\n                        this.modal.setLarge();\n                        this.modal.getRoot().addClass('trending_modal_popup');\n                        this.modal.getRoot().on(ModalEvents.hidden, function() {\n                            var statuschange = $(\".update_trending_preference\").is(':checked');\n                            if(statuschange){\n                                params = {};\n                                params.contextid = 1;\n                                params.status = !statuschange;\n                                var promise = Ajax.call([{\n                                    methodname: 'block_trending_modules_alter_popup_status',\n                                    args: params\n                                }]);\n                                promise[0].done(function(resp) {\n                                    $('.update_trending_preference').prop('checked', true);\n                                }).fail(function(ex) {\n                                     console.log(ex);\n                                });\n                            }\n                        });\n                        // modal.setSaveButtonText(s[3]);\n                        // modal.getRoot().on(ModalEvents.save, function(e) {\n                        //     e.preventDefault();\n                        //     args.confirm = true;\n                        //     var params = {};\n                        //     params.id = args.id;\n                        //     params.contextid = args.contextid;\n                        \n                        //     var promise = Ajax.call([{\n                        //         methodname: 'local_users_suspend_user',\n                        //         args: params\n                        //     }]);\n                        //     promise[0].done(function(resp) {\n                        //         window.location.href = window.location.href;\n                        //     }).fail(function(ex) {\n                        //         // do something with the exception\n                        //          console.log(ex);\n                        //     });\n                        // }.bind(this));\n                        modal.show();\n                    }.bind(this));\n                }.bind(this));\n            });\n        \n        },\n        update_preference : function(){\n            $(document).on('click', '.update_trending_preference', function(){\n                var status = $(this).prop('checked');\n                params = {};\n                params.contextid = 1;\n                params.status = !status;\n                var promise = Ajax.call([{\n                    methodname: 'block_trending_modules_alter_popup_status',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n\n                }).fail(function(ex) {\n                    console.log(ex);\n                });\n\n            });\n        },\n        load: function(){\n            var identifier = 'show_suggested_modules_content';\n            var options = {\n                targetID : identifier,\n                perPage : 3,\n                cardClass : 'col-md-4 col-4',\n                viewType : 'card',\n                methodName : 'block_trending_modules_display_paginated',\n                templateName : 'block_trending_modules/trending_module_paginated'\n            };\n            var dataoptions = {};\n            $(document).on('click', '.show_suggested_modules', function(){\n                var data = $(this).data();\n                var contenthtml = '<label>Search : </label><input type=\"text\" name=\"search\" id=\"search_popup_content\" data-module_type='+data.moduletype+' data-module_tags='+data.tags+'><div class=\"d-inline-blocks card-paginate_wrap\" id=\"'+identifier+'\" data-region=\"'+identifier+'-preview-container\"><div data-region=\"'+identifier+'-count-container\"></div><div data-region=\"'+identifier+'-list-container\" id =\"'+identifier+'id\"></div></div>';\n                var filterdata = {\n                    module_type : data.moduletype,\n                    module_tags : data.tags,\n                    show_suggestions : data.show_suggestions\n                };\n\n                Str.get_string('suggested_modules','block_trending_modules').then(function(header) {\n                    ModalFactory.create({\n                        title: header,\n                        type: ModalFactory.types.DEFAULT,\n                        body : contenthtml,\n                    }).done(function(modal) {\n                        this.modal = modal;\n                        this.modal.setLarge();\n                        modal.show();\n                        this.modal.getRoot().addClass('suggested_modules');\n                        cardPaginate.reload(options, dataoptions,filterdata);\n                        this.modal.getRoot().on(ModalEvents.hidden, function() {\n                            modal.destroy();\n                        });\n                    }.bind(this));\n                }.bind(this));\n            });\n            var timer;\n            $(document).on('keyup', '#search_popup_content', function(){\n                clearTimeout(timer);\n                var search = $(this).val();\n                var data = $(this).data();\n                timer = setTimeout(function(){\n                    var filterdata = {\n                        module_type : data.module_type,\n                        module_tags : data.module_tags,\n                        show_suggestions : data.show_suggestions,\n                        search_query : search\n                    };\n                    cardPaginate.reload(options, dataoptions, filterdata);\n                }, 100);\n            });\n            $(document).on('keydown', '#search_popup_content', function(){\n                clearTimeout(timer);\n            });\n        }         \t\t\n   };\n\n});"],"names":["define","$","Ajax","Templates","Fragment","Str","ModalFactory","ModalEvents","cardPaginate","trending_module","init","document","on","searchvalue","this","val","data","target","navigatorElm","navigator","jsondata","JSON","stringify","setTimeout","params","search","call","methodname","args","done","resp","records","render","then","html","js","totalcount","action","new_offset","offset","limit","addClass","removeClass","indexid","limitnum","contextid","display_popup","loadFragment","get_string","s","create","title","type","types","DEFAULT","body","modal","setLarge","getRoot","hidden","statuschange","is","status","prop","fail","ex","console","log","show","bind","update_preference","load","timer","identifier","options","targetID","perPage","cardClass","viewType","methodName","templateName","dataoptions","contenthtml","moduletype","tags","filterdata","module_type","module_tags","show_suggestions","header","reload","destroy","clearTimeout","search_query"],"mappings":"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"}