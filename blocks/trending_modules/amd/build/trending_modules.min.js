/**
 *
 * @module     block_trending_modules/trending_modules
 * @class      trending_modules
 * @package    block_trending_modules
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_trending_modules/trending_modules",["jquery","core/ajax","core/templates","core/fragment","core/str","core/modal_factory","core/modal_events","local_costcenter/cardPaginate"],(function($,Ajax,Templates,Fragment,Str,ModalFactory,ModalEvents,cardPaginate){return trending_module={init:function(){$(document).on("keyup","#filter_trending_modules",(function(){var searchvalue=$(this).val(),data=$(this).data(),target=data.target,navigatorElm=data.navigator,jsondata=JSON.stringify(data);setTimeout((function(){var params={indexid:0,contextid:1};params.search=searchvalue,params.jsondata=jsondata,Ajax.call([{methodname:"block_trending_modules_display_content",args:params}])[0].done((function(resp){var data={};data.records=resp.records,Templates.render("block_trending_modules/trending_module",data).then((function(html,js){$(target).html(html),$(navigatorElm).data("totalcount",resp.totalcount)}))}))}),200)})),$(document).on("click",".block_trending_modules_navigator",(function(){var data=$(this).data();if("right"==data.action)var new_offset=data.offset+3;else{if("left"!=data.action)return;new_offset=data.offset-3}$(".block_trending_modules_navigator").data("offset",new_offset),new_offset+data.limit>=data.totalcount?$(".block_trending_modules_navigator.right_navigator").addClass("hidden"):data.totalcount>3&&$(".block_trending_modules_navigator.right_navigator").removeClass("hidden"),0==new_offset?$(".block_trending_modules_navigator.left_navigator").addClass("hidden"):$(".block_trending_modules_navigator.left_navigator").removeClass("hidden");var params={};params.indexid=new_offset,params.limitnum=3,params.contextid=1,params.search="",Ajax.call([{methodname:"block_trending_modules_display_content",args:params}])[0].done((function(resp){var data={};data.records=resp.records,Templates.render("block_trending_modules/trending_module",data).then((function(html,js){$("#trending_modules_content").html(html)}))}))})),$(document).on("click",".block_suggested_modules_navigator",(function(){var data=$(this).data(),jsondata=JSON.stringify(data);if("right"==data.action)var new_offset=data.offset+3;else{if("left"!=data.action)return;new_offset=data.offset-3}$(".block_suggested_modules_navigator").data("offset",new_offset),new_offset+data.limit>=data.totalcount?$(".block_suggested_modules_navigator.right_navigator").addClass("hidden"):data.totalcount>3&&$(".block_suggested_modules_navigator.right_navigator").removeClass("hidden"),0==new_offset?$(".block_suggested_modules_navigator.left_navigator").addClass("hidden"):$(".block_suggested_modules_navigator.left_navigator").removeClass("hidden");var params={};params.indexid=new_offset,params.limitnum=3,params.contextid=1,params.search="",params.jsondata=jsondata,Ajax.call([{methodname:"block_trending_modules_display_content",args:params}])[0].done((function(resp){var data={};data.records=resp.records,Templates.render("block_trending_modules/trending_module",data).then((function(html,js){$("#suggested_modules_content").html(html)}))}))}))},display_popup:function(){Fragment.loadFragment("block_trending_modules","get_trending_popup",1,{}).done((function(html,js){return Str.get_string("pluginname","block_trending_modules").then(function(s){ModalFactory.create({title:s,type:ModalFactory.types.DEFAULT,body:html}).done(function(modal){this.modal=modal,this.modal.setLarge(),this.modal.getRoot().addClass("trending_modal_popup"),this.modal.getRoot().on(ModalEvents.hidden,(function(){var statuschange=$(".update_trending_preference").is(":checked");statuschange&&(params={},params.contextid=1,params.status=!statuschange,Ajax.call([{methodname:"block_trending_modules_alter_popup_status",args:params}])[0].done((function(resp){$(".update_trending_preference").prop("checked",!0)})).fail((function(ex){console.log(ex)})))})),modal.show()}.bind(this))}.bind(this))}))},update_preference:function(){$(document).on("click",".update_trending_preference",(function(){var status=$(this).prop("checked");params={},params.contextid=1,params.status=!status,Ajax.call([{methodname:"block_trending_modules_alter_popup_status",args:params}])[0].done((function(resp){})).fail((function(ex){console.log(ex)}))}))},load:function(){var timer,identifier="show_suggested_modules_content",options={targetID:identifier,perPage:3,cardClass:"col-md-4 col-4",viewType:"card",methodName:"block_trending_modules_display_paginated",templateName:"block_trending_modules/trending_module_paginated"},dataoptions={};$(document).on("click",".show_suggested_modules",(function(){var data=$(this).data(),contenthtml='<label>Search : </label><input type="text" name="search" id="search_popup_content" data-module_type='+data.moduletype+" data-module_tags="+data.tags+'><div class="d-inline-blocks card-paginate_wrap" id="'+identifier+'" data-region="'+identifier+'-preview-container"><div data-region="'+identifier+'-count-container"></div><div data-region="'+identifier+'-list-container" id ="'+identifier+'id"></div></div>',filterdata={module_type:data.moduletype,module_tags:data.tags,show_suggestions:data.show_suggestions};Str.get_string("suggested_modules","block_trending_modules").then(function(header){ModalFactory.create({title:header,type:ModalFactory.types.DEFAULT,body:contenthtml}).done(function(modal){this.modal=modal,this.modal.setLarge(),modal.show(),this.modal.getRoot().addClass("suggested_modules"),cardPaginate.reload(options,dataoptions,filterdata),this.modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()}))}.bind(this))}.bind(this))})),$(document).on("keyup","#search_popup_content",(function(){clearTimeout(timer);var search=$(this).val(),data=$(this).data();timer=setTimeout((function(){var filterdata={module_type:data.module_type,module_tags:data.module_tags,show_suggestions:data.show_suggestions,search_query:search};cardPaginate.reload(options,dataoptions,filterdata)}),100)})),$(document).on("keydown","#search_popup_content",(function(){clearTimeout(timer)}))}}}));

//# sourceMappingURL=trending_modules.min.js.map