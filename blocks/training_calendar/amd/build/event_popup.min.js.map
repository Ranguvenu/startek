{"version":3,"file":"event_popup.min.js","sources":["../src/event_popup.js"],"sourcesContent":["/**\n * Add a create new event modal to the page.\n *\n * @module     blocks/training calendar\n * @package    calendar\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/str', 'core/modal_factory', 'core/modal_events', 'core/fragment', 'core/ajax', 'core/yui'],\n        function($, Str, ModalFactory, ModalEvents) {\n\n    return  {\n        popup_eventinfo: function(args){\n            customstrings = Str.get_strings([{\n                        key: 'when',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'openson',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'closeson',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'eventtype',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'summary'\n                    },\n                    {\n                        key: 'trainers',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'location',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'enrol',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'request',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'processing',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'waiting',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'notpublished',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'launch',\n                        component: 'block_training_calendar'\n                    },\n                    {\n                        key: 'view',\n                    }\n                    ]);\n\n        return customstrings.then(function(strings) {\n                var btn = '';\n                var event_details = '';\n                var other_details = 1;\n                var pop_desc =  args.eventlocal_eventname;\n                if (args.eventeventtype == \"session_open\" || args.eventeventtype == \"open\") {\n                    if (args.eventlocal_eventenddate == 'null') {\n                         event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-clock-o fa-fw \" aria-hidden=\"true\" title=\"'+strings[0]+'\" aria-label=\"When\"></i> </div><div class=\"col-xs-11\"> '+strings[1] + args.eventlocal_eventstartdate+ '</div></div>';\n                    } else {\n                        event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-clock-o fa-fw \" aria-hidden=\"true\" title=\"'+strings[0]+'\" aria-label=\"When\"></i> </div><div class=\"col-xs-11\">' + args.eventlocal_eventstartdate+ ' - '+ args.eventlocal_eventenddate+ '</div></div>';\n                    }\n                } else if (args.eventeventtype == \"session_close\" || args.eventeventtype == \"close\") {\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-clock-o fa-fw \" aria-hidden=\"true\" title=\"'+strings[0]+'\" aria-label=\"When\"></i> </div><div class=\"col-xs-11\"> '+strings[2] + args.eventlocal_eventenddate+ '</div></div>';\n                } else { // all other events like course site mod\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-clock-o fa-fw \" aria-hidden=\"true\" title=\"'+strings[0]+'\" aria-label=\"When\"></i> </div><div class=\"col-xs-11\"> ' + args.eventlocal_eventstartdate+ '</div></div>';\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-calendar fa-fw  \" aria-hidden=\"true\" title=\"'+strings[3]+'\" aria-label=\"Event type\"></i></i> </div><div class=\"col-xs-11\">' + args.eventeventtype + '</div></div>';\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-align-left fa-fw \" aria-hidden=\"true\" title=\"'+strings[4]+'\" aria-label=\"Summary\"></i></i> </div><div class=\"col-xs-11\">' + args.eventsummary + '</div></div>';\n                    other_details = 0;\n                }\n                if (other_details == 1) {\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-align-left fa-fw \" aria-hidden=\"true\" title=\"'+strings[5]+'\" aria-label=\"Trainers\"></i></i> </div><div class=\"col-xs-11\">' + args.eventtrainer + '</div></div>';\n                    event_details += '<div class=\"row  mt-10 mb-10\"><div class=\"col-xs-1\"> <i class=\"icon fa fa-map-marker fa-fw \" aria-hidden=\"true\" title=\"'+strings[6]+'\" aria-label=\"Location\"></i> </div><div class=\"col-xs-11\">' + args.eventlocation + '</div></div>';\n                }\n\n                btn += '<ul class=\"eventpopup_footer\">';\n                switch (args.eventplugin) {\n                    case 'local_classroom':\n                        if((args.eventenrolled == false) && (args.eventself_enrol == true)) {\n                            var button_classroom = function () {\n                                var tmp = null;\n                                $.ajax({\n                                    async: false,\n                                    type: \"POST\",\n                                    global: false,\n                                    dataType: \"json\",\n                                    url: M.cfg.wwwroot + '/blocks/training_calendar/ajax.php?instance='+args.eventinstance+'&plugin=local_classroom',\n                                    success: function (returndata) {\n                                        if ((returndata == 1)) {\n                                          tmp = '<li><a href= \"javascript:void(0)\" onclick=\"(function(e){ require(\\'local_classroom/classroom\\').ManageclassroomStatus({action:\\'selfenrol\\', id: '+args.eventinstance+', classroomid:'+args.eventinstance+',actionstatusmsg:\\'classroom_self_enrolment\\',classroomname:\\''+args.eventlocal_eventname+'\\'}) })(event)\"><button class=\"btn\">'+strings[7]+'</button></a> </li>';\n                                        }else if ((returndata == 2)) {\n                                          tmp = '<li><a href= \"javascript:void(0)\" onclick=\"(function(e){ require(\\'local_classroom/classroom\\').ManageclassroomStatus({action:\\'enrolrequest\\', id: '+args.eventinstance+', classroomid:'+args.eventinstance+',actionstatusmsg:\\'classroom_enrolrequest_enrolment\\',classroomname:\\''+args.eventlocal_eventname+'\\'}) })(event)\"><button class=\"btn\">'+strings[8]+'</button></a> </li>';\n                                        }else if ((returndata == 3)) {\n                                          tmp = '<li><button class=\"btn\">'+strings[9]+'</button></li>';\n                                        }else if ((returndata == 4)) {\n                                          tmp = '<li><button class=\"btn\">'+strings[10]+'</button></li>';\n                                        } else {\n                                           tmp = '<li>'+strings[11]+'</li>';\n                                        }\n                                    }\n                                });\n                                return tmp;\n                            }();\n                            btn += button_classroom;\n\n                        }\n\n                        else if(args.eventenrolled == true) {\n                           btn += '<li><a href= \"' + M.cfg.wwwroot + '/local/classroom/view.php?cid=' + args.eventinstance +'\" target=\"_blank\"><button class=\"btn\">'+strings[12]+'</button></a> </li>';\n                        }\n                    break;\n                    case 'local_program':\n                        if((args.eventenrolled == false) && (args.eventself_enrol == true)) {\n                            var button_program = function () {\n                                var tmp = null;\n                                $.ajax({\n                                    async: false,\n                                    type: \"POST\",\n                                    global: false,\n                                    dataType: \"json\",\n                                    url: M.cfg.wwwroot + '/blocks/training_calendar/ajax.php?instance='+args.eventinstance+'&plugin=local_program',\n                                    success: function (returndata) {\n                                        if ((returndata == 1)) {\n                                          tmp = '<li><a href= \"javascript:void(0)\" onclick=\"(function(e){ require(\\'local_program/program\\').ManageprogramStatus({action:\\'selfenrol\\', id: '+args.eventinstance+', programid:'+args.eventinstance+',actionstatusmsg:\\'program_self_enrolment\\',programname:\\''+args.eventlocal_eventname+'\\'}) })(event)\"><button class=\"btn\">'+strings[7]+'</button></a> </li>';\n                                        } else {\n                                           tmp = '<li>'+strings[11]+'</li>';\n                                        }\n                                    }\n                                });\n                                return tmp;\n                            }();\n                            btn += button_program;\n                        }\n\n                        else if(args.eventenrolled == true)\n                        btn += '<li><a href= \"' + M.cfg.wwwroot + '/local/program/view.php?bcid=' + args.eventinstance +'\" target=\"_blank\"><button class=\"btn\">'+strings[12]+'</button></a> </li>';\n                    break;\n                    case 'local_certification':\n                        if((args.eventenrolled == false) && (args.eventself_enrol == true)) {\n                            var button_certification = function () {\n                                var tmp = null;\n                                $.ajax({\n                                    async: false,\n                                    type: \"POST\",\n                                    global: false,\n                                    dataType: \"json\",\n                                    url: M.cfg.wwwroot + '/blocks/training_calendar/ajax.php?instance='+args.eventinstance+'&plugin=local_certification',\n                                    success: function (returndata) {\n                                        if ((returndata == 1)) {\n                                          tmp = '<li><a href= \"javascript:void(0)\"  onclick=\"(function(e){ require(\\'local_certification/certification\\').ManagecertificationStatus({action:\\'selfenrol\\', id: '+args.eventinstance+', certificationid:'+args.eventinstance+',actionstatusmsg:\\'certification_self_enrolment\\',certificationname:\\''+args.eventlocal_eventname+'\\'}) })(event)\"><button class=\"btn\">'+strings[7]+'</button></a> </li>';\n                                        } else {\n                                           tmp = '<li>'+strings[11]+'</li>';\n                                        }\n                                    }\n                                });\n                                return tmp;\n                            }();\n                            btn += button_certification;\n                        }\n\n                        else if(args.eventenrolled == true)\n                        btn += '<li><a href= \"' + M.cfg.wwwroot + '/local/certification/view.php?ctid=' + args.eventinstance +'\" target=\"_blank\"><button class=\"btn\">'+strings[12]+'</button></a> </li>';\n                    break;\n                    case 'course':\n                        if((args.eventenrolled == false) && (args.eventself_enrol == true)) {\n                            var button_course = function () {\n                                var tmp = null;\n                                $.ajax({\n                                    async: false,\n                                    type: \"POST\",\n                                    global: false,\n                                    dataType: \"json\",\n                                    url: M.cfg.wwwroot + '/blocks/training_calendar/ajax.php?instance='+args.eventinstance+'&plugin=local_certification',\n                                    success: function (returndata) {\n                                        if ((returndata == 1)) {\n                                          tmp = '<li><a href= \"' + M.cfg.wwwroot + '/course/view.php?id=' + args.eventinstance +'\" target=\"_blank\"><button class=\"btn\">'+strings[13]+'</button></a> </li>';\n                                        } else {\n                                           tmp = '<li>'+strings[11]+'</li>';\n                                        }\n                                    }\n                                });\n                                return tmp;\n                            }();\n                            btn += button_course;\n                        }\n                        else if(args.eventenrolled == true)\n                        btn += '<li><a href= \"' + M.cfg.wwwroot + '/course/view.php?id=' + args.eventinstance +'\" ><button class=\"btn\">'+strings[13]+'</button></a> </li>';\n                    break;\n                    default:\n                        btn += '<li><a href=\"'+ M.cfg.wwwroot+'\" target=\"_blank\"></li>';\n                    break;\n                }\n                btn += '</ul>';\n                ModalFactory.create({\n                    title: pop_desc,\n                    body: event_details,\n                    footer: btn\n                  }).done(function(modal) {\n                    modal.show();\n                    modal.getRoot().click(function(e) {\n                        modal.show();\n                    }.bind(this));\n                    $(\".close\").click(function(e) {\n                        modal.hide();\n                        modal.destroy();\n                    }.bind(this));\n                });\n            }.bind(this));\n        },\n        load: function () {\n           // do nothing\n        }\n    };\n});"],"names":["define","$","Str","ModalFactory","ModalEvents","popup_eventinfo","args","customstrings","get_strings","key","component","then","strings","tmp","btn","event_details","other_details","pop_desc","eventlocal_eventname","eventeventtype","eventlocal_eventenddate","eventlocal_eventstartdate","eventsummary","eventtrainer","eventlocation","eventplugin","eventenrolled","eventself_enrol","ajax","async","type","global","dataType","url","M","cfg","wwwroot","eventinstance","success","returndata","button_program","button_certification","button_course","create","title","body","footer","done","modal","show","getRoot","click","e","bind","this","hide","destroy","load"],"mappings":"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"}