/**
 * Add a create new group modal to the page.
 *
 * @module     block_learnerscript/ajaxforms
 * @class      AjaxForms
 * @package    block_learnerscript
 * @copyright  2017 Mukka Arun Kumar <arun@eabyas.in>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("block_learnerscript/ajaxforms",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","block_learnerscript/ajax","block_learnerscript/schedule","block_learnerscript/select2","core/yui","core/templates","core/modal","block_learnerscript/helper","jqueryui"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax,schedule,select2,Y,Templates,Modal,helper){var AjaxForms=function(args,url){this.args=args,this.contextid=1,this.url=url,this.nodeContent=args.nodeContent||"ajaxForm",this.init(this.args)};return AjaxForms.prototype.modal=null,AjaxForms.prototype.contextid=-1,AjaxForms.prototype.init=function(args){var resp=this.getBody(),self=this,dialogueclass="";resp.done((function(data){$("body").append("<div class='"+self.nodeContent+"'></div>"),Templates.replaceNodeContents("."+self.nodeContent,data.html,"");var title_img="",position="#viewreport"+args.reportid,width="80%",my="center top",at="center top";"schreportform"==args.action?(dialogueclass="schreportform",title_img="<img class='dialog_title_icon' alt='Schedule' src='"+M.util.image_url("schreportform","block_learnerscript")+"' />",position="#inst"+args.instanceid,width="60%",my="center",at="center"):"advancedcolumns"==args.action?(dialogueclass="advancedcolumns",position=".ls_components",width="60%",my="center top",at="center top"):"sendreportemail"==args.action&&(dialogueclass="sendreportemail",title_img="<img class='dialog_title_icon' alt='Email' src='"+M.util.image_url("email_icon","block_learnerscript")+"'/>",position="#inst"+args.instanceid,width="60%",my="center",at="center"),$("head").append(data.javascript);var dlg=$("."+self.nodeContent).dialog({resizable:!0,autoOpen:!1,width:width,dialogClass:dialogueclass,title:self.args.title,modal:!0,appendTo:position,position:{my:my,at:at,of:position,within:position},close:function(event,ui){$(this).dialog("destroy").remove()},open:function(){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(this).closest(".ui-dialog").find(".ui-dialog-title").html(title_img+self.args.title)}});"schreportform"==args.action?($("."+self.nodeContent+" select[data-select2='1']").select2(),schedule.SelectRoleUsers()):"sendreportemail"==args.action&&require("block_learnerscript/helper").Select2Ajax({action:"userlist",reportid:args.reportid,maximumSelectionLength:0}),$("."+self.nodeContent+" .mform").bind("submit",(function(e){return e.preventDefault(),self.submitFormAjax(this)})),"plotforms"!=args.action||"bar"!=args.pname&&"column"!=args.pname&&"line"!=args.pname&&"combination"!=args.pname||($("."+self.nodeContent+" select[data-select2='1']").select2({theme:"classic"}),$(document).on("click",".fa-eye",(function(e){e.stopImmediatePropagation(),$(e.target).parents(".form-group").find("*").attr("disabled",!0),$(e.target).switchClass("fa-eye","fa-eye-slash"),$(e.target).attr("title","Enable")})),$(document).on("click",".fa-eye-slash",(function(e){e.stopImmediatePropagation(),$(e.target).parents(".form-group").find("*").removeAttr("disabled"),$(e.target).switchClass("fa-eye-slash","fa-eye"),$(e.target).attr("title","Disable")})),$(document).on("change","#id_calcs",(function(){$(this).val()?($("#id_columnsort").prop("disabled",!0),$("#id_sorting").prop("disabled",!0),$("#id_limit").prop("disabled",!0)):($("#id_columnsort").prop("disabled",!1),$("#id_sorting").prop("disabled",!1),$("#id_limit").prop("disabled",!1))}))),dlg.dialog("open")})).fail((function(ex){}))},AjaxForms.prototype.getBody=function(formdata){return void 0===formdata?formdata=null:this.args.jsonformdata=JSON.stringify(formdata),Ajax.call({args:this.args,url:this.url},!1)},AjaxForms.prototype.handleFormSubmissionResponse=function(data){var helper=require("block_learnerscript/helper");if(data.formerror){Templates.replaceNodeContents("."+this.nodeContent,data.html,""),$("head").append(data.javascript);var self=this;$("."+this.nodeContent+" .mform").bind("submit",(function(e){e.preventDefault(),self.submitFormAjax(this)})),"schreportform"==this.args.action?($("."+self.nodeContent+" select[data-select2='1']").select2(),schedule.SelectRoleUsers()):"sendreportemail"==this.args.action?(helper=require("block_learnerscript/helper")).Select2Ajax({action:"userlist",reportid:this.args.reportid,maximumSelectionLength:0}):$("."+self.nodeContent+" select[data-select2='1']").select2({theme:"classic"})}else if("columns"==this.args.component){var app=angular.element(".simpleDemo").scope(),pluginname=this.args.advancedcolumn;app.$apply((function(){var plugindata={};plugindata.id=data.data.id,delete data.data.id,plugindata.pluginname=pluginname,plugindata.pluginfullname=pluginname,plugindata.summary="",plugindata.type="selectedcolumns",plugindata.formdata=data.data,app.lists.columns.elements.push(plugindata)})),$("."+this.nodeContent).dialog("destroy").remove()}else if("schreportform"==this.args.action)$("."+this.nodeContent).dialog("close"),Str.get_string("reportschedule","block_learnerscript").then((function(s){helper.notifications(s)}));else if("plotforms"==this.args.action){self=this;$("."+this.nodeContent).dialog("close"),Str.get_strings([{key:"graphcreated",component:"block_learnerscript"},{key:"graphupdated",component:"block_learnerscript"}]).then((function(s){var cid,templatename,tabdata;if("add"==self.args.type){helper.notifications(s[0]);var reportid=self.args.reportid;cid=data.data.id;var CreateDashboardwidget={};if(CreateDashboardwidget.reportid=reportid,CreateDashboardwidget.chartid=data.data.id,CreateDashboardwidget.reporttype=data.data.id,CreateDashboardwidget.pluginname=self.args.pname,CreateDashboardwidget.chartname=data.data.chartname,CreateDashboardwidget.issiteadmin=!0,CreateDashboardwidget.editicon=M.util.image_url("t/edit"),Str.get_string(self.args.pname,"block_learnerscript").then((function(s){CreateDashboardwidget.title=s})),CreateDashboardwidget.cid=data.data.id,CreateDashboardwidget.pname=self.args.pname,CreateDashboardwidget.type="edit",CreateDashboardwidget.deleteicon=M.util.image_url("t/delete"),CreateDashboardwidget.pname=self.args.pname,CreateDashboardwidget.type="edit",$("#report_plottabs").length>0)templatename="block_learnerscript/tabs",tabdata=CreateDashboardwidget;else{templatename="block_learnerscript/plottabs";var CreateDashboardwidgetargs={};CreateDashboardwidgetargs.reportid=reportid,CreateDashboardwidgetargs.multiplot=!0,CreateDashboardwidgetargs.enableplots=!1,CreateDashboardwidgetargs.plottabs=CreateDashboardwidget,tabdata=CreateDashboardwidgetargs}Templates.render(templatename,tabdata).done((function(tab){$("#report_plottabs").length>0?$("span#report_plottabs ul").append(tab):$("span.filter_buttons").prepend(tab),$(".plotgraphcontainer").removeClass("show").addClass("hide"),$("#plotreportcontainer"+reportid).html("")}))}else"edit"==self.args.type&&(helper.notifications(s[1]),cid=self.args.cid,$("#lschartname"+cid).text(data.data.chartname),$("#"+cid).trigger("click"))}))}else"sendreportemail"==this.args.action?($("."+this.nodeContent).dialog("close"),Str.get_string("mailscheduled","block_learnerscript").then((function(s){helper.notifications(s)}))):window.location.reload()},AjaxForms.prototype.handleFormSubmissionFailure=function(data){},AjaxForms.prototype.submitFormAjax=function(form){if(skipClientValidation)return $("."+this.nodeContent).dialog("destroy").remove(),!0;this.args.jsonformdata=$(form).serialize();var self=this;Ajax.call({args:this.args,url:this.url}).done((function(response){return self.handleFormSubmissionResponse(response)})).fail((function(ex){console.log(ex)}))},AjaxForms.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},{init:function(args,url){return new AjaxForms(args,url)}}}));

//# sourceMappingURL=ajaxforms.min.js.map