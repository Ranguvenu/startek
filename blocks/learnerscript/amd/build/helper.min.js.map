{"version":3,"file":"helper.min.js","sources":["../src/helper.js"],"sourcesContent":["define(['jquery',\n        'block_learnerscript/ajax',\n        'block_learnerscript/ajaxforms',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/ajax',\n        'core/notification',\n        'block_learnerscript/smartfilter',\n        'block_learnerscript/bootstrapnotify'\n    ],\n    function($, ajax, AjaxForms, Str, ModalFactory, ModalEvents, Ajax, notification, smartfilter) {\n        return helper = {\n            sendmessage: function(args, username) {\n                    Str.get_strings([{\n                    key: 'sendmessage',\n                    component: 'block_learnerscript'\n                }, {\n                    key: 'messageconformation',\n                    component: 'block_learnerscript'\n                }, {\n                    key: 'messagesent',\n                    component: 'block_learnerscript'\n                }]).then(function(s) {\n                var userid = args.userid;\n                var reportinstance = args.reportinstance;\n                var formid = \"form_sendsms\" + userid;\n                var container = $(\"#sendsms_\" + reportinstance + '_' + userid).parents('table');\n                if ($('#ls_sendsms_' + reportinstance + '_' + userid).length < 1) {\n                    $(\"#sendsms_\" + reportinstance + '_' + userid).append('<div id=\"ls_sendsms_' + reportinstance + '_' + userid + '\" class=\"sendmessage\"><div class=\"messageloading\"></div><form id=\"' + formid + '\" ><textarea id=\"text_' + formid + '\" type=\"text\" name=\"message\"></textarea><input type=\"submit\" value = \"Submit\"></form></div>');\n                }\n                var dlg = $('#ls_sendsms_' + reportinstance + '_' + userid).dialog({\n                    resizable: true,\n                    autoOpen: false,\n                    width: \"20%\",\n                    title: s[0],\n                    modal: false,\n                    dialogClass: 'sendsmsdialog',\n                    show: {\n                        effect: \"slide\",\n                        duration: 1000\n                    },\n                    position: {\n                        my: \"left\",\n                        at: \"right\",\n                        of: \"#sendsms_\" + reportinstance + '_' + userid,\n                        within: container\n                    },\n                    open: function(event, ui) {\n                        $(this).closest(\".ui-dialog\")\n                            .find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : \"Close\"\n                            });\n                        $(\".sendmessage\").not(this).each(function() {\n                            $(this).remove();\n                        });\n                    },\n                    close: function(event, ui) {\n                        $(this).dialog('destroy').remove();\n                    }\n                });\n                dlg.dialog(\"open\");\n                $(\"#\" + formid).submit(function(e) {\n                    e.preventDefault();\n                    var helper = require('block_learnerscript/helper');\n                    var emptymessage = document.getElementById(\"text_\" + formid).value;\n                    if (!emptymessage) {\n                        $('.messageloading').html('<div class=\"alert alert-danger\">You must supply a value here</div>');\n                    } else {\n                        url = require('core/url');\n                        $('.messageloading').html('<center><img src=\"' + url.imageUrl(\"loader\", \"block_learnerscript\") + '\" alt=\"Message Sending\" title=\"Message Sending\"/></center>');\n                        $(\"#\" + formid).hide();\n                        var promise = Ajax.call([{\n                            methodname: 'core_message_send_instant_messages',\n                            args: {\n                                messages: [{\n                                    touserid: args.userid,\n                                    text: $(\"#\" + formid).serializeObject().message,\n                                    textformat: 0\n                                }]\n                            }\n                        }]);\n                    }\n                    promise[0].done(function(response) {\n                        var message = s[2] + username\n                        helper.notifications(message);\n                        dlg.dialog(\"close\");\n                    }).fail(function(ex) {\n                        // do something with the exception\n                        //  console.log(ex);\n                        $('.messageloading').html('<div class=\"alert alert-warning\">' + ex.message + '</div>');\n                        // $(\"#\"+formid).show();\n                    });\n                })\n            });\n            },\n            ViewReportFilters: function(args) {\n                $('.' + args.activefilter).toggleClass(\"show\");\n                $('.' + args.inactivefilter).removeClass(\"show\");\n            },\n            deleteConfirm: function(args) {\n                // var action = $(elem).data('action');\n                return Str.get_strings([{\n                    key: 'deleteconfirmation',\n                    component: 'block_learnerscript'\n                }, {\n                    key: 'deleteallconfirm',\n                    component: 'block_learnerscript'\n                },{\n                    key:'graphdeleted',\n                    component:'block_learnerscript'\n                },{\n                    key:'graphcannotbedeleted',\n                    component:'block_learnerscript'\n                }]).then(function(s) {\n                    ModalFactory.create({\n                        title: s[0],\n                        type: ModalFactory.types.SAVE_CANCEL,\n                        body: s[1]\n                    }).done(function(modal) {\n                        this.modal = modal;\n                        modal.setSaveButtonText('Confirm');\n                        modal.getRoot().on(ModalEvents.save, function(e) {\n                            e.preventDefault();\n                            var helper = require('block_learnerscript/helper');\n                            var promise = Ajax.call([{\n                                methodname: 'block_learnerscript_' + args.action,\n                                args: args\n                            }]);\n                            promise[0].done(function(resp) {\n                                $('.plotgraphcontainer').removeClass('show').addClass('hide');\n                                $('#plotreportcontainer' + args.reportid).html('');\n\n                                // var activetab = $( \"#report_plottabs\" ).tabs( \"option\", \"active\" );\n                                // var activetabid = $( \"#report_plottabs li:eq(\" + activetab + \")\" ).data('cid');\n                                var tabdata = $('#' + args.cid).attr('aria-controls');\n                                $(\"[data-cid='\" + args.cid + \"']\").remove();\n                                $('#' + tabdata).remove();\n                                // $('#report_plottabs').tabs('destroy').tabs();\n                                // $('#report_plottabs').tabs( \"refresh\" );\n                                // if ($( \"#report_plottabs li:eq(0) a\" ).length > 0) {\n                                //     $( \"#report_plottabs li:eq(0) a\" ).trigger('click');\n                                // } else\n                                if ($( \"#report_plottabs li:eq(0) a\" ).length < 1) {\n                                    $('#report_plottabs').remove();\n                                }\n\n                                helper.notifications(s[2]);\n                                // window.location.href = window.location.href;\n                            }).fail(function(ex) {\n                                // do something with the exception\n                                console.log(ex);\n                            });\n                            modal.hide();\n                            modal.destroy();\n                        }.bind(this));\n                        modal.show();\n                        $('.modal-header button.close').attr('title','Close');\n                    }.bind(this));\n                }.bind(this));\n            },\n            validatebasicform: function(validate) {\n                var getreport = [];\n                if (typeof validate == 'undefined') {\n                    $.each($('.basicparamsform select'), function(index, value) {\n                        var selectedval = $(value).val();\n                        if (selectedval == 0) {\n                            getreport.push(0);\n                        }\n                    });\n                }\n                return getreport;\n            },\n            Preview: function(args) {\n                $(args.container).dialog({\n                    dialogClass: 'previewpopup',\n                    width: '95%',\n                    modal: true,\n                    position: {\n                        my: 'center',\n                        at: 'center',\n                        within: '.ls_components'\n                        //of: 'body'\n                    },\n                    close: function() {\n                        $(this).dialog('destroy');\n                    },\n                    open: function() {\n                        $(this).closest(\".ui-dialog\")\n                            .find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : \"Close\"\n                            });\n                        // $(this).closest(\".ui-dialog\")\n                        //     .find('.ui-dialog-title').html(title_img + self.args.title);\n                    }\n                });\n            },\n            /**\n             * Central method for call Select2 with Ajax in reports module\n             * @param object args Object with reportID and other required params\n             */\n            Select2Ajax: function(args) {\n                $(\"select[data-select2-ajax='1']\").each(function() {\n                    var instanceid = $(this).data('instanceid');\n                    var reportinstance = instanceid ? instanceid : args.reportid;\n                    if (args.action == 'rolewiseusers') {\n                        args.reportid = $(this).data('reportid'); \n                        args.orgid = $('#id_organization').val();\n                        args.deptid = $('#id_department').val();\n                        args.subdeptid = $('#id_subdepartment').val();\n                    }\n                    if (args.action === 'userlist') {\n                        args.setminimumInputLength = 2;\n                    }\n                    if (!$(this).hasClass('select2-hidden-accessible')) {\n                        $(this).select2({\n                            // multiple: args.multiple || false,\n                            ajax: {\n                                data: function(params) {\n                                    var dataaction = $(this).data('action');\n\n                                    if (dataaction == 'filterusers' || dataaction == 'filtercourses') {\n                                        args.action = dataaction;\n                                        args.basicparamdata = JSON.stringify(smartfilter.BasicparamsData(reportinstance));\n                                        args.fiterdata = JSON.stringify(smartfilter.FilterData(reportinstance));\n                                        args.reportinstanceid = instanceid;\n                                    }\n                                    if (args.action == 'rolewiseusers') {\n                                        delete args.schuserslist;\n                                        delete args.scheduleid;\n                                        args.roleid = $(\"#id_role\" + reportinstance).val();\n                                        args.orgid = $('#id_organization').val();\n                                        args.deptid = $('#id_department').val();\n                                        args.subdeptid = $('#id_subdepartment').val();\n                                        var roleid = args.roleid.split('_');\n                                        args.roleid = roleid[0];\n                                        args.contextlevel = roleid[1];\n                                    }\n                                    $.extend(params, args);\n                                    methodname2 = args.action;\n                                    if (methodname2 === 'userlist') {\n                                        $blockname = 'block_reportdashboard_';\n                                    } else {\n                                        $blockname = 'block_learnerscript_';\n                                    }\n\n                                    return params;\n                                },\n                                transport: function(params, success, failure) {\n                                    params.data.roleid = params.data.roleid;\n                                    var promise = Ajax.call([{\n                                        methodname: $blockname + methodname2,\n                                        args: params.data\n                                    }]);\n                                    promise[0].done(function(data) {\n                                        data = $.parseJSON(data);\n                                        success(data);\n                                    });\n                                    promise[0].fail(function(failure) {\n                                        // do something with the exception\n                                        //  console.log(failure);\n                                    });\n                                },\n                                processResults: function(data, params) {\n                                    // parse the results into the format expected by Select2\n                                    // since we are using custom formatting functions we do not need to\n                                    // alter the remote JSON data, except to indicate that infinite\n                                    // scrolling can be used\n                                    params.page = params.page || 1;\n                                    var pagination = false;\n                                    if (args.action === 'userlist' || args.action == 'filtercourses' || args.action == 'filterusers') {\n                                        pagination = false;\n                                    } else {\n                                        pagination = (params.page * 10) < data.total_count;\n                                    }\n                                    return {\n                                        results: data.items,\n                                        pagination: {\n                                                more: pagination\n                                        }\n                                    };\n                                }\n                            },\n                            escapeMarkup: function(markup) {\n                                return markup;\n                            }, // let our custom formatter work\n                            minimumInputLength: args.setminimumInputLength || 1,\n                            maximumSelectionLength: args.maximumSelectionLength,\n                            language: {\n                                // You can find all of the options in the language files provided in the\n                                // build. They all must be functions that return the string that should be\n                                // displayed.\n                                maximumSelected: function(params) {\n                                    if (args.action == 'rolewiseusers') {\n                                        args.roleid = $(\"#id_role\" + reportinstance).val();\n                                        args.schuserslist = $('#schuserslist' + reportinstance).val();\n                                        args.scheduleid = $(\"#scheduleid\").val() || -1;\n                                        return \"Click <a href='javascript:void(0);' class='seluser' id='addusers\" + args.reportid + \"' \\\n                                                     data-reportid=\" + args.reportid + \" data-scheduleid = \" + args.scheduleid + \" \\\n                        onclick = '(function(e){ require(\\\"block_learnerscript/schedule\\\").manageschusers(\\\n                                                     {reportinstance:\" + reportinstance + \", reportid:\" + args.reportid + \",scheduleid:\" + args.scheduleid + \",selectedroleid:\" + args.roleid + \",\\\n                                                     schuserslist:\\\"\" + args.schuserslist + \"\\\"}) })(event)' > here </a> to add more than \" + params.maximum + \" users.\";\n                                    }\n                                }\n                            },\n                            templateResult: function formatRepo(repo) {\n                                var markup;\n                                if (repo.loading) {\n                                    return repo.text || \"Values not supported\";\n                                }\n                                markup = repo.text || \"Values not supported\";\n                                return markup;\n                            }, // omitted for brevity, see the source of this page\n                            templateSelection: function formatRepoSelection(repo) {\n                                var markup;\n                                if (repo.id == -1 && args.action == 'rolewiseusers') {\n                                    var reportid = repo.element.form.dataset.reportid || 0;\n                                    var scheduleid = repo.element.form.dataset.scheduleid || -1;\n                                    markup = \"<a href='javascript:void(0)' class='viewschusers'\" +\n                                        \"onclick='(function(e){ require(\\\"block_learnerscript/schedule\\\").viewschusers( \\\n                                            {reportid:\" + reportid + \",scheduleid:\" + scheduleid + \", reportinstance:\" + reportinstance + \"}) })(event);'>\" + repo.text + \"</a>\";\n                                } else {\n                                    markup = repo.text;\n                                }\n                                return markup;\n                            } // omitted for brevity, see the source of this page\n                        }).on('select2:select', function(evt) {\n                            if (args.action == 'reportlist') {\n                                var reportid = $(this).val();\n                                window.location = M.cfg.wwwroot + '/blocks/learnerscript/viewreport.php?id=' + reportid;\n                            }\n                        });\n                    }\n                });\n            },\n            getQueryParameters: function(str) {\n                return (str || document.location.search).replace(/(\\?)/, '&').split(\"&\").map(function(n) { return n = n.split(\"=\"), this[n[0]] = n[1], this }.bind({}))[0];\n            },\n            DrilldownReport: function() {\n                var self = this;\n                //Drill down report\n                $('td a').click(function(e) {\n                    var url = $(this).attr('href');\n                    var drillurl = self.getQueryParameters(url);\n                    if (url.indexOf('viewreport.php') <= 0 || \"download\" in drillurl) {\n                        return;\n                    }\n                    e.preventDefault();\n                    self.ReportModelFromLink({ container: $(this), url: url });\n\n                });\n            },\n            ReportModelFromLink: function(args) {\n                console.log(args);\n                if(args.dashboard == 'compliance') {\n                    var tableid = args.tableid;\n                    var tablewidth = 800.5;\n                    args.length = 1;\n                } else {\n                    var tableid = args.container.parents().closest('table').attr('id');\n                    var tablewidth = $(\"#\" + tableid + \"\").width();\n                }\n                var drillurl = this.getQueryParameters(args.url);\n                var reportid = parseInt(drillurl.id);\n                var drilldata = $(this).data();\n                var filter = {};\n                if (args.url.indexOf('viewreport.php') <= 0 || \"download\" in drillurl) {\n                    return;\n                }\n                $.each(drillurl, function(key, val) {\n                    if (key.indexOf('filter') >= 0) {\n                        filter[key] = val;\n                    }\n                });\n                if ($(\"#reportcontainer\" + reportid).length == 0) {\n                    $('body').append('<div id=\"reportcontainer' + reportid + '\" style=\"display:none;\"></div>');\n                    reportwidget.CreateDashboardwidget({\n                        reportid: reportid,\n                        reporttype: 'table',\n                        basicparams: JSON.stringify(filter),\n                        ls_fstartdate: 0,\n                        ls_fenddate: $.now()\n                    });\n                    chart.SparkLineReport();\n                }\n                var dlg = $(\"#reportcontainer\" + reportid + \"\").dialog({\n                    resizable: true,\n                    autoOpen: false,\n                    dialogClass: \"drilldown\" + reportid,\n                    width: tablewidth,\n                    title: '',\n                    appendTo: \"#\" + tableid,\n                    modal: true,\n                    position: {\n                        my: \"center\",\n                        at: \"top\",\n                        of: \"#\" + tableid\n                    },\n                    open: function(event) {\n                        $(this).closest(\".ui-dialog\")\n                            .find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : \"Close\"\n                            });\n                        $(\".drilldown\" + reportid).append('<a href=' + args.url + '><span class=\"reportdashboard_right\">View more</span></a>');\n                    },\n                    close: function(event, ui) {\n                        $(this).dialog('destroy').remove();\n                    }\n                });\n                dlg.dialog(\"open\").prev(\".ui-dialog-titlebar\").css(\"color\", \"#0C75B6\");\n            },\n            PlotForm: function(args) {\n                url = M.cfg.wwwroot + '/blocks/learnerscript/ajax.php';\n                args.title = (!args.title) ? 'Plot Graph' : args.title;\n                AjaxForms.init(args, url);\n            },\n            reportCalculations: function(args) {\n                Str.get_string('calcs','block_learnerscript').then(function(s) {\n                var title_img = \"<img class='dialog_title_icon' alt='Calculations' src='\" +\n                    M.util.image_url(\"schedule_icon\", \"block_learnerscript\") + \"'/>\";\n                var dlg = $(\".reportcalculation\" + args.reportid).dialog({\n                    dialogClass: 'calculationspopup',\n                    resizable: false,\n                    autoOpen: false,\n                    width: \"50%\",\n                    title: 'Calculations',\n                    modal: true,\n                    position: {\n                        my: \"center\",\n                        at: \"center\",\n                        of: window\n                    },\n                    open: function(event, ui) {\n                        $(\".reportcalculation\" + args.reportid).append('<img src=\"' + M.util.image_url('loading', 'block_learnerscript') + '\" id=\"loadingimage\" />');\n                        $(document).ajaxStop(function() {\n                            $(\"#loadingimage\").remove();\n                        });\n                        $(this).closest(\".ui-dialog\").find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : \"Close\"\n                            });\n                        $(this).closest(\".ui-dialog\").find('.ui-dialog-title')\n                            .html('Calculations');\n                    }\n\n                });\n                args.filters = smartfilter.FilterData(args.reportid);\n                args.filters['ls_fstartdate'] = $('#ls_fstartdate').val();\n                args.filters['ls_fenddate'] = $('#ls_fenddate').val();\n                if (typeof args.filters['filter_course'] == 'undefined') {\n                    var filter_courses = $('#coursedashboardfilter').val();\n                    if (filter_courses != 1) {\n                        args.filters['filter_course'] = filter_courses;\n                    }\n                } \n                if (typeof args.filters['filter_organization'] == 'undefined') {\n                    var filter_organization = $('#dashboardcostcenters').val();\n                    if (filter_organization != 0) {\n                        args.filters['filter_organization'] = filter_organization;\n                    }\n                }\n                if (typeof args.filters['filter_departments'] == 'undefined') {\n                    var filter_departments = $('#dashboarddepartment').val();\n                    if (filter_departments != 0) {\n                        args.filters['filter_departments'] = filter_departments;\n                    }\n                }\n                args.filters = JSON.stringify(args.filters);\n\n                args.action = 'reportcalculations';\n\n                args.basicparams = args.basicparams || JSON.stringify(smartfilter.BasicparamsData(args.reportid));\n                var promise = ajax.call({\n                    args: args,\n                    url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\"\n                });\n                promise.done(function(response) {\n                    $(\".reportcalculation\" + args.reportid).closest(\".ui-dialog\").find('.ui-dialog-title')\n                        .html(response.reportname + ' : Calculations');\n                    $(\".reportcalculation\" + args.reportid).html(response.table);\n                }).fail(function(ex) {\n                    // do something with the exception\n                    //  console.log(ex);\n                });\n                dlg.dialog(\"open\");\n                }.bind(this));\n            },\n            dropdown: function(child) {\n                $('#' + child).toggle();\n            },\n            notifications: function(elements, notifytype){\n                notifytype = notifytype || 'success';\n                $.notify({\n                    message: elements\n                },{\n                    type: notifytype\n                }\n                );\n            },\n            tabsdraggable: function($tabs) {\n                $( \".ls-plotgraphs_list\" ).sortable({\n                    cursor: 'move',\n                    axis: 'y',\n                    update: function (event, ui) {\n                        var elementsorder = $('.ls-plotgraphs_list').sortable('toArray', {attribute: 'data-cid'}).toString();\n                        var promise = ajax.call({\n                            args: {\n                                action: 'tabsposition',\n                                reportid: $('.ls-plotgraphs_list').data('reportid'),\n                                component: 'plot',\n                                elementsorder: elementsorder\n                            },\n                            url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\"\n                        });\n                    }\n                });\n            },\n            rolesforcontext: function(contextlevel, reportid){\n                var promise = ajax.call({\n                    args: {\n                        action: 'contextroles',\n                        contextlevel: contextlevel,\n                        reportid: reportid\n                    },\n                    url: M.cfg.wwwroot + \"/blocks/learnerscript/ajax.php\",\n                });\n                promise.done(function(response) {\n                    var template = '';\n                    $.each(response, function(key, value) {\n                        template += '<option value = ' + key + '>' + value + '</option>';\n                    });\n                    $(\"#id_roleid\").find('option').remove().end().append(template);\n                });\n            }\n        }\n    });\n"],"names":["define","$","ajax","AjaxForms","Str","ModalFactory","ModalEvents","Ajax","notification","smartfilter","helper","sendmessage","args","username","get_strings","key","component","then","s","userid","reportinstance","formid","container","parents","length","append","dlg","dialog","resizable","autoOpen","width","title","modal","dialogClass","show","effect","duration","position","my","at","of","within","open","event","ui","this","closest","find","removeClass","html","Closebutton","parent","attr","not","each","remove","close","submit","e","preventDefault","require","document","getElementById","value","url","imageUrl","hide","promise","call","methodname","messages","touserid","text","serializeObject","message","textformat","done","response","notifications","fail","ex","ViewReportFilters","activefilter","toggleClass","inactivefilter","deleteConfirm","create","type","types","SAVE_CANCEL","body","setSaveButtonText","getRoot","on","save","action","resp","addClass","reportid","tabdata","cid","console","log","destroy","bind","validatebasicform","validate","getreport","index","val","push","Preview","Select2Ajax","instanceid","data","orgid","deptid","subdeptid","setminimumInputLength","hasClass","select2","params","dataaction","basicparamdata","JSON","stringify","BasicparamsData","fiterdata","FilterData","reportinstanceid","schuserslist","scheduleid","roleid","split","contextlevel","extend","methodname2","$blockname","transport","success","failure","parseJSON","processResults","page","pagination","total_count","results","items","more","escapeMarkup","markup","minimumInputLength","maximumSelectionLength","language","maximumSelected","maximum","templateResult","repo","loading","templateSelection","id","element","form","dataset","evt","window","location","M","cfg","wwwroot","getQueryParameters","str","search","replace","map","n","DrilldownReport","self","click","drillurl","indexOf","ReportModelFromLink","dashboard","tableid","tablewidth","parseInt","filter","reportwidget","CreateDashboardwidget","reporttype","basicparams","ls_fstartdate","ls_fenddate","now","chart","SparkLineReport","appendTo","prev","css","PlotForm","init","reportCalculations","get_string","util","image_url","ajaxStop","filters","filter_courses","filter_organization","filter_departments","reportname","table","dropdown","child","toggle","elements","notifytype","notify","tabsdraggable","$tabs","sortable","cursor","axis","update","elementsorder","attribute","toString","rolesforcontext","template","end"],"mappings":"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"}