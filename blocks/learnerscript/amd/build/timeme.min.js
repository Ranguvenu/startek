(function(){var root,factory;root=this,factory=function(){var TimeMe={startStopTimes:{},idleTimeoutMs:3e4,currentIdleTimeMs:0,checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:function(elementId){var element=document.getElementById(elementId);element&&(element.addEventListener("mouseover",(function(){TimeMe.startTimer(elementId)})),element.addEventListener("mousemove",(function(){TimeMe.startTimer(elementId)})),element.addEventListener("mouseleave",(function(){TimeMe.stopTimer(elementId)})),element.addEventListener("keypress",(function(){TimeMe.startTimer(elementId)})),element.addEventListener("focus",(function(){TimeMe.startTimer(elementId)})))},getTimeOnElementInSeconds:function(elementId){var time=TimeMe.getTimeOnPageInSeconds(elementId);return time||0},startTimer:function(pageName,startTime){if(pageName||(pageName=TimeMe.currentPageName),void 0===TimeMe.startStopTimes[pageName])TimeMe.startStopTimes[pageName]=[];else{var arrayOfTimes=TimeMe.startStopTimes[pageName],latestStartStopEntry=arrayOfTimes[arrayOfTimes.length-1];if(void 0!==latestStartStopEntry&&void 0===latestStartStopEntry.stopTime)return}TimeMe.startStopTimes[pageName].push({startTime:startTime||new Date,stopTime:void 0}),TimeMe.active=!0},stopAllTimers:function(){for(var pageNames=Object.keys(TimeMe.startStopTimes),i=0;i<pageNames.length;i++)TimeMe.stopTimer(pageNames[i])},stopTimer:function(pageName,stopTime){pageName||(pageName=TimeMe.currentPageName);var arrayOfTimes=TimeMe.startStopTimes[pageName];void 0!==arrayOfTimes&&0!==arrayOfTimes.length&&(void 0===arrayOfTimes[arrayOfTimes.length-1].stopTime&&(arrayOfTimes[arrayOfTimes.length-1].stopTime=stopTime||new Date),TimeMe.active=!1)},getTimeOnCurrentPageInSeconds:function(){return TimeMe.getTimeOnPageInSeconds(TimeMe.currentPageName)},getTimeOnPageInSeconds:function(pageName){var timeInMs=TimeMe.getTimeOnPageInMilliseconds(pageName);return void 0===timeInMs?void 0:timeInMs/1e3},getTimeOnCurrentPageInMilliseconds:function(){return TimeMe.getTimeOnPageInMilliseconds(TimeMe.currentPageName)},getTimeOnPageInMilliseconds:function(pageName){var arrayOfTimes=TimeMe.startStopTimes[pageName];if(void 0!==arrayOfTimes){for(var timeSpentOnPageInSeconds=0,i=0;i<arrayOfTimes.length;i++){var startTime=arrayOfTimes[i].startTime,stopTime=arrayOfTimes[i].stopTime;void 0===stopTime&&(stopTime=new Date),timeSpentOnPageInSeconds+=stopTime-startTime}return Number(timeSpentOnPageInSeconds)}},getTimeOnAllPagesInSeconds:function(){for(var allTimes=[],pageNames=Object.keys(TimeMe.startStopTimes),i=0;i<pageNames.length;i++){var pageName=pageNames[i],timeOnPage=TimeMe.getTimeOnPageInSeconds(pageName);allTimes.push({pageName:pageName,timeOnPage:timeOnPage})}return allTimes},setIdleDurationInSeconds:function(duration){var durationFloat=parseFloat(duration);if(!1!==isNaN(durationFloat))throw{name:"InvalidDurationException",message:"An invalid duration time ("+duration+") was provided."};return TimeMe.idleTimeoutMs=1e3*duration,this},setCurrentPageName:function(pageName){return TimeMe.currentPageName=pageName,this},resetRecordedPageTime:function(pageName){delete TimeMe.startStopTimes[pageName]},resetAllRecordedPageTimes:function(){for(var pageNames=Object.keys(TimeMe.startStopTimes),i=0;i<pageNames.length;i++)TimeMe.resetRecordedPageTime(pageNames[i])},resetIdleCountdown:function(){TimeMe.idle&&TimeMe.triggerUserHasReturned(),TimeMe.idle=!1,TimeMe.currentIdleTimeMs=0},callWhenUserLeaves:function(callback,numberOfTimesToInvoke){this.userLeftCallbacks.push({callback:callback,numberOfTimesToInvoke:numberOfTimesToInvoke})},callWhenUserReturns:function(callback,numberOfTimesToInvoke){this.userReturnCallbacks.push({callback:callback,numberOfTimesToInvoke:numberOfTimesToInvoke})},triggerUserHasReturned:function(){if(!TimeMe.active)for(var i=0;i<this.userReturnCallbacks.length;i++){var userReturnedCallback=this.userReturnCallbacks[i],numberTimes=userReturnedCallback.numberOfTimesToInvoke;(isNaN(numberTimes)||void 0===numberTimes||numberTimes>0)&&(userReturnedCallback.numberOfTimesToInvoke-=1,userReturnedCallback.callback())}TimeMe.startTimer()},triggerUserHasLeftPage:function(){if(TimeMe.active)for(var i=0;i<this.userLeftCallbacks.length;i++){var userHasLeftCallback=this.userLeftCallbacks[i],numberTimes=userHasLeftCallback.numberOfTimesToInvoke;(isNaN(numberTimes)||void 0===numberTimes||numberTimes>0)&&(userHasLeftCallback.numberOfTimesToInvoke-=1,userHasLeftCallback.callback())}TimeMe.stopAllTimers()},callAfterTimeElapsedInSeconds:function(timeInSeconds,callback){TimeMe.timeElapsedCallbacks.push({timeInSeconds:timeInSeconds,callback:callback,pending:!0})},checkState:function(){for(var i=0;i<TimeMe.timeElapsedCallbacks.length;i++)TimeMe.timeElapsedCallbacks[i].pending&&TimeMe.getTimeOnCurrentPageInSeconds()>TimeMe.timeElapsedCallbacks[i].timeInSeconds&&(TimeMe.timeElapsedCallbacks[i].callback(),TimeMe.timeElapsedCallbacks[i].pending=!1);!1===TimeMe.idle&&TimeMe.currentIdleTimeMs>TimeMe.idleTimeoutMs?(TimeMe.idle=!0,TimeMe.triggerUserHasLeftPage()):TimeMe.currentIdleTimeMs+=TimeMe.checkStateRateMs},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function(){void 0!==document.hidden?(TimeMe.hiddenPropName="hidden",TimeMe.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(TimeMe.hiddenPropName="mozHidden",TimeMe.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(TimeMe.hiddenPropName="msHidden",TimeMe.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(TimeMe.hiddenPropName="webkitHidden",TimeMe.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(TimeMe.visibilityChangeEventName,(function(){document[TimeMe.hiddenPropName]?TimeMe.triggerUserHasLeftPage():TimeMe.triggerUserHasReturned()}),!1),window.addEventListener("blur",(function(){TimeMe.triggerUserHasLeftPage()})),window.addEventListener("focus",(function(){TimeMe.triggerUserHasReturned()})),document.addEventListener("mousemove",(function(){TimeMe.resetIdleCountdown()})),document.addEventListener("keyup",(function(){TimeMe.resetIdleCountdown()})),document.addEventListener("touchstart",(function(){TimeMe.resetIdleCountdown()})),window.addEventListener("scroll",(function(){TimeMe.resetIdleCountdown()})),setInterval((function(){TimeMe.checkState()}),TimeMe.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function(websocketOptions){if(window.WebSocket&&websocketOptions){var websocketHost=websocketOptions.websocketHost;try{TimeMe.websocket=new WebSocket(websocketHost),window.onbeforeunload=function(event){TimeMe.sendCurrentTime(websocketOptions.appId)},TimeMe.websocket.onopen=function(){TimeMe.sendInitWsRequest(websocketOptions.appId)},TimeMe.websocket.onerror=function(error){console&&console.log("Error occurred in websocket connection: "+error)},TimeMe.websocket.onmessage=function(event){console&&console.log(event.data)}}catch(error){console&&console.error("Failed to connect to websocket host.  Error:"+error)}}return this},websocketSend:function(data){TimeMe.websocket.send(JSON.stringify(data))},sendCurrentTime:function(appId){var data={type:"INSERT_TIME",appId:appId,timeOnPageMs:TimeMe.getTimeOnCurrentPageInMilliseconds(),pageName:TimeMe.currentPageName};TimeMe.websocketSend(data)},sendInitWsRequest:function(appId){var data={type:"INIT",appId:appId};TimeMe.websocketSend(data)},initialize:function(options){var idleTimeoutInSeconds=TimeMe.idleTimeoutMs||30,currentPageName=TimeMe.currentPageName||"default-page-name",websocketOptions=void 0,initialStartTime=void 0;options&&(idleTimeoutInSeconds=options.idleTimeoutInSeconds||idleTimeoutInSeconds,currentPageName=options.currentPageName||currentPageName,websocketOptions=options.websocketOptions,initialStartTime=options.initialStartTime),TimeMe.setIdleDurationInSeconds(idleTimeoutInSeconds).setCurrentPageName(currentPageName).setUpWebsocket(websocketOptions).listenForVisibilityEvents(),TimeMe.startTimer(void 0,initialStartTime)}};return TimeMe},"undefined"!=typeof module&&module.exports?module.exports=factory():"function"==typeof define&&define.amd?define("block_learnerscript/timeme",[],(function(){return root.TimeMe=factory()})):root.TimeMe=factory()}).call(window);

//# sourceMappingURL=timeme.min.js.map