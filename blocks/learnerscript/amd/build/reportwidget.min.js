define("block_learnerscript/reportwidget",["jquery","core/ajax","block_learnerscript/report","block_learnerscript/smartfilter"],(function($,Ajax,report,smartfilter){return reportwidget={DashboardWidgets:function(args){var self=this,filterdata=(args=args||{container:".report_dashboard_container"},smartfilter.FilterData(args.reportid));$(".loader").show(),$(args.container).each((function(){var reportid=$(this).data("reportid"),blockinstance=$(this).data("blockinstance");if(""!=$(this).val()){blockinstance=$("#reportcontainer"+reportinstance).data("blockinstance");args.reporttype=$("#reporttype_"+blockinstance+"  :selected").val();var params={reportid:reportid,reporttype:args.reporttype};return $.extend(params,filterdata),self.CreateDashboardwidget(params),!1}args.reporttype=$("#reporttype_"+blockinstance+"  :selected").val(),void 0===args.reporttype&&(args.reporttype=$(this).data("reporttype")),self.CreateDashboardwidget({reportid:reportid,reporttype:args.reporttype,instanceid:blockinstance})}))},DashboardTiles:function(){var self=this;ls_fstartdate=$("#ls_fstartdate").val(),ls_fenddate=$("#ls_fenddate").val();var courseid=$("#ls_courseid").val(),onlinecourseid=$("#ls_onlinecourseid").val(),labid=$("#ls_labid").val(),assessmentid=$("#ls_assessmentid").val(),webinarid=$("#ls_webinarid").val(),classroomid=$("#ls_classroomid").val(),learningpathid=$("#ls_learningpathid").val();$(".tiles_information").each((function(){self.CreateDashboardTile({blockinstanceid:$(this).data("instanceid"),reportid:$(this).data("reportid"),reporttype:$(this).data("reporttype"),ls_fstartdate:ls_fstartdate,ls_fenddate:ls_fenddate,courseid:courseid,onlinecourseid:onlinecourseid,labid:labid,assessmentid:assessmentid,webinarid:webinarid,classroomid:classroomid,learningpathid:learningpathid})}))},CreateDashboardTile:function(args){$("#inst"+args.blockinstanceid+" .tiles_information table tr").html("");var reportinstance=args.blockinstanceid,filters={};if(filters.ls_fstartdate=$("#ls_fstartdate").val(),filters.ls_fenddate=$("#ls_fenddate").val(),void 0===filters.filter_organization){var filter_organization=$("#dashboardcostcenters").val();0!=filter_organization&&(filters.filter_organization=filter_organization)}if(void 0===filters.filter_departments){var filter_departments=$("#dashboarddepartment").val();0!=filter_departments&&(filters.filter_departments=filter_departments)}if(void 0===filters.filter_subdepartments){var filter_subdepartments=$("#dashboardsubdepartment").val();0!=filter_subdepartments&&(filters.filter_subdepartments=filter_subdepartments)}if(void 0===filters.filter_level4department){var filter_level4department=$("#dashboardl4department").val();0!=filter_level4department&&(filters.filter_level4department=filter_level4department)}if(void 0===filters.filter_level5department){var filter_level5department=$("#dashboardl5department").val();0!=filter_level5department&&(filters.filter_level5department=filter_level5department)}if(void 0===filters.filter_course){var filter_course=$("#coursedashboardfilter").val();0!=filter_course&&(filters.filter_course=filter_course)}if(void 0===filters.filter_onlinecourses){var filter_onlinecourses=$("#ls_onlinecourseid").val();0!=filter_onlinecourses&&(filters.filter_onlinecourses=filter_onlinecourses)}if(void 0===filters.filter_labs){var filter_labs=$("#ls_labid").val();0!=filter_labs&&(filters.filter_labs=filter_labs)}if(void 0===filters.filter_assessments){var filter_assessments=$("#ls_assessmentid").val();0!=filter_assessments&&(filters.filter_assessments=filter_assessments)}if(void 0===filters.filter_webinars){var filter_webinars=$("#ls_webinarid").val();0!=filter_webinars&&(filters.filter_webinars=filter_webinars)}if(void 0===filters.filter_classrooms){var filter_classrooms=$("#ls_classroomid").val();0!=filter_classrooms&&(filters.filter_classrooms=filter_classrooms)}if(void 0===filters.filter_learningpath){var filter_learningpath=$("#ls_learningpathid").val();0!=filter_learningpath&&(filters.filter_learningpath=filter_learningpath)}$.urlParam=function(name){var results=new RegExp("[?&]"+name+"=([^&#]*)").exec(window.location.href);return null===results||" "==results?null:results[1]||0};$.urlParam("dashboardurl");Ajax.call([{methodname:"block_learnerscript_generate_plotgraph",args:{instanceid:args.blockinstanceid,reportid:args.reportid,departmentid:args.filter_departments,subdepartmentid:args.filter_subdepartments,filters:JSON.stringify(filters),reporttype:args.reporttype},loading:"#reportloading_"+args.blockinstanceid}])[0].done((function(data){data=JSON.parse(data);var tabledata=[];if("table"!=args.reporttype)$.extend(data.plot,args),data.plot.container="#plotreportcontainer"+reportinstance,!0===data.plot.error?$("#plotreportcontainer"+reportinstance).html('<p class="alert alert-warning">'+data.plot.messages+"</p>"):0==data.plot.data.length?$(data.plot.container).html("<div class='alert alert-info'>Data Not Available.</div>"):(data.plot.reportinstance=reportinstance,require(["block_learnerscript/report"],(function(report){report.generate_plotgraph(data.plot)})));else if(void 0!==data.plot){let hiding=!1;if(data.plot.data.length>0)$(data.plot.data).each((function(key,value){[],tabledata=[],value.head,tabledata=value.data})),$(data.plot.categorydata).each((function(k,v){0==tabledata[0][k]&&(hiding=!0),1==data.plot.categorydata.length?isNaN(tabledata[0][k])?$("#inst"+args.blockinstanceid+" .tiles_information table tr").append("<td><h6> "+tabledata[0][k]+" </h6></td>"):$("#inst"+args.blockinstanceid+" .tiles_information table tr").append("<td><h1> "+tabledata[0][k]+" </h1></td>"):$("#inst"+args.blockinstanceid+" .tiles_information table tr").append("<td>"+v+"  <b> "+tabledata[k]+" </b></td>")}));else{$("#inst"+args.blockinstanceid+" .tiles_information table tr").html("<div class='alert alert-info'> No Data Available.</div>"),$("#inst"+args.blockinstanceid+" .dashboard_tiles").css("color","#4B4B4B")}$("#reportloading_"+args.blockinstanceid).css("display","none")}}))},CreateDashboardwidget:function(args){var reportinstance=args.instanceid||args.reportid;if(args.filters=smartfilter.FilterData(reportinstance),args.columnDefs="",args.filters.ls_fstartdate=$("#ls_fstartdate").val(),args.filters.ls_fenddate=$("#ls_fenddate").val(),void 0===args.filters.filter_organization){var filter_organization=$("#id_filter_organization").val();filter_organization>0&&(args.filters.filter_organization=filter_organization)}if(void 0===args.filters.filter_departments){var filter_departments=$("#id_filter_departments").val();filter_departments>0&&(args.filters.filter_departments=filter_departments)}if(void 0===args.filters.filter_subdepartments){var filter_subdepartments=$("#dashboardsubdepartment").val();filter_subdepartments>0&&(args.filters.filter_subdepartments=filter_subdepartments)}if(void 0===args.filters.filter_level4department){var filter_level4department=$("#dashboardl4department").val();0!=filter_level4department&&(args.filters.filter_level4department=filter_level4department)}if(void 0===args.filters.filter_level5department){var filter_level5department=$("#dashboardl5department").val();0!=filter_level5department&&(args.filters.filter_level5department=filter_level5department)}if(void 0===args.filters.filter_course){var filter_course=$("#coursedashboardfilter").val();0!=filter_course&&(args.filters.filter_course=filter_course)}if(void 0===args.filters.filter_onlinecourses){var filter_onlinecourses=$("#ls_onlinecourseid").val();0!=filter_onlinecourses&&(args.filters.filter_onlinecourses=filter_onlinecourses)}if(void 0===args.filters.filter_classrooms){var filter_classrooms=$("#ls_classroomid").val();0!=filter_classrooms&&(args.filters.filter_classrooms=filter_classrooms)}if(void 0===args.filters.filter_learningpath){var filter_learningpath=$("#ls_learningpathid").val();0!=filter_learningpath&&(args.filters.filter_learningpath=filter_learningpath)}"table"==args.reporttype||$(".plotgraphcontainer").removeClass("hide").addClass("show"),args.selectreport&&($("#reportcontainer"+reportinstance).attr("data-reporttype",args.reporttype),$("#plotreportcontainer"+reportinstance).attr("data-reporttype",args.reporttype),delete args.selectreport),args.filters=JSON.stringify(args.filters),args.action="generate_plotgraph",$(".download_menu"+reportinstance+" li a").each((function(index){var link=$(this).attr("href");if(void 0!==args.basicparams){var basicparamsdata=JSON.parse(args.basicparams);$.each(basicparamsdata,(function(key,value){0==key.indexOf("filter_")&&(link+="&"+key+"="+value)}))}if(void 0!==args.filters){var filters=JSON.parse(args.filters);$.each(filters,(function(key,value){0==key.indexOf("filter_")&&(link+="&"+key+"="+value),0==key.indexOf("ls_")&&(link+="&"+key+"="+value)}))}$(this).attr("href",link)})),args.basicparams=args.basicparams||JSON.stringify(smartfilter.BasicparamsData(reportinstance)),void 0!==args.reportdashboard&&void 0!==args.reporttype?($("#reportcontainer"+reportinstance).html(""),$("#plotreportcontainer"+reportinstance).html("")):void 0!==args.reportdashboard&&"table"==args.reporttype?$("#reportcontainer"+reportinstance).html(""):$("#plotreportcontainer"+reportinstance).html("");var promise=Ajax.call([{methodname:"block_learnerscript_generate_plotgraph",args:args,loading:"#reportloading_"+args.reportid}]);$("#reportloadingimage").length<=0&&("table"==args.reporttype?$("#reportcontainer"+args.reportid).prepend('<img src="'+M.util.image_url("loading","block_learnerscript")+'" id="reportloadingimage" />'):$("#plotreportcontainer"+args.reportid).prepend('<img src="'+M.util.image_url("loading","block_learnerscript")+'" id="reportloadingimage" />')),promise[0].done((function(chartdata){"table"==((chartdata=$.parseJSON(chartdata)).reporttype||args.reporttype)?void 0===chartdata.data&&chartdata.emptydata?$("#reportcontainer"+reportinstance).html(chartdata.tdata):($("#reporttable_"+args.reportid).length||$("#reportcontainer"+reportinstance).html(chartdata.tdata),$(document).ajaxStop((function(){$("#reportloadingimage").remove()})),args.columnDefs=chartdata.columnDefs,args.data=chartdata.data,args.reportname=chartdata.reportname,require(["block_learnerscript/report"],(function(report){report.ReportDatatable(args)}))):($.extend(chartdata.plot,args),chartdata.plot.container="#plotreportcontainer"+reportinstance,$(document).ajaxStop((function(){$("#reportloadingimage").remove()})),!0===chartdata.plot.error?$("#plotreportcontainer"+reportinstance).html('<p class="alert alert-warning">'+chartdata.plot.messages+"</p>"):chartdata.plot.data&&chartdata.plot.data.length>0?(chartdata.plot.reportinstance=reportinstance,require(["block_learnerscript/report"],(function(report){report.generate_plotgraph(chartdata.plot)}))):$(chartdata.plot.container).html('<p class="alert alert-warning">No data available</p>'))})).fail((function(ex){}))}}}));

//# sourceMappingURL=reportwidget.min.js.map