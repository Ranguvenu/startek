define("block_learnerscript/ajax",["jquery","core/config","core/log","core/modal_factory"],(function($,config,Log,ModalFactory){var unloading=!1,requestSuccess=function(response){if(null!==response)if(response.error){if(response.cap||response.debuginfo||response.errorcode){var msg=response.msg||response.error;ModalFactory.create({title:response.type||response.errorcode,body:"<p>"+msg+"</p>",footer:""}).done((function(modal){dialogue=modal,dialogue.show()}))}else Log.error(response.type+": "+response.msg);this.deferred.reject(response)}else void 0!==response?this.deferred.resolve(response):exception=new Error("missing response"),"undefined"!=typeof exception&&null!==exception&&this.deferred.reject(exception)},requestFail=function(jqXHR,textStatus,exception){unloading?(Log.error("Page unloaded."),Log.error(exception)):(Log.error("Page Not Responding."),Log.error(exception),this.deferred.reject(exception))};return{call:function(request,async,loginrequired){$(window).bind("beforeunload",(function(){unloading=!0}));var ajaxRequestData,promise;void 0===loginrequired&&(loginrequired=!0),void 0===async&&(async=!0),ajaxRequestData=request.args,request.deferred=$.Deferred(),promise=request.deferred.promise(),void 0!==request.done&&request.deferred.done(request.done),void 0!==request.fail&&request.deferred.fail(request.fail);var settings={type:"POST",data:ajaxRequestData=JSON.stringify(ajaxRequestData),context:request,dataType:"json",processData:!1,global:!0,async:async,contentType:"application/json",beforeSend:function(){request.loading&&$(request.loading).show()},success:function(){request.loading&&$(request.loading).hide("fast")}};return async?$.ajax(request.url+"?sesskey="+config.sesskey,settings).done(requestSuccess).fail(requestFail):(settings.success=requestSuccess,settings.error=requestFail,$.ajax(request.url+"?sesskey="+config.sesskey,settings)),promise}}}));

//# sourceMappingURL=ajax.min.js.map