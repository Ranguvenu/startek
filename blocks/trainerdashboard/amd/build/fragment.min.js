define("block_trainerdashboard/fragment",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","core/templates","core/notification","core/custom_interaction_events","block_trainerdashboard/trainerdashboard"],(function($,Str,ModalFactory,ModalEvents,fragment,Ajax,Y,Templates,Notification,CustomEvents,trainerdashboard){var SELECTORS_ELEMENT="[data-fg]",DATAATTRIBUTES_ELEFG="fg",DATAATTRIBUTES_PLUGIN="plugin",DATAATTRIBUTES_METHOD="method",DATAATTRIBUTES_PARAMS="params",DATAATTRIBUTES_TRIGGERTYPE="triggertype",DATAATTRIBUTES_JSONFORMDATA="jsonformdata",Fragment=function(fgelement){this.contextid=M.cfg.contextid,this.fgelement=fgelement,this.id=fgelement.data("id")||0,this.pluginname=fgelement.data(DATAATTRIBUTES_PLUGIN),this.method=fgelement.data(DATAATTRIBUTES_METHOD),this.level=fgelement.data(DATAATTRIBUTES_ELEFG),this.args={},this.args.contextid=this.contextid,this.args.id=this.id;var params={};void 0!==fgelement.data(DATAATTRIBUTES_PARAMS)&&(params=fgelement.data(DATAATTRIBUTES_PARAMS)),void 0!==fgelement.data(DATAATTRIBUTES_JSONFORMDATA)&&(this.args.jsonformdata=JSON.stringify(fgelement.data(DATAATTRIBUTES_JSONFORMDATA))),this.args.params=JSON.stringify(params),this.args.triggertype=fgelement.data(DATAATTRIBUTES_TRIGGERTYPE),this.init()};return Fragment.prototype.contextid=-1,Fragment.prototype.id=0,Fragment.prototype.level="c",Fragment.prototype.strings={},Fragment.prototype.args={},Fragment.prototype.init=function(){var self=this,stringsPromise=this.getStrings(),type=ModalFactory.types.SAVE_CANCEL;if("r"==self.level&&(type=ModalFactory.types.DEFAULT),"vmtotaltrainings"==self.level||"vmcmpltdtrainings"==self.level||"vmupcmngtrainings"==self.level)var modalPromise=ModalFactory.create({type:ModalFactory.types.DEFAULT,footer:this.getFooter()});else modalPromise=ModalFactory.create({type:type});$.when(stringsPromise,modalPromise).then(function(strings,modal){if(this.modal=modal,this.modal.setTitle(strings[0]),"r"==self.level)this.modal.setBody(this.getBody()),this.modal.setLarge(),this.modal.getRoot().on(ModalEvents.hidden,function(){this.modal.destroy()}.bind(this));else if("vmtotaltrainings"==self.level||"vmcmpltdtrainings"==self.level||"vmupcmngtrainings"==self.level)this.modal.setBody(this.getBody()),this.modal.setLarge(),this.modal.getRoot().on(ModalEvents.hidden,function(){this.modal.destroy()}.bind(this));else{if(self.modal.getRoot().addClass("openLMStransition"),this.modal.getRoot().on(ModalEvents.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500),setTimeout((function(){modal.destroy()}),1e3)}.bind(this)),this.modal.setBody(this.getBody()),this.modal.setLarge(),"c"==this.level)var submitlabel=strings[1];else if("u"==this.level)submitlabel=strings[1];this.modal.setSaveButtonText(submitlabel),this.modal.getRoot().on(ModalEvents.save,this.submitForm.bind(this)),this.modal.getRoot().on("submit","form",this.submitFormAjax.bind(this))}this.modal.show(),this.modal.getRoot().animate({right:"0%"},500)}.bind(this))},Fragment.prototype.getStrings=function(){var self=this,StringData=this.requiredStrings(),RequiredStrings=[],i=0;return $.each(StringData,(function(key,value){RequiredStrings[i]={key:key,component:self.pluginname,param:value},i++})),Str.get_strings(RequiredStrings)},Fragment.prototype.getBody=function(formdata){return void 0===formdata&&(formdata={}),this.custommethod=this.method,this.args.jsonformdata=JSON.stringify(formdata),fragment.loadFragment(this.pluginname,this.custommethod,this.contextid,this.args)},Fragment.prototype.getFooter=function(){return $footer='<button type="button" class="btn btn-secondary" data-action="cancel" style="display:none;">Close</button>','<button type="button" class="btn btn-secondary" data-action="cancel" style="display:none;">Close</button>'},Fragment.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),this.modal.destroy(),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()}));var PluginModule=require(this.pluginname+"/"+this.pluginname.split("_")[1]);"function"==typeof PluginModule.childform?PluginModule.childform(this):this.handleNotifications("success",{})},Fragment.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},Fragment.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();this.args.jsonformdata=JSON.stringify(formData),this.custommethod=this.method;var value=Ajax.call([{methodname:"blocks_trainerdashboard_"+this.custommethod,args:this.args,done:this.handleFormSubmissionResponse.bind(this,formData),fail:this.handleFormSubmissionFailure.bind(this,formData)}]),body=$('[data-region="body"]');if("pending"==value[0].state()){var height=body.innerHeight();height<100&&(height=100),body.animate({height:height+"px"},150),body.html(""),contentPromise=Templates.render("core/loading",{}).then((function(html){var loadingIcon=$(html).hide();return body.html(loadingIcon),loadingIcon.fadeIn(150),$.when(loadingIcon.promise(),value)})).then((function(loadingIcon){return loadingIcon.promise()})).then((function(){return value}))}},Fragment.prototype.submitForm=function(e){e.preventDefault(),this.modal.getRoot().find("form").submit()},Fragment.prototype.requiredStrings=function(){var StringData={},PluginModule=require(this.pluginname+"/"+this.pluginname.split("_")[1]);return"function"==typeof PluginModule.requiredStrings&&(StringData=PluginModule.requiredStrings(this)),this.strings=StringData,StringData},{init:function(){$(document).on("click",SELECTORS_ELEMENT,(function(e){e.preventDefault();var fgelement=$(this);new Fragment(fgelement)}))}}}));

//# sourceMappingURL=fragment.min.js.map