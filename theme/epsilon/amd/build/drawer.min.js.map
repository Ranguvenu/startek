{"version":3,"file":"drawer.min.js","sources":["../src/drawer.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Contain the logic for a drawer.\r\n *\r\n * @module theme_epsilon/drawer\r\n * @copyright  2016 Damyon Wiese\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\ndefine(['jquery', 'core/custom_interaction_events', 'core/log', 'core/pubsub', 'core/aria', 'core_user/repository'],\r\n     function($, CustomEvents, Log, PubSub, Aria, UserRepository) {\r\n\r\n    var SELECTORS = {\r\n        TOGGLE_REGION: '[data-region=\"drawer-toggle\"]',\r\n        TOGGLE_ACTION: '[data-action=\"toggle-drawer\"]',\r\n        TOGGLE_TARGET: 'aria-controls',\r\n        TOGGLE_SIDE: 'left',\r\n        BODY: 'body',\r\n        SECTION: '.list-group-item[href*=\"#section-\"]',\r\n        DRAWER: '#nav-drawer'\r\n    };\r\n\r\n    var small = $(document).width() < 768;\r\n\r\n    /**\r\n     * Constructor for the Drawer.\r\n     */\r\n    var Drawer = function() {\r\n\r\n        if (!$(SELECTORS.TOGGLE_REGION).length) {\r\n            Log.debug('Page is missing a drawer region');\r\n        }\r\n        if (!$(SELECTORS.TOGGLE_ACTION).length) {\r\n            Log.debug('Page is missing a drawer toggle link');\r\n        }\r\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\r\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\r\n            var drawerid = trigger.attr('aria-controls');\r\n            var drawer = $(document.getElementById(drawerid));\r\n            var hidden = trigger.attr('aria-expanded') == 'false';\r\n            var side = trigger.attr('data-side');\r\n            var body = $(SELECTORS.BODY);\r\n            var preference = trigger.attr('data-preference');\r\n            if (small) {\r\n                UserRepository.setUserPreference(preference, false);\r\n            }\r\n\r\n            drawer.on('mousewheel DOMMouseScroll', this.preventPageScroll);\r\n\r\n            if (!hidden) {\r\n                body.addClass('drawer-open-' + side);\r\n                trigger.attr('aria-expanded', 'true');\r\n            } else {\r\n                trigger.attr('aria-expanded', 'false');\r\n            }\r\n        }.bind(this));\r\n\r\n        this.registerEventListeners();\r\n        if (small) {\r\n            this.closeAll();\r\n        }\r\n    };\r\n\r\n    Drawer.prototype.closeAll = function() {\r\n        $(SELECTORS.TOGGLE_REGION).each(function(index, ele) {\r\n            var trigger = $(ele).find(SELECTORS.TOGGLE_ACTION);\r\n            var side = trigger.attr('data-side');\r\n            var body = $(SELECTORS.BODY);\r\n            var drawerid = trigger.attr('aria-controls');\r\n            var drawer = $(document.getElementById(drawerid));\r\n            var preference = trigger.attr('data-preference');\r\n\r\n            trigger.attr('aria-expanded', 'false');\r\n            body.removeClass('drawer-open-' + side);\r\n            Aria.hide(drawer.get());\r\n            drawer.addClass('closed');\r\n            if (!small) {\r\n                UserRepository.setUserPreference(preference, false);\r\n            }\r\n        });\r\n    };\r\n\r\n    /**\r\n     * Open / close the blocks drawer.\r\n     *\r\n     * @method toggleDrawer\r\n     * @param {Event} e\r\n     */\r\n    Drawer.prototype.toggleDrawer = function(e) {\r\n        var trigger = $(e.target).closest('[data-action=toggle-drawer]');\r\n        var drawerid = trigger.attr('aria-controls');\r\n        var drawer = $(document.getElementById(drawerid));\r\n        var body = $(SELECTORS.BODY);\r\n        var side = trigger.attr('data-side');\r\n        var preference = trigger.attr('data-preference');\r\n        if (small) {\r\n            UserRepository.setUserPreference(preference, false);\r\n        }\r\n\r\n        body.addClass('drawer-ease');\r\n        var open = trigger.attr('aria-expanded') == 'true';\r\n        if (!open) {\r\n            // Open.\r\n            trigger.attr('aria-expanded', 'true');\r\n            Aria.unhide(drawer.get());\r\n            drawer.focus();\r\n            body.addClass('drawer-open-' + side);\r\n            drawer.removeClass('closed');\r\n            if (!small) {\r\n                UserRepository.setUserPreference(preference, true);\r\n            }\r\n        } else {\r\n            // Close.\r\n            body.removeClass('drawer-open-' + side);\r\n            trigger.attr('aria-expanded', 'false');\r\n            drawer.addClass('closed').delay(500).queue(function() {\r\n                // Ensure that during the delay, the drawer wasn't re-opened.\r\n                if ($(this).hasClass('closed')) {\r\n                    Aria.hide(this);\r\n                }\r\n                $(this).dequeue();\r\n            });\r\n            if (!small) {\r\n                UserRepository.setUserPreference(preference, false);\r\n            }\r\n        }\r\n\r\n        // Publish an event to tell everything that the drawer has been toggled.\r\n        // The drawer transitions closed so another event will fire once teh transition\r\n        // has completed.\r\n        PubSub.publish('nav-drawer-toggle-start', open);\r\n    };\r\n\r\n    /**\r\n     * Prevent the page from scrolling when the drawer is at max scroll.\r\n     *\r\n     * @method preventPageScroll\r\n     * @param  {Event} e\r\n     */\r\n    Drawer.prototype.preventPageScroll = function(e) {\r\n        var delta = e.wheelDelta || (e.originalEvent && e.originalEvent.wheelDelta) || -e.originalEvent.detail,\r\n            bottomOverflow = (this.scrollTop + $(this).outerHeight() - this.scrollHeight) >= 0,\r\n            topOverflow = this.scrollTop <= 0;\r\n\r\n        if ((delta < 0 && bottomOverflow) || (delta > 0 && topOverflow)) {\r\n            e.preventDefault();\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set up all of the event handling for the modal.\r\n     *\r\n     * @method registerEventListeners\r\n     */\r\n    Drawer.prototype.registerEventListeners = function() {\r\n\r\n        $(SELECTORS.TOGGLE_ACTION).each(function(index, element) {\r\n            CustomEvents.define($(element), [CustomEvents.events.activate]);\r\n            $(element).on(CustomEvents.events.activate, function(e, data) {\r\n                this.toggleDrawer(data.originalEvent);\r\n                data.originalEvent.preventDefault();\r\n            }.bind(this));\r\n        }.bind(this));\r\n\r\n        $(SELECTORS.SECTION).click(function() {\r\n            if (small) {\r\n                this.closeAll();\r\n            }\r\n        }.bind(this));\r\n\r\n        // Publish an event to tell everything that the drawer completed the transition\r\n        // to either an open or closed state.\r\n        $(SELECTORS.DRAWER).on('webkitTransitionEnd msTransitionEnd transitionend', function(e) {\r\n            var drawer = $(e.target).closest(SELECTORS.DRAWER);\r\n            // Note: aria-hidden is either present, or absent. It should not be set to false.\r\n            var open = !!drawer.attr('aria-hidden');\r\n            PubSub.publish('nav-drawer-toggle-end', open);\r\n        });\r\n    };\r\n\r\n    return {\r\n        'init': function() {\r\n            return new Drawer();\r\n        }\r\n    };\r\n});\r\n"],"names":["define","$","CustomEvents","Log","PubSub","Aria","UserRepository","SELECTORS","small","document","width","Drawer","length","debug","each","index","ele","trigger","find","drawerid","attr","drawer","getElementById","hidden","side","body","preference","setUserPreference","on","this","preventPageScroll","addClass","bind","registerEventListeners","closeAll","prototype","removeClass","hide","get","toggleDrawer","e","target","closest","open","delay","queue","hasClass","dequeue","unhide","focus","publish","delta","wheelDelta","originalEvent","detail","bottomOverflow","scrollTop","outerHeight","scrollHeight","topOverflow","preventDefault","element","events","activate","data","click"],"mappings":"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"}