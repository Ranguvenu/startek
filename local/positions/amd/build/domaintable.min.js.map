{"version":3,"file":"domaintable.min.js","sources":["../src/domaintable.js"],"sourcesContent":["define([\r\n    'local_positions/jquery.dataTables',\r\n    'core/str',\r\n    'core/modal_factory',\r\n    'core/modal_events',\r\n    'core/ajax',\r\n    'core/fragment',\r\n    'jquery',\r\n    'jqueryui',\r\n], function (dataTable, Str, ModalFactory, ModalEvents, Ajax, Fragment, $) {\r\n    var Newdomain = function(args){\r\n            this.args = args;\r\n            var self = this;\r\n            self.init(args);\r\n        };\r\n\r\n        /**\r\n         * @var {Modal} modal\r\n         * @private\r\n         */\r\n        Newdomain.prototype.modal = null;\r\n     \r\n        /**\r\n         * @var {int} contextid\r\n         * @private\r\n         */\r\n        Newdomain.prototype.contextid = -1;\r\n\r\n        Newdomain.prototype.init = function(args) {\r\n            // console.log(args);\r\n            //var triggers = $(selector);\r\n            var self = this;\r\n            if(args.domainid){\r\n                var head = Str.get_string('editdomain', 'local_positions');\r\n            }else{\r\n                var head = Str.get_string('createdomain', 'local_positions');\r\n            }\r\n            return head.then(function(title) {\r\n                // Create the modal.\r\n                return ModalFactory.create({\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    title: title,\r\n                    body: self.getBody()\r\n                });\r\n            }.bind(self)).then(function(modal) {\r\n                    \r\n                // Keep a reference to the modal.\r\n                self.modal = modal;\r\n                // Forms are big, we want a big modal.\r\n                self.modal.setLarge();\r\n                this.modal.getRoot().addClass('openLMStransition local_positions');\r\n     \r\n                // We want to reset the form every time it is opened.\r\n                this.modal.getRoot().on(ModalEvents.hidden, function() {\r\n                    this.modal.getRoot().animate({\"right\":\"-85%\"}, 500);\r\n                    setTimeout(function(){\r\n                        modal.destroy();\r\n                    }, 100);\r\n                }.bind(this));\r\n                // self.modal.getRoot().on(ModalEvents.hidden, function() {\r\n                //     modal.hide();\r\n                //         setTimeout(function(){\r\n                //             modal.destroy();\r\n                //         }, 5000);\r\n                //     //     self.modal.setBody(self.getBody());\r\n                //     }.bind(this));\r\n                        self.modal.getRoot().on(ModalEvents.shown, function() {\r\n                        self.modal.getRoot().append('<style>[data-fieldtype=submit] { display: none ! important; }</style>');\r\n                        this.modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\r\n                            modal.hide();\r\n                            setTimeout(function(){\r\n                                modal.destroy();\r\n                            }, 100);\r\n                            // modal.destroy();\r\n                        });\r\n                    }.bind(this));\r\n        \r\n                    // We catch the modal save event, and use it to submit the form inside the modal.\r\n                    // Triggering a form submission will give JS validation scripts a chance to check for errors.\r\n                    self.modal.getRoot().on(ModalEvents.save, self.submitForm.bind(self));\r\n                    // We also catch the form submit event and use it to submit the form with ajax.\r\n                    self.modal.getRoot().on('submit', 'form', self.submitFormAjax.bind(self));\r\n                    self.modal.show();\r\n                    this.modal.getRoot().animate({\"right\":\"0%\"}, 500);\r\n                    return this.modal;\r\n                }.bind(this));       \r\n            \r\n            \r\n            // });\r\n            \r\n        };\r\n\r\n         /**\r\n         * @method getBody\r\n         * @private\r\n         * @return {Promise}\r\n         */\r\n        Newdomain.prototype.getBody = function(formdata) {\r\n            if (typeof formdata === \"undefined\") {\r\n                formdata = {};\r\n            }\r\n            // Get the content of the modal.\r\n            var params = {domainid:this.args.domainid, jsonformdata: JSON.stringify(formdata)};\r\n            return Fragment.loadFragment('local_positions', 'domain_form', this.args.contextid, params);\r\n        \r\n        };\r\n\r\n        /**\r\n         * @method handleFormSubmissionResponse\r\n         * @private\r\n         * @return {Promise}\r\n         */\r\n        Newdomain.prototype.handleFormSubmissionResponse = function() {\r\n            this.modal.hide();\r\n            // We could trigger an event instead.\r\n            // Yuk.\r\n            Y.use('moodle-core-formchangechecker', function() {\r\n                M.core_formchangechecker.reset_form_dirty_state();\r\n            });\r\n            document.location.reload();\r\n        };\r\n\r\n        /**\r\n         * @method handleFormSubmissionFailure\r\n         * @private\r\n         * @return {Promise}\r\n         */\r\n        Newdomain.prototype.handleFormSubmissionFailure = function(data) {\r\n            // Oh noes! Epic fail :(\r\n            // Ah wait - this is normal. We need to re-display the form with errors!\r\n            this.modal.setBody(this.getBody(data));\r\n        };\r\n        \r\n        /**\r\n         * Private method\r\n         *\r\n         * @method submitFormAjax\r\n         * @private\r\n         * @param {Event} e Form submission event.\r\n         */\r\n        Newdomain.prototype.submitFormAjax = function(e) {\r\n            // We don't want to do a real form submission.\r\n            e.preventDefault();\r\n     \r\n            // Convert all the form elements values to a serialised string.\r\n            var formData = this.modal.getRoot().find('form').serialize();\r\n            \r\n            // Now we can continue...\r\n            Ajax.call([{\r\n                methodname: 'local_positions_submit_domain_form',\r\n                args: {contextid: this.args.contextid, jsonformdata: formData},\r\n                done: this.handleFormSubmissionResponse.bind(this, formData),\r\n                fail: this.handleFormSubmissionFailure.bind(this, formData)\r\n            }]);\r\n        };\r\n\r\n        /**\r\n         * This triggers a form submission, so that any mform elements can do final tricks before the form submission is processed.\r\n         *\r\n         * @method submitForm\r\n         * @param {Event} e Form submission event.\r\n         * @private\r\n         */\r\n        Newdomain.prototype.submitForm = function(e) {\r\n            e.preventDefault();\r\n            var self = this;\r\n            self.modal.getRoot().find('form').submit();\r\n        };\r\n    return{\r\n        init: function(args){\r\n            return new Newdomain(args);\r\n        },\r\n        domaintable: function(){\r\n            // $(\"#all_domains_display_table\").dataTable({\r\n   //              \"processing\": true,\r\n   //              \"bServerSide\": true,\r\n   //              \"sAjaxSource\":M.cfg.wwwroot + \"/local/positions/ajax.php?action=getdomainstable\",\r\n   //              \"aaSorting\": [],\r\n   //              \"pageLength\": 10,\r\n   //          });\r\n   //          $(\"#all_domains_display_table\").css('width', '100%');\r\n            $('#all_domains_display_table').dataTable({\r\n                \"searching\": false,\r\n                //\"responsive\": true,\r\n                \"aaSorting\": [],\r\n                \"lengthMenu\": [[10, 20, 40,80,100, -1], [10,20,40, 80,100, \"All\"]],\r\n                \"aoColumnDefs\": [{ 'bSortable': false, 'aTargets': [ 0 ] }],\r\n                language: {\r\n                    search: \"_INPUT_\",\r\n                    searchPlaceholder: \"Search\",\r\n                    \"paginate\": {\r\n                        \"next\": \">\",\r\n                        \"previous\": \"<\"\r\n                    }\r\n                }       \r\n            });\r\n        },\r\n\r\n        deletedomain: function(args){\r\n            return Str.get_strings([{\r\n                key: 'confirm'\r\n            },\r\n            {\r\n                key: 'deletedomainconfirm',\r\n                component: 'local_positions',\r\n                param :args\r\n            },\r\n            {\r\n                key: 'delete'\r\n            }]).then(function(s) {\r\n                ModalFactory.create({\r\n                    title: s[0],\r\n                    type: ModalFactory.types.SAVE_CANCEL,\r\n                    body: s[1]\r\n                }).done(function(modal) {\r\n                    this.modal = modal;\r\n                    //modal.setSaveButtonText(s[2]);\r\n                    modal.setSaveButtonText(Str.get_string('yes_delete', 'local_positions'));\r\n\r\n\r\n                    //For cancel button string changed//\r\n                    var value=Str.get_string('cancel', 'local_positions');\r\n                    var button = this.modal.getFooter().find('[data-action=\"cancel\"]');\r\n                    this.modal.asyncSet(value, button.text.bind(button));\r\n                    \r\n                    modal.getRoot().on(ModalEvents.save, function(e) {\r\n                        e.preventDefault();\r\n                        args.confirm = true;\r\n                        $.ajax({\r\n                            method: \"POST\",\r\n                            dataType: \"json\",\r\n                            url: M.cfg.wwwroot + \"/local/positions/ajax.php?action=deletedomain&domainid=\"+args.domainid,\r\n                            success: function(data){\r\n                                window.location.href = M.cfg.wwwroot + \"/local/positions/domains.php\";\r\n                            }\r\n                        });\r\n                    }.bind(this));\r\n                    modal.show();\r\n                }.bind(this));\r\n            }.bind(this));\r\n\r\n        },\r\n    }\r\n});\r\n"],"names":["define","dataTable","Str","ModalFactory","ModalEvents","Ajax","Fragment","$","Newdomain","args","this","init","prototype","modal","contextid","self","domainid","head","get_string","then","title","create","type","types","SAVE_CANCEL","body","getBody","bind","setLarge","getRoot","addClass","on","hidden","animate","setTimeout","destroy","shown","append","getFooter","find","hide","save","submitForm","submitFormAjax","show","formdata","params","jsonformdata","JSON","stringify","loadFragment","handleFormSubmissionResponse","Y","use","M","core_formchangechecker","reset_form_dirty_state","document","location","reload","handleFormSubmissionFailure","data","setBody","e","preventDefault","formData","serialize","call","methodname","done","fail","submit","domaintable","language","search","searchPlaceholder","deletedomain","get_strings","key","component","param","s","setSaveButtonText","value","button","asyncSet","text","confirm","ajax","method","dataType","url","cfg","wwwroot","success","window","href"],"mappings":"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"}