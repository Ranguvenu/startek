/**
 * option selector module.
 *
 * @module     tool_lp/form-option-selector
 * @class      form-option-selector
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_positions/form-options-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var options=[];return $.each(results,(function(index,option){options.push({value:option.id,label:option._label})})),options},transport:function(selector,query,success,failure){action=$(selector).data("action"),formoptions=$(selector).data("options");var newselector=selector.replace("#","#fitem_");if(formoptions.selected=$(newselector+" .form-autocomplete-selection [role=listitem]").data("value"),"position_domain_selector"==action){if(null==formoptions.userorganization&&(formoptions.costcenterid=$('[data-class="'+$(selector).data("parentclass")+'"]').val()),!formoptions.costcenterid&&(formoptions.costcenterid=$("[data-class='"+formoptions.organizationselect+"']").val(),null==formoptions.costcenterid||""==formoptions.costcenterid)){var organizationfield="."+formoptions.organizationselect;formoptions.costcenterid=$(organizationfield+".form-autocomplete-selection [role=listitem]").data("value"),null!=formoptions.costcenterid&&""!=formoptions.costcenterid||(formoptions.costcenterid=formoptions.userorganization)}}else if("position_parent_selector"==action){if(!formoptions.costcenterid&&(formoptions.costcenterid=$("[data-class='"+formoptions.organizationselect+"']").val(),null==formoptions.costcenterid||""==formoptions.costcenterid)){organizationfield="."+formoptions.organizationselect;formoptions.costcenterid=$(organizationfield+".form-autocomplete-selection [role=listitem]").data("value"),null!=formoptions.costcenterid&&""!=formoptions.costcenterid||(formoptions.costcenterid=formoptions.userorganization)}if(formoptions.domain=$("[data-class='"+formoptions.domainselect+"']").val(),formoptions.domain=$("#domainselect").val(),null==formoptions.domain||""==formoptions.domain){var domainfield="."+formoptions.domainselect;formoptions.domain=$(domainfield+".form-autocomplete-selection [role=listitem]").data("value"),null!=formoptions.domain&&0!=formoptions.domain||(formoptions.domain=0)}}else"skill_selector_action"==action?formoptions.competencyid=$("#id_competencyid").val():"level_selector_action"==action&&(formoptions.competencyid=$("#id_competencyid").val(),formoptions.skillid=$("#id_skillid").val());formoptions=JSON.stringify(formoptions),Ajax.call([{methodname:"local_positions_form_option_selector",args:{query:query,context:{contextid:1},action:action,options:formoptions}}])[0].then((function(results){results=$.parseJSON(results);var promises=[],i=0;return $.each(results,(function(index,option){promises.push(Templates.render("local_costcenter/form-option-selector-suggestion",option))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,option){option._label=args[i],i++})),success(results)}))})).catch(failure)}}}));

//# sourceMappingURL=form-options-selector.min.js.map