{"version":3,"file":"forum.min.js","sources":["../src/forum.js"],"sourcesContent":["define([\n    'local_courses/jquery.dataTables',\n    'jquery','core/str','core/modal_factory', 'core/ajax'\n], function(DataTable, $,Str,ModalFactory, Ajax){\n    return courses = {\n        load : function() {\n        },\n        usersdatatable : function(args) {\n            params = [];\n            params.action = args.action;\n            params.courseid = args.courseid;\n\t\t\tStr.get_strings([{\n                key: 'search',\n                component: 'local_courses'\n            }, {\n                key: 'no_users_enrolled',\n                component: 'local_courses'\n            }]).then(function(s) {\n            var oTable = $('#course_users').dataTable({\n                'bInfo': false,\n                'processing': true,\n                'serverSide': true,\n                'ordering': false,\n                'ajax': {\n                    \"type\": \"POST\",\n                    \"url\": M.cfg.wwwroot + '/local/courses/ajax.php',\n                    \"data\": params\n                },\n                \"bLengthChange\": false,\n                \"language\": {\n                    \"paginate\": {\n                        \"next\": \">\",\n                        \"previous\": \"<\"\n                    },\n                    'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>'\n                },\n                \"oLanguage\": {\n                  \"sSearch\" : s[0],\n\t\t\t\t  \"sZeroRecords\": s[1]\n                },\n            });\n\t\t\t });\n        },\n        deleteuser: function(element) {\n          var enrollmentid = element.userid;\n          // console.log(element);\n            return Str.get_strings([{\n                key: 'deleteuser',\n                component: 'local_courses'\n            }, {\n                key: 'confirmdelete',\n                component: 'local_courses'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.DEFAULT,\n                    body: s[1],\n                    footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\n            '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\n                }).done(function(modal) {\n                    this.modal = modal;\n                     modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                        window.location.href ='enrolledusers.php?id='+element.id+'&ue='+element.userid+'&confirm=1&sesskey=' + M.cfg.sesskey;\n                    }.bind(this));\n                    modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                        modal.setBody('');\n                        modal.hide();\n                    });\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        subscribeuser: function(element) {\n            // console.log(element);\n              return Str.get_strings([{\n                  key: 'subscribeuser',\n                  component: 'local_forum'\n              }, {\n                  key: 'subscribeusermsg',\n                  component: 'local_forum',\n                  param: element\n              }]).then(function(s) {\n                  ModalFactory.create({\n                      title: s[0],\n                      type: ModalFactory.types.DEFAULT,\n                      body: s[1],\n                      footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\n              '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\n                  }).done(function(modal) {\n                      this.modal = modal;\n                       modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                        // params.id = userid;\n                        // params.forumid = forumid;\n                        // params.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_forum_' + element.action,\n                            args: element\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = M.cfg.wwwroot + '/course/view.php?id='+element.id;\n                           \n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        }); \n                      }.bind(this));\n                      modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                          modal.setBody('');\n                          modal.hide();\n                      });\n                      modal.show();\n                  }.bind(this));\n              }.bind(this));\n          },\n          unsubscribeuser: function(element) {\n            // console.log(element);\n              return Str.get_strings([{\n                  key: 'subscribeuser',\n                  component: 'local_forum'\n              }, {\n                  key: 'unsubscribeuser',\n                  component: 'local_forum'\n              }]).then(function(s) {\n                  ModalFactory.create({\n                      title: s[0],\n                      type: ModalFactory.types.DEFAULT,\n                      body: s[1],\n                      footer: '<button type=\"button\" class=\"btn btn-primary\" data-action=\"save\">'+M.util.get_string(\"yes\", \"moodle\")+'</button>&nbsp;' +\n              '<button type=\"button\" class=\"btn btn-secondary\" data-action=\"cancel\">'+M.util.get_string(\"no\", \"moodle\")+'</button>'\n                  }).done(function(modal) {\n                      this.modal = modal;\n                       modal.getRoot().find('[data-action=\"save\"]').on('click', function() {\n                        // params.id = userid;\n                        // params.forumid = forumid;\n                        // params.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_forum_' + element.action,\n                            args: element\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = M.cfg.wwwroot + '/local/forum/index.php';\n                           \n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        }); \n                      }.bind(this));\n                      modal.getFooter().find('[data-action=\"cancel\"]').on('click', function() {\n                          modal.setBody('');\n                          modal.hide();\n                      });\n                      modal.show();\n                  }.bind(this));\n              }.bind(this));\n          },\n    };\n    \n});"],"names":["define","DataTable","$","Str","ModalFactory","Ajax","courses","load","usersdatatable","args","params","action","courseid","get_strings","key","component","then","s","dataTable","M","cfg","wwwroot","deleteuser","element","userid","create","title","type","types","DEFAULT","body","footer","util","get_string","done","modal","getRoot","find","on","window","location","href","id","sesskey","bind","this","getFooter","setBody","hide","show","subscribeuser","param","call","methodname","resp","fail","ex","console","log","unsubscribeuser"],"mappings":"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"}