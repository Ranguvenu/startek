/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package    core_group
 * @copyright  2017 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_program/program",["local_program/jquery.dataTables","core/str","core/modal_factory","core/modal_events","core/ajax","jquery","jqueryui"],(function(dataTable,Str,ModalFactory,ModalEvents,Ajax,$){return{init:function(args){this.AssignUsers(args)},programDatatable:function(args){params=[],params.action="viewprograms",params.programstatus=args.programstatus,params.costcenterid=args.selectedcostcenterid,params.departmentid=args.selecteddepartmentid,params.subdepartmentid=args.selectedsubdepartmentid,params.l4department=args.selectedl4department,params.l5department=args.selectedl5department,params.program=args.selectedprogram,params.status=args.selectedstatus,params.categories=args.selectedcategories,params.view_type=args.formattype,Str.get_string("search","local_program").then((function(s){if("table"===params.view_type)$("#viewprograms_table").dataTable({bInfo:!1,processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},bInfo:!1,bLengthChange:!1,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},oLanguage:{sSearch:s},pageLength:10});if("card"===params.view_type)$("#viewprograms").dataTable({bInfo:!1,processing:!0,serverSide:!0,ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},bInfo:!1,bLengthChange:!1,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>"},oLanguage:{sSearch:s},pageLength:6})}))},CoursesDatatable:function(args){params=[],params.action="viewprogramcourses",params.programid=$("#viewprogramcourses").data("programid");$("#viewprogramcourses").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},UsersDatatable:function(args){params=[],params.action="viewprogramusers",params.programid=$("#viewprogramusers").data("programid");$("#viewprogramusers").dataTable({processing:!0,serverSide:!0,language:{paginate:{next:">",previous:"<"},processing:"<img src="+M.cfg.wwwroot+"/local/ajax-loader.svg>",search:"",searchPlaceholder:"Search"},ajax:{type:"POST",url:M.cfg.wwwroot+"/local/program/ajax.php",data:params},responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},deleteConfirm:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:"deleteconfirm",component:"local_program",param:args.programname},{key:"deleteallconfirm",component:"local_program",param:args.levelname},{key:"yes"},{key:"deletecourseconfirm",component:"local_program"},{key:"cannotdeleteall",component:"local_program"},{key:"cannotdeletelevel",component:"local_program"},{key:"inactiveconfirm",component:"local_program",param:args.programname},{key:"activeconfirm",component:"local_program",param:args.programname}]).then(function(s){if("deleteprogram"==args.action){s[1]=s[1];var confirm=ModalFactory.types.SAVE_CANCEL}else if("deleteprogramcourse"==args.action){s[1]=s[4];confirm=ModalFactory.types.SAVE_CANCEL}else if("cannotdeleteprogram"==args.action){s[1]=s[5];confirm=ModalFactory.types.DEFAULT}else if("cannotdeletelevel"==args.action){s[1]=s[7];confirm=ModalFactory.types.DEFAULT}else if("inactiveprogram"==args.action){s[1]=s[8];confirm=ModalFactory.types.SAVE_CANCEL}else if("activeprogram"==args.action){s[1]=s[9];confirm=ModalFactory.types.SAVE_CANCEL}else{s[1]=s[2];confirm=ModalFactory.types.SAVE_CANCEL}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotdeleteprogram"!=args.action&&"cannotdeletelevel"!=args.action&&modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_"+args.action,args:args}])[0].done((function(resp){"deleteprogram"==args.action||"activeprogram"==args.action||"inactiveprogram"==args.action?window.location.href=window.location.href:window.location.href=M.cfg.wwwroot+"/local/program/view.php?bcid="+args.programid})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},AssignUsers:function(args){$(".usersselect").click((function(){var type=$(this).data("id");"removeselect"===type?($("input#remove").prop("disabled",!1),$("input#add").prop("disabled",!0)):"addselect"===type&&($("input#remove").prop("disabled",!0),$("input#add").prop("disabled",!1)),$(this).hasClass("select_all")?$("#"+type+" option").prop("selected",!0):$(this).hasClass("remove_all")&&$("#"+type).val("").trigger("change")}))},programStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program"},{key:"yes"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_"+args.action,args:args}])[0].done((function(resp){window.location.href=window.location.href})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},ManageprogramStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_program"},{key:args.actionstatusmsg,component:"local_program",param:args.programname},{key:"deleteallconfirm",component:"local_program"},{key:"yes"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_program_manageprogramStatus",args:args}])[0].done((function(resp){window.location.href=M.cfg.wwwroot+"/local/program/view.php?bcid="+args.programid})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},load:function(){$(document).on("click","#id_institute_type_1, #id_institute_type_2",(function(){$("#fitem_id_instituteid .form-autocomplete-selection .badge.badge-info").trigger("click"),$("#fitem_id_roomid .form-autocomplete-selection .badge.badge-info").trigger("click")}))},unassignCourses:function(args){return Str.get_strings([{key:"confirm"},{key:"unassign_courses_confirm",component:"local_program",param:args},{key:"unassign",component:"local_program"},{key:"cannotunassign_courses_confirm",component:"local_program"}]).then(function(s){if("unassign_course"==args.action){s[1]=s[1];var confirm=ModalFactory.types.SAVE_CANCEL}else if("cannotunassign_course"==args.action){s[1]=s[3];confirm=ModalFactory.types.DEFAULT}else{s[1]=s[1];confirm=ModalFactory.types.SAVE_CANCEL}ModalFactory.create({title:s[0],type:confirm,body:s[1]}).done(function(modal){this.modal=modal,"cannotunassign_course"!=args.action&&modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),params={},params.programid=args.bcid,params.levelid=args.levelid,params.bclcid=args.bclcid,Ajax.call([{methodname:"local_program_"+args.action,args:params}])[0].done((function(resp){window.location.href=window.location.href})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this)),modal.show()}.bind(this))},unEnrolUser:function(args){return Str.get_strings([{key:"confirm"},{key:"program_self_unenrolment",component:"local_program",param:args.programname}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[0]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault();var params={};params.userid=args.userid,params.programid=args.programid,params.contextid=args.contextid,Ajax.call([{methodname:"local_program_unenrol_user",args:params}])[0].done((function(resp){window.location.href=M.cfg.wwwroot})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))}}}));

//# sourceMappingURL=program.min.js.map