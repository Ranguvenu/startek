{"version":3,"file":"form-options-selector.min.js","sources":["../src/form-options-selector.js"],"sourcesContent":["/*\n* This file is a part of e abyas Info Solutions.\n*\n* Copyright e abyas Info Solutions Pvt Ltd, India.\n*\n* This program is free software; you can redistribute it and/or modify\n* it under the terms of the GNU General Public License as published by\n* the Free Software Foundation; either version 3 of the License, or\n* (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU General Public License for more details.\n*\n* You should have received a copy of the GNU General Public License\n* along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*\n* @author e abyas  <info@eabyas.com>\n*/\n/**\n * Defines form autocomplete (types of form element)\n *\n * @package    local_challenge\n * @copyright  e abyas  <info@eabyas.com>\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/str'], function($, Ajax, Templates, Str) {\n\n    /** @var {Number} Maximum number of options to show. */\n    var MAXOPTIONS = 100;\n\n    return /** @alias module:enrol_manual/form-potential-option-selector */ {\n\n        processResults: function(selector, results) {\n            var options = [];\n            if ($.isArray(results)) {\n                $.each(results, function(index, option) {\n                    options.push({\n                        value: option.id,\n                        label: option._label\n                    });\n                });\n                return options;\n\n            } else {\n                return results;\n            }\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n            contextid = parseInt($(selector).data('contextid'), 10);\n            action = $(selector).data('action');\n            formoptions = $(selector).data('options');\n            var defaultstrings = Str.get_strings([\n                {\n                    key:'selectusers',\n                    component: 'local_challenge',\n                }\n            ]);\n            defaultstrings.then(function(s){\n                var userselect = '<span><span>'+s[0]+'</span></span>';\n            });\n            formoptions = JSON.stringify(formoptions);\n\n            promise = Ajax.call([{\n                methodname: 'local_challenge_form_option_selector',\n                args: {\n                    query: query,\n                    context: {contextid: contextid},\n                    action: action,\n                    options: formoptions,\n                    searchanywhere: true,\n                    page: 0,\n                    perpage: MAXOPTIONS + 1\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                results = $.parseJSON(results);\n                var promises = [],\n                    i = 0;\n                var contexttemplate;\n                contexttemplate = 'local_challenge/form-option-selector-suggestion';\n                    \n                if (results.length <= MAXOPTIONS) {\n                    // Render the label.\n                    $.each(results, function(index, option) {\n                        var ctx = option,\n                            identity = [];\n                            ctx.hasidentity = true;\n                        ctx.identity = identity.join(', ');\n                        promises.push(Templates.render(contexttemplate, ctx));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, option) {\n                            option._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                        return;\n                    });\n\n                } else {\n                    return Str.get_string('toomanyoptionstoshow', 'local_costcenter', '>' + MAXOPTIONS).then(function(toomanyoptionstoshow) {\n                        success(toomanyoptionstoshow);\n                        return;\n                    });\n                }\n\n            }).fail(failure);\n        }\n\n    };\n\n});\n"],"names":["define","$","Ajax","Templates","Str","processResults","selector","results","options","isArray","each","index","option","push","value","id","label","_label","transport","query","success","failure","contextid","parseInt","data","action","formoptions","get_strings","key","component","then","s","JSON","stringify","call","methodname","args","context","searchanywhere","page","perpage","MAXOPTIONS","parseJSON","promises","i","length","ctx","hasidentity","identity","join","render","when","apply","arguments","get_string","toomanyoptionstoshow","fail"],"mappings":"AA2BAA,+CAAO,CAAC,SAAU,YAAa,iBAAkB,aAAa,SAASC,EAAGC,KAAMC,UAAWC,WAKf,CAEpEC,eAAgB,SAASC,SAAUC,aAC3BC,QAAU,UACVP,EAAEQ,QAAQF,UACVN,EAAES,KAAKH,SAAS,SAASI,MAAOC,QAC5BJ,QAAQK,KAAK,CACTC,MAAOF,OAAOG,GACdC,MAAOJ,OAAOK,YAGfT,SAGAD,SAIfW,UAAW,SAASZ,SAAUa,MAAOC,QAASC,SAE1CC,UAAYC,SAAStB,EAAEK,UAAUkB,KAAK,aAAc,IACpDC,OAASxB,EAAEK,UAAUkB,KAAK,UAC1BE,YAAczB,EAAEK,UAAUkB,KAAK,WACVpB,IAAIuB,YAAY,CACjC,CACIC,IAAI,cACJC,UAAW,qBAGJC,MAAK,SAASC,GACOA,EAAE,MAEtCL,YAAcM,KAAKC,UAAUP,aAEnBxB,KAAKgC,KAAK,CAAC,CACjBC,WAAY,uCACZC,KAAM,CACFjB,MAAOA,MACPkB,QAAS,CAACf,UAAWA,WACrBG,OAAQA,OACRjB,QAASkB,YACTY,gBAAgB,EAChBC,KAAM,EACNC,QAASC,QAIT,GAAGX,MAAK,SAASvB,SACrBA,QAAUN,EAAEyC,UAAUnC,aAClBoC,SAAW,GACXC,EAAI,QAEU,kDAEdrC,QAAQsC,QAxDP,KA0DD5C,EAAES,KAAKH,SAAS,SAASI,MAAOC,YACxBkC,IAAMlC,OAENkC,IAAIC,aAAc,EACtBD,IAAIE,SAFW,GAESC,KAAK,MAC7BN,SAAS9B,KAAKV,UAAU+C,OATd,kDASsCJ,SAI7C7C,EAAEkD,KAAKC,MAAMnD,EAAEkD,KAAMR,UAAUb,MAAK,eACnCM,KAAOiB,UACXpD,EAAES,KAAKH,SAAS,SAASI,MAAOC,QAC5BA,OAAOK,OAASmB,KAAKQ,GACrBA,OAEJxB,QAAQb,aAKLH,IAAIkD,WAAW,uBAAwB,mBAAoB,QAAkBxB,MAAK,SAASyB,sBAC9FnC,QAAQmC,4BAKjBC,KAAKnC"}