/**
 *
 * @module     local_challenge/challenge
 * @class      challenge
 * @package    local_challenge
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_challenge/challenge",["jquery","core/ajax","core/templates","core/fragment","core/str","core/modal_factory","core/modal_events","core/notification"],(function($,Ajax,Templates,Fragment,Str,ModalFactory,ModalEvents,Notification){var challenge=function(args){this.args=args;var self=this;Str.get_string(args.type,"local_challenge");return Str.get_strings([{key:args.type,component:"local_challenge"},{key:"cancel",component:"moodle"}]).then(function(string){return ModalFactory.create({type:ModalFactory.types.DEFAULT,title:string[0],body:this.getBody(),footer:this.getFooter(string)})}.bind(this)).then(function(modal){return this.modal=modal,this.modal.setLarge(),this.modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}.bind(this)),this.modal.getFooter().find('[data-action="save"]').on("click",this.submitForm.bind(this)),this.modal.getFooter().find('[data-action="cancel"]').on("click",function(){modal.hide(),modal.destroy()}.bind(this)),this.modal.getRoot().on("submit","form",(function(form){self.submitFormAjax(form,self.args)})),this.modal.show(),this.modal}.bind(this))};challenge.prototype.getBody=function(formdata){return void 0===formdata&&(formdata={}),this.args.jsonformdata=JSON.stringify(formdata),Fragment.loadFragment("local_challenge","challenge_module",this.args.contextid,this.args)},challenge.prototype.getFooter=function(string){return $footer='<button type="button" class="btn btn-primary" data-action="save">'+string[0]+"</button>&nbsp;",$footer+='<button type="button" class="btn btn-secondary" data-action="cancel">'+string[1]+"</button>",$footer},challenge.prototype.submitForm=function(e){e.preventDefault();this.modal.getRoot().find("form").submit()},challenge.prototype.submitFormAjax=function(e,args){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize(),params={};params.contextid=this.args.contextid,params.jsonformdata=JSON.stringify(formData);Ajax.call([{methodname:"local_challenge_post_challenge",args:params,done:this.handleFormSubmissionResponse.bind(this,formData),fail:this.handleFormSubmissionFailure.bind(this,formData)}])},challenge.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),Str.get_strings([{key:"success",component:"local_challenge"}]).then((function(string){Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),Notification.addNotification({message:string[0],type:"success"}),setTimeout((function(){window.location.reload()}),1e3)}))},challenge.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))};var alter_status=function(args){Str.get_strings([{key:"confirm"},{key:"challenge_confirm_"+args.action,component:"local_challenge",param:args},{key:args.action,component:"local_challenge"},{key:"success",component:"local_challenge"}]).then(function(string){ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:string[0],body:string[1]}).then(function(modal){this.modal=modal,this.modal.show(),this.modal.setSaveButtonText(string[2]),this.modal.getRoot().on(ModalEvents.hidden,function(){modal.destroy()}.bind(this)),this.modal.getRoot().on(ModalEvents.save,(function(e){var params={};params.contextid=args.contextid,params.challengeid=args.challengeid,params.newstatus=args.newstatus;var promise=Ajax.call([{methodname:"local_challenge_alter_challenge_status",args:params}]);promise[0].done((function(resp){Notification.addNotification({message:string[3],type:"success"}),setTimeout((function(){window.location.reload()}),1e3)})),promise[0].fail((function(resp){Notification.addNotification({message:"Cannot process",type:"error"}),setTimeout((function(){window.location.reload()}),1e3)}))}))}.bind(this))}.bind(this))};return{init:function(){$(document).on("click",".challenge_trigger_element",(function(){var args=$(this).data();return new challenge(args)})),$(document).on("click",".challenge_status_trigger",(function(){var args=$(this).data();return new alter_status(args)}))}}}));

//# sourceMappingURL=challenge.min.js.map