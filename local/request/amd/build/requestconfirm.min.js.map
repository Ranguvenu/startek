{"version":3,"file":"requestconfirm.min.js","sources":["../src/requestconfirm.js"],"sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     local_request/requestconfirm\n * @class      requestconfirm\n * @package    local_costcenter\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/str',\n        'core/modal_factory',\n        'core/modal_events',\n        'core/fragment',\n        'core/ajax',\n        'core/yui',\n        'local_request/jquery.dataTables'],\n        function($, Str, ModalFactory, ModalEvents, Fragment, Ajax, Y, dataTable) {\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector used to find triggers for the new group modal.\n     * @param {int} contextid\n     *\n     * Each call to init gets it's own instance of this class.\n     */\n    var requestconfirm = function(args) {\n         \n        this.componentid = args.componentid;\n        this.component = args.component;\n        this.id =args.id;\n        this.action =args.action;\n   \n       // var self = this;\n        this.init(args);\n    };\n\n    /**\n     * @var {Modal} modal\n     * @private\n     */\n    requestconfirm.prototype.modal = null;\n\n    /**\n     * @var {int} contextid\n     * @private\n     */\n    requestconfirm.prototype.contextid = -1;\n\n\n    requestconfirm.prototype.getrequeststring = function(){\n\n        return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'request_confirm_message',\n                component: 'local_request',\n                param :args\n            },\n            {\n                key: 'confirm'\n            }]) ;\n    };\n\n\n    requestconfirm.prototype.handleModalSubmissionResponse = function(data,modal, args){\n      \n        if(data==0){\n            var msg=Str.get_string('alreadyrequested', 'local_request');\n        }\n        else if(data==-1){\n            var msg=Str.get_string('capacity_check', 'local_request');\n        }\n        else{\n            var msg=Str.get_string('success_'+args.action, 'local_request');\n        }\n        if(args.action==\"approve\" && args.component=='Classroom'){\n            if(data <1 || data==''){\n\t\t        modal.setTitle(Str.get_string('information', 'local_request'));\n                modal.setBody(msg);\n                modal.getFooter().find('[data-action=\"cancel\"], [data-action=\"save\"]').hide();\n            }else{\n                this.modal.hideFooter();\n                modal.setBody(data);\n                modal.setTitle(Str.get_string('information', 'local_request'));\n                $('[data-action=\"hide\"]').css('display','block');\n            }\n        }else if(args.action==\"approve\" && args.component=='Certification'){ \n            \n                modal.setTitle(Str.get_string('information', 'local_request'));\n                modal.setBody(msg);\n                modal.getFooter().find('[data-action=\"cancel\"], [data-action=\"save\"]').hide();\n            \n        }else if(args.action!='add'){\n          window.location.reload();\n        }else{\n            modal.setBody(msg);\n            //modal.getFooter().find('.modal-body button').hide();\n            modal.getFooter().find('[data-action=\"cancel\"], [data-action=\"save\"]').hide();\n        }\n        $(\".close\").click(function(){\n              location.reload();\n\n        });\n         //window.location = $(this).attr('href');\n    }; /* end of function */\n\n    \n    requestconfirm.prototype.submitajax = function(args, modal){\n\n            this.modal = modal;\n            userid = args.userid;\n            if(args.action == 'approve'){\n                modal.setSaveButtonText(Str.get_string('approve', 'local_request')); \n            }else if(args.action == 'deny'){\n                modal.setSaveButtonText(Str.get_string('reject', 'local_request')); \n            }else if(args.action == 'delete'){\n                modal.setSaveButtonText(Str.get_string('delete', 'local_request')); \n            }else{\n                modal.setSaveButtonText(Str.get_string('confirm', 'local_request')); \n            }\n            modal.getRoot().on(ModalEvents.save, function(e) {\n            e.preventDefault();\n                args.confirm = true;\n            $.ajax({\n                method: \"POST\",\n                dataType: \"json\",\n                url: M.cfg.wwwroot + \"/local/request/ajax.php\",\n                data: { component: args.component, componentid: args.componentid, action :args.action, id:args.id}\n              \n            }).done(function(response){\n              requestconfirm.prototype.handleModalSubmissionResponse(response, modal, args);\n\n            })\n          \n        });\n    };\n\n    requestconfirm.prototype.getbodystring= function(args){\n       \n       var string ='';\n       if(args.component == 'learningplan'){\n            args.component = 'Learning path';\n       }\n       if(args.action && args.component){\n        var string= Str.get_string('confirmmsgfor_'+args.action, 'local_request', args);\n       }\n\n     return string;\n    }; \n    \n    requestconfirm.prototype.init = function(args) { \n        var deferred = $.Deferred();\n        this.action = args.action;\n        var componentid = args.componentid;\n        var userid = args.userid;\n        var component = args.component;\n         \n        ModalFactory.create({\n            title: 'Confirm',\n            type: ModalFactory.types.SAVE_CANCEL,\n            body: requestconfirm.prototype.getbodystring(args)       \n        }).done(function(modal) {\n            requestconfirm.prototype.submitajax(args, modal);\n            modal.show();\n        });\n\n\n     \n              \n    }; /* end of iit function */\n\n\n\n    /**\n     * Initialise the class.\n     *\n     * @param {String} selector used to find triggers for the new group modal.\n     * @private\n     * @return {Promise}\n     */\n    requestconfirm.prototype.init11 = function(args) {        \n        \n            var componentid = args.componentid;\n            var userid = args.userid;\n            var component = args.component;\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'request_confirm_message',\n                component: 'local_request',\n                param :args\n            },\n            {\n                key: 'confirm'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL ,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[2]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        // args.confirm = true;\n                        $.ajax({\n                            method: \"GET\",\n                            dataType: \"json\",\n                            url: M.cfg.wwwroot + \"/local/request/ajax.php?component='\"+args.component+\"'&componentid=\"+componentid+\"&userid=\"+userid,\n                            success: function(data){\n                       \n                                if(data==0){\n                                     var msg=Str.get_string('alreadyrequested', 'local_request');\n                                }\n                                else{\n                                    var msg=Str.get_string('requestsent', 'local_request');\n                                }\n\n                                modal.setBody(msg);\n                                //modal.getFooter().find('.modal-body button').hide();\n                                modal.getFooter().find('[data-action=\"cancel\"], [data-action=\"save\"]').hide();\n                               // modal.destroy();\n                                //window.location.href = window.location.href;\n                                    $(\".close\").click(function(){\n                                            location.reload();\n                                    });\n                            }\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        \n    };\n\n  \n\n    return /** @alias module:local_costcenter/newcostcenter */ {\n        // Public variables and functions.\n        /**\n         * Attach event listeners to initialise this module.\n         *\n         * @method init\n         * @param {string} selector The CSS selector used to find nodes that will trigger this module.\n         * @param {int} contextid The contextid for the course.\n         * @return {Promise}\n         */\n        init: function( args) {            \n            // alert(args.contextid);\n            return new requestconfirm(args);\n        },\n\n        requestDatatable: function() {\n            params = [];\n            params.action = 'viewrequest';\n            params.classroomid = $('#viewrequest').data('classroomid');\n            var oTable = $('#viewrequest').dataTable({\n                'processing': false,\n                'serverSide': false,\n                \"language\": {\n                    \"paginate\": {\n                    \"next\": \">\",\n                    \"previous\": \"<\"\n                    },\n                    \"search\": \"\",\n                    \"searchPlaceholder\": \"Search\"\n                },\n                \"sorting\": false,\n                \"responsive\": true,\n                \"pageLength\": 5,\n                \"bLengthChange\": false,\n                \"bInfo\" : false,\n            });\n        }, \n\n        load: function(){\n\n        },\n\n    };\n});\n        /*publishLearningplan: function(args){\n            console.log(args);\n            var planvalue = args.planid;\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'learningplan_enrol_users',\n                component: 'local_learningplan',\n                param :args\n            },\n            {\n                key: 'confirmall',\n                component: 'local_learningplan'\n            },\n            {\n                key: 'confirm'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[3]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        // args.confirm = true;\n                        $.ajax({\n                            method: \"GET\",\n                            dataType: \"json\",\n                            url: M.cfg.wwwroot + \"/local/learningplan/ajax.php?action=publishlearningplan&planid=\"+planvalue,\n                            success: function(data){\n                                modal.destroy();\n                                window.location.href = window.location.href;\n                            }\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        tabsFunction: function(args){\n            // console.log(args);\n            // alert(args.id);\n            $('.learningplan_tabs').click(function(){\n                if ($(this).find('a').hasClass('active')){\n                    return true;\n                }\n                var mylink = this;\n                console.log(mylink);\n                var learningplantab = $(this).data('module');\n                var id = $(this).data('id');\n                // console.log(id);\n                // alert(id);\n                $.ajax({\n                    method: 'GET',\n                    // dataType: \"json\",\n                    url: M.cfg.wwwroot + '/local/learningplan/ajax.php',\n                    data: {\n                        action: \"learningplantab\",\n                        tab: learningplantab,\n                        id: id\n                    },\n                    success:function(resp){\n                        var html = $.parseJSON(resp);\n                        $('#learningplantabscontent').html(html);\n                        $('#learningplantabscontent').find('div').addClass('active');\n                        if(learningplantab == 'users'){\n                            $(\"table#learning_plan_users\").dataTable({\n                                language: {\n                                    \"paginate\": {\n                                        \"next\": \">\",\n                                        \"previous\": \"<\"\n                                    },\n                                    \"search\": \"\",\n                                    \"searchPlaceholder\": \"Search\"\n                                }\n                            });\n                        }\n                        // console.log(mylink);\n                    }\n                });\n            });\n        },\n        enrolUser : function(args){\n            // console.log(args);\n            // alert('here');\n            var planvalue = args.planid;\n            var userid = args.userid;\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'learningplan_self_enrol',\n                component: 'local_learningplan',\n                param :args\n            },\n            {\n                key: 'confirm'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[2]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        // args.confirm = true;\n                        $.ajax({\n                            method: \"GET\",\n                            dataType: \"json\",\n                            url: M.cfg.wwwroot + \"/local/learningplan/ajax.php?action=userselfenrol&planid=\"+planvalue+\"&userid=\"+userid,\n                            success: function(data){\n                                modal.destroy();\n                                window.location.href = window.location.href;\n                            }\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        }, */\n"],"names":["define","$","Str","ModalFactory","ModalEvents","Fragment","Ajax","Y","dataTable","requestconfirm","args","componentid","component","id","action","init","prototype","modal","contextid","getrequeststring","get_strings","key","param","handleModalSubmissionResponse","data","msg","get_string","setTitle","setBody","getFooter","find","hide","hideFooter","css","window","location","reload","click","submitajax","userid","setSaveButtonText","getRoot","on","save","e","preventDefault","confirm","ajax","method","dataType","url","M","cfg","wwwroot","done","response","getbodystring","string","Deferred","create","title","type","types","SAVE_CANCEL","body","show","init11","then","s","success","bind","this","requestDatatable","params","classroomid","load"],"mappings":"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"}