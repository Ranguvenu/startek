/**
 * Add a create new group modal to the page.
 *
 * @module     local_request/requestconfirm
 * @class      requestconfirm
 * @package    local_costcenter
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_request/requestconfirm",["jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","local_request/jquery.dataTables"],(function($,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y,dataTable){var requestconfirm=function(args){this.componentid=args.componentid,this.component=args.component,this.id=args.id,this.action=args.action,this.init(args)};return requestconfirm.prototype.modal=null,requestconfirm.prototype.contextid=-1,requestconfirm.prototype.getrequeststring=function(){return Str.get_strings([{key:"confirm"},{key:"request_confirm_message",component:"local_request",param:args},{key:"confirm"}])},requestconfirm.prototype.handleModalSubmissionResponse=function(data,modal,args){if(0==data)var msg=Str.get_string("alreadyrequested","local_request");else if(-1==data)msg=Str.get_string("capacity_check","local_request");else msg=Str.get_string("success_"+args.action,"local_request");"approve"==args.action&&"Classroom"==args.component?data<1||""==data?(modal.setTitle(Str.get_string("information","local_request")),modal.setBody(msg),modal.getFooter().find('[data-action="cancel"], [data-action="save"]').hide()):(this.modal.hideFooter(),modal.setBody(data),modal.setTitle(Str.get_string("information","local_request")),$('[data-action="hide"]').css("display","block")):"approve"==args.action&&"Certification"==args.component?(modal.setTitle(Str.get_string("information","local_request")),modal.setBody(msg),modal.getFooter().find('[data-action="cancel"], [data-action="save"]').hide()):"add"!=args.action?window.location.reload():(modal.setBody(msg),modal.getFooter().find('[data-action="cancel"], [data-action="save"]').hide()),$(".close").click((function(){location.reload()}))},requestconfirm.prototype.submitajax=function(args,modal){this.modal=modal,userid=args.userid,"approve"==args.action?modal.setSaveButtonText(Str.get_string("approve","local_request")):"deny"==args.action?modal.setSaveButtonText(Str.get_string("reject","local_request")):"delete"==args.action?modal.setSaveButtonText(Str.get_string("delete","local_request")):modal.setSaveButtonText(Str.get_string("confirm","local_request")),modal.getRoot().on(ModalEvents.save,(function(e){e.preventDefault(),args.confirm=!0,$.ajax({method:"POST",dataType:"json",url:M.cfg.wwwroot+"/local/request/ajax.php",data:{component:args.component,componentid:args.componentid,action:args.action,id:args.id}}).done((function(response){requestconfirm.prototype.handleModalSubmissionResponse(response,modal,args)}))}))},requestconfirm.prototype.getbodystring=function(args){var string="";if("learningplan"==args.component&&(args.component="Learning path"),args.action&&args.component)string=Str.get_string("confirmmsgfor_"+args.action,"local_request",args);return string},requestconfirm.prototype.init=function(args){$.Deferred();this.action=args.action;args.componentid,args.userid,args.component;ModalFactory.create({title:"Confirm",type:ModalFactory.types.SAVE_CANCEL,body:requestconfirm.prototype.getbodystring(args)}).done((function(modal){requestconfirm.prototype.submitajax(args,modal),modal.show()}))},requestconfirm.prototype.init11=function(args){var componentid=args.componentid,userid=args.userid;args.component;return Str.get_strings([{key:"confirm"},{key:"request_confirm_message",component:"local_request",param:args},{key:"confirm"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),$.ajax({method:"GET",dataType:"json",url:M.cfg.wwwroot+"/local/request/ajax.php?component='"+args.component+"'&componentid="+componentid+"&userid="+userid,success:function(data){if(0==data)var msg=Str.get_string("alreadyrequested","local_request");else msg=Str.get_string("requestsent","local_request");modal.setBody(msg),modal.getFooter().find('[data-action="cancel"], [data-action="save"]').hide(),$(".close").click((function(){location.reload()}))}})}.bind(this)),modal.show()}.bind(this))}.bind(this))},{init:function(args){return new requestconfirm(args)},requestDatatable:function(){params=[],params.action="viewrequest",params.classroomid=$("#viewrequest").data("classroomid");$("#viewrequest").dataTable({processing:!1,serverSide:!1,language:{paginate:{next:">",previous:"<"},search:"",searchPlaceholder:"Search"},sorting:!1,responsive:!0,pageLength:5,bLengthChange:!1,bInfo:!1})},load:function(){}}}));

//# sourceMappingURL=requestconfirm.min.js.map