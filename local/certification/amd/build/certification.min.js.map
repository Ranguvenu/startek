{"version":3,"file":"certification.min.js","sources":["../src/certification.js"],"sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     core_group/AjaxForms\n * @class      AjaxForms\n * @package    core_group\n * @copyright  2017 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'local_certification/jquery.dataTables',\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/ajax',\n    'jquery',\n    'jqueryui'\n], function(dataTable, Str, ModalFactory, ModalEvents, Ajax, $) {\n    var certification;\n    return certification = {\n        init: function(args) {\n            // this.certificationDatatable(args);\n            // this.SessionDatatable(args);\n            this.AssignUsers(args);\n        },\n        certificationDatatable: function(args) {\n            params = [];\n            params.action = 'viewcertifications';\n            params.certificationstatus = args.certificationstatus;\n\t\t\tStr.get_string('search','local_program').then(function(s) {\n            var oTable = $('#viewcertifications').dataTable({\n                'bInfo': false,\n                'processing': true,\n                'serverSide': true,\n                'ajax': {\n                    \"type\": \"POST\",\n                    \"url\": M.cfg.wwwroot + '/local/certification/ajax.php',\n                    \"data\": params\n                },\n                // \"responsive\": true,\n                // \"language\": {\n                //     \"processing\": \"DataTables is currently busy.\"\n                // },\n                \"bLengthChange\": false,\n                \"language\": {\n                    \"paginate\": {\n                        \"next\": \">\",\n                        \"previous\": \"<\"\n                    },\n                    'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>'\n                },\n\t\t\t\t \"oLanguage\": {\n\t\t\t\t\t\"sSearch\": s\n\t\t\t\t },\n                \"pageLength\": 6\n                //\"lengthMenu\": [\n                //    [4, 10, 50, 100, -1],\n                //    [\"Show 2\", \"Show 5\", \"Show 25\", \"Show 50\", \"Show All\"]\n                //]\n            });\n\t\t\t});\n            \n        },\n        SessionDatatable: function(args) {\n            var strings = Str.get_strings([{\n                key: 'search',\n                component: 'moodle'\n            }]).then(function (str){\n            params = [];\n            params.action = 'viewcertificationsessions';\n            params.certificationid = $('#viewcertificationsessions').data('certificationid');\n            var oTable = $('#viewcertificationsessions').dataTable({\n                'processing': true,\n                'serverSide': true,\n                \"language\": {\n                    \"paginate\": {\n                        \"next\": \">\",\n                        \"previous\": \"<\"\n                    },\n                    'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>',\n                    \"search\": \"\",\n                    \"searchPlaceholder\": str[0]\n                },\n                'ajax': {\n                    \"type\": \"POST\",\n                    \"url\": M.cfg.wwwroot + '/local/certification/ajax.php',\n                    \"data\":params\n                },\n                \"responsive\": true,\n                \"pageLength\": 5,\n                \"bLengthChange\": false,\n                \"bInfo\" : false,\n            });\n            }.bind(this));\n        },\n        CoursesDatatable: function(args) {\n            var strings = Str.get_strings([{\n                key: 'search',\n                component: 'moodle'\n            }]).then(function (str){\n                params = [];\n                params.action = 'viewcertificationcourses';\n                params.certificationid = $('#viewcertificationcourses').data('certificationid');\n                var oTable = $('#viewcertificationcourses').dataTable({\n                    'processing': true,\n                    'serverSide': true,\n                    \"language\": {\n                        \"paginate\": {\n                            \"next\": \">\",\n                            \"previous\": \"<\"\n                        },\n                        'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>',\n                        \"search\": \"\",\n                        \"searchPlaceholder\": str[0]\n                    },\n                    'ajax': {\n                        \"type\": \"POST\",\n                        \"url\": M.cfg.wwwroot + '/local/certification/ajax.php',\n                        \"data\":params\n                    },\n                    \"responsive\": true,\n                    \"pageLength\": 5,\n                    \"bLengthChange\": false,\n                    \"bInfo\" : false,\n                });\n            }.bind(this));\n        },\n        UsersDatatable: function(args) {\n            var strings = Str.get_strings([{\n                key: 'search',\n                component: 'moodle'\n            }]).then(function (str){\n                params = [];\n                params.action = 'viewcertificationusers';\n                params.certificationid = $('#viewcertificationusers').data('certificationid');\n                var oTable = $('#viewcertificationusers').dataTable({\n                    'processing': true,\n                    'serverSide': true,\n                    \"language\": {\n                        \"paginate\": {\n                            \"next\": \">\",\n                            \"previous\": \"<\"\n                        },\n                        'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>',\n                        \"search\": \"\",\n                        \"searchPlaceholder\": s[0]\n                    },\n                    'ajax': {\n                        \"type\": \"POST\",\n                        \"url\": M.cfg.wwwroot + '/local/certification/ajax.php',\n                        \"data\":params\n                    },\n                    \"responsive\": true,\n                    \"pageLength\": 5,\n                    \"bLengthChange\": false,\n                    \"bInfo\" : false,\n                });\n            }.bind(this));\n        },\n        EvaluationsDatatable: function(args) {\n            var strings = Str.get_strings([{\n                key: 'norecordsfound',\n                component: 'local_certification'\n            }]).then(function (str){\n                $('#viewevaluations').dataTable({\n                    searching: true,\n                    bLengthChange: false,\n                    bInfo : false,\n                    lengthMenu: [5, 10, 25, 50, -1],\n                       'aaSorting': [],\n                        'language': {\n                              'emptyTable': s[0],\n                                'paginate': {\n                                            'previous': '<',\n                                            'next': '>'\n                                        },\n                                'processing': '<img src='+M.cfg.wwwroot + '/local/ajax-loader.svg>'\n                             },\n                });\n            }.bind(this));\n        },\n        deleteConfirm: function(args) {\n            console.log(args);\n            return Str.get_strings([{\n                key: 'confirmation',\n                component: 'local_certification'\n            },\n            {\n                key: 'deleteconfirm',\n                component: 'local_certification',\n                param: args.certificationname,\n            },\n            {\n                key: 'deleteallconfirm',\n                component: 'local_certification'\n            },\n            {\n                key: 'yes'\n            },\n            {\n                key: 'deletecourseconfirm',\n                component: 'local_certification'\n            }\n            ]).then(function(s) {\n                 if(args.action==\"deletecertification\"){\n                    s[1]=s[1];\n                 }\n                 if(args.action==\"deletecertificationcourse\"){\n                    s[1]=s[4];\n                 }else{\n                     s[1]=s[2];\n                 }\n                ModalFactory.create({\n                   \n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[3]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        args.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_certification_' + args.action,\n                            args: args\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = M.cfg.wwwroot + '/local/certification/view.php?ctid='+args.certificationid;\n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        AssignUsers: function(args) {\n            $('.usersselect').click(function() {\n                var type = $(this).data('id');\n\n                if (type === 'removeselect') {\n                    $('input#remove').prop('disabled', false);\n                    $('input#add').prop('disabled', true);\n                } else if (type === 'addselect') {\n                    $('input#remove').prop('disabled', true);\n                    $('input#add').prop('disabled', false);\n                }\n\n                if ($(this).hasClass('select_all')) {\n                    $('#' + type + ' option').prop('selected', true);\n                } else if ($(this).hasClass('remove_all')) {\n                    $('#' + type ).val('').trigger(\"change\");\n                }\n            });\n        },\n        certificationStatus: function(args) {\n            return Str.get_strings([\n            {\n                key: 'confirmation',\n                component: 'local_certification'\n            },\n            {\n                key: args.actionstatusmsg,\n                component: 'local_certification'\n            },\n            {\n                key: 'yes'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[2]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        args.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_certification_' + args.action,\n                            args: args\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = window.location.href;\n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        ManagecertificationStatus: function(args) {\n            return Str.get_strings([{\n                key: 'confirmation',\n                component: 'local_certification'\n            },\n            {\n                key: args.actionstatusmsg,\n                component: 'local_certification',\n                param: args.certificationname,\n            },\n            {\n                key: 'deleteallconfirm',\n                component: 'local_certification'\n            },\n            {\n                key: 'yes'\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[3]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        args.confirm = true;\n                        var promise = Ajax.call([{\n                            methodname: 'local_certification_managecertificationStatus',\n                            args: args\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = M.cfg.wwwroot + '/local/certification/view.php?ctid='+args.certificationid;\n                        }).fail(function(ex) {\n                            // do something with the exception\n                             console.log(ex);\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        unEnrolUser : function(args){\n            return Str.get_strings([{\n                key: 'confirm'\n            },\n            {\n                key: 'certification_self_unenrolment',\n                component: 'local_certification',\n                param :args.certificationname\n            }]).then(function(s) {\n                ModalFactory.create({\n                    title: s[0],\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    body: s[1]\n                }).done(function(modal) {\n                    this.modal = modal;\n                    modal.setSaveButtonText(s[0]);\n                    modal.getRoot().on(ModalEvents.save, function(e) {\n                        e.preventDefault();\n                        var params = {};\n                        params.userid = args.userid;\n                        params.certificationid = args.certificationid;\n                        params.contextid = args.contextid;\n                        var promise = Ajax.call([{\n                            methodname: 'local_certification_deleteuser',\n                            args: params\n                        }]);\n                        promise[0].done(function(resp) {\n                            window.location.href = M.cfg.wwwroot;\n                        }).fail(function(ex) {\n                             console.log(ex);\n                        });\n                    }.bind(this));\n                    modal.show();\n                }.bind(this));\n            }.bind(this));\n        },\n        load: function () {\n\n        }\n    };\n});  "],"names":["define","dataTable","Str","ModalFactory","ModalEvents","Ajax","$","init","args","AssignUsers","certificationDatatable","params","action","certificationstatus","get_string","then","s","M","cfg","wwwroot","SessionDatatable","get_strings","key","component","str","certificationid","data","bind","this","CoursesDatatable","UsersDatatable","EvaluationsDatatable","searching","bLengthChange","bInfo","lengthMenu","deleteConfirm","console","log","param","certificationname","create","title","type","types","SAVE_CANCEL","body","done","modal","setSaveButtonText","getRoot","on","save","e","preventDefault","confirm","call","methodname","resp","window","location","href","fail","ex","show","click","prop","hasClass","val","trigger","certificationStatus","actionstatusmsg","ManagecertificationStatus","unEnrolUser","userid","contextid","load"],"mappings":"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"}