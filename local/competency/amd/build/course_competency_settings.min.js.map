{"version":3,"file":"course_competency_settings.min.js","sources":["../src/course_competency_settings.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Change the course competency settings in a popup.\n *\n * @module     local_competency/configurecoursecompetencysettings\n * @package    local_competency\n * @copyright  2015 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery',\n        'core/notification',\n        'local_competency/dialogue',\n        'core/str',\n        'core/ajax',\n        'core/templates'],\n       function($, notification, Dialogue, str, ajax, templates) {\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector - selector for the links to open the dialogue.\n     */\n    var settingsMod = function(selector) {\n        $(selector).on('click', this.configureSettings.bind(this));\n    };\n\n    /** @type {Dialogue} Reference to the dialogue that we opened. */\n    settingsMod.prototype._dialogue = null;\n\n    /**\n     * Open the configure settings dialogue.\n     *\n     * @param {Event} e\n     * @method configureSettings\n     */\n    settingsMod.prototype.configureSettings = function(e) {\n        var courseid = $(e.target).closest('a').data('courseid');\n        var currentValue = $(e.target).closest('a').data('pushratingstouserplans');\n        var context = {\n            courseid: courseid,\n            settings: {pushratingstouserplans: currentValue}\n        };\n        e.preventDefault();\n\n        templates.render('local_competency/course_competency_settings', context).done(function(html) {\n            str.get_string('configurecoursecompetencysettings', 'local_competency').done(function(title) {\n                this._dialogue = new Dialogue(\n                    title,\n                    html,\n                    this.addListeners.bind(this)\n                );\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Add the save listener to the form.\n     *\n     * @method addSaveListener\n     */\n    settingsMod.prototype.addListeners = function() {\n        var save = this._find('[data-action=\"save\"]');\n        save.on('click', this.saveSettings.bind(this));\n        var cancel = this._find('[data-action=\"cancel\"]');\n        cancel.on('click', this.cancelChanges.bind(this));\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {Event} e\n     * @method cancelChanges\n     */\n    settingsMod.prototype.cancelChanges = function(e) {\n        e.preventDefault();\n        this._dialogue.close();\n    };\n\n    /**\n     * Cancel the changes.\n     *\n     * @param {String} selector\n     * @return {JQuery}\n     */\n    settingsMod.prototype._find = function(selector) {\n        return $('[data-region=\"coursecompetencysettings\"]').find(selector);\n    };\n\n    /**\n     * Save the settings.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.saveSettings = function(e) {\n        e.preventDefault();\n\n        var newValue = this._find('input[name=\"pushratingstouserplans\"]:checked').val();\n        var courseId = this._find('input[name=\"courseid\"]').val();\n        var settings = {pushratingstouserplans: newValue};\n\n        ajax.call([\n            {methodname: 'core_competency_update_course_competency_settings',\n              args: {courseid: courseId, settings: settings}}\n        ])[0].done(function() {\n            this.refreshCourseCompetenciesPage();\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    /**\n     * Refresh the course competencies page.\n     *\n     * @param {Event} e\n     * @method saveSettings\n     */\n    settingsMod.prototype.refreshCourseCompetenciesPage = function() {\n        var courseId = this._find('input[name=\"courseid\"]').val();\n\n        ajax.call([\n            {methodname: 'local_competency_data_for_course_competencies_page',\n              args: {courseid: courseId}}\n        ])[0].done(function(context) {\n            templates.render('local_competency/course_competencies_page', context).done(function(html, js) {\n                $('[data-region=\"coursecompetenciespage\"]').replaceWith(html);\n                templates.runTemplateJS(js);\n                this._dialogue.close();\n            }.bind(this)).fail(notification.exception);\n        }.bind(this)).fail(notification.exception);\n\n    };\n\n    return /** @alias module:local_competency/configurecoursecompetencysettings */ settingsMod;\n});\n"],"names":["define","$","notification","Dialogue","str","ajax","templates","settingsMod","selector","on","this","configureSettings","bind","prototype","_dialogue","e","context","courseid","target","closest","data","settings","pushratingstouserplans","preventDefault","render","done","html","get_string","title","addListeners","fail","exception","_find","saveSettings","cancelChanges","close","find","newValue","val","courseId","call","methodname","args","refreshCourseCompetenciesPage","js","replaceWith","runTemplateJS"],"mappings":";;;;;;;;AAuBAA,qDAAO,CAAC,SACA,oBACA,4BACA,WACA,YACA,mBACD,SAASC,EAAGC,aAAcC,SAAUC,IAAKC,KAAMC,eAO9CC,YAAc,SAASC,UACvBP,EAAEO,UAAUC,GAAG,QAASC,KAAKC,kBAAkBC,KAAKF,eAIxDH,YAAYM,UAAUC,UAAY,KAQlCP,YAAYM,UAAUF,kBAAoB,SAASI,OAG3CC,QAAU,CACVC,SAHWhB,EAAEc,EAAEG,QAAQC,QAAQ,KAAKC,KAAK,YAIzCC,SAAU,CAACC,uBAHIrB,EAAEc,EAAEG,QAAQC,QAAQ,KAAKC,KAAK,4BAKjDL,EAAEQ,iBAEFjB,UAAUkB,OAAO,8CAA+CR,SAASS,KAAK,SAASC,MACnFtB,IAAIuB,WAAW,oCAAqC,oBAAoBF,KAAK,SAASG,YAC7Ed,UAAY,IAAIX,SACjByB,MACAF,KACAhB,KAAKmB,aAAajB,KAAKF,QAE7BE,KAAKF,OAAOoB,KAAK5B,aAAa6B,YAClCnB,KAAKF,OAAOoB,KAAK5B,aAAa6B,YASpCxB,YAAYM,UAAUgB,aAAe,WACtBnB,KAAKsB,MAAM,wBACjBvB,GAAG,QAASC,KAAKuB,aAAarB,KAAKF,OAC3BA,KAAKsB,MAAM,0BACjBvB,GAAG,QAASC,KAAKwB,cAActB,KAAKF,QAS/CH,YAAYM,UAAUqB,cAAgB,SAASnB,GAC3CA,EAAEQ,sBACGT,UAAUqB,SASnB5B,YAAYM,UAAUmB,MAAQ,SAASxB,iBAC5BP,EAAE,4CAA4CmC,KAAK5B,WAS9DD,YAAYM,UAAUoB,aAAe,SAASlB,GAC1CA,EAAEQ,qBAEEc,SAAW3B,KAAKsB,MAAM,gDAAgDM,MACtEC,SAAW7B,KAAKsB,MAAM,0BAA0BM,MAChDjB,SAAW,CAACC,uBAAwBe,UAExChC,KAAKmC,KAAK,CACN,CAACC,WAAY,oDACXC,KAAM,CAACzB,SAAUsB,SAAUlB,SAAUA,aACxC,GAAGI,KAAK,gBACFkB,iCACP/B,KAAKF,OAAOoB,KAAK5B,aAAa6B,YAUpCxB,YAAYM,UAAU8B,8BAAgC,eAC9CJ,SAAW7B,KAAKsB,MAAM,0BAA0BM,MAEpDjC,KAAKmC,KAAK,CACN,CAACC,WAAY,qDACXC,KAAM,CAACzB,SAAUsB,aACpB,GAAGd,KAAK,SAAST,SAChBV,UAAUkB,OAAO,4CAA6CR,SAASS,KAAK,SAASC,KAAMkB,IACvF3C,EAAE,0CAA0C4C,YAAYnB,MACxDpB,UAAUwC,cAAcF,SACnB9B,UAAUqB,SACjBvB,KAAKF,OAAOoB,KAAK5B,aAAa6B,YAClCnB,KAAKF,OAAOoB,KAAK5B,aAAa6B,YAI2CxB"}