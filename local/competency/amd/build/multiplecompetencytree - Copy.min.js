/**
 * Handle selection changes on the competency tree.
 *
 * @module     local_competency/competencyselect
 * @package    local_competency
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_competency/multiplecompetencytree - Copy",["core/ajax","core/notification","core/templates","local_competency/tree","local_competency/competency_outcomes","jquery"],(function(ajax,notification,templates,Ariatree,CompOutcomes,$){var competencies={},competencyFrameworkId=0,treeSelector="",currentNodeId="",carindex=0,addChildren=function(parent,all){var i=0,current=!1;for(parent.haschildren=!1,parent.children=[],i=0;i<all.length;i++)(current=all[i]).parentid==parent.id&&(parent.haschildren=!0,parent.children.push(current),addChildren(current,all))},searchCompetency=function(frameworkid,searchtext){$.Deferred(),ajax.call([{methodname:"core_competency_search_competencies",args:{searchtext:searchtext,competencyframeworkid:frameworkid},done:function(result){competencies={};var i=0;for(i=0;i<result.length;i++)competencies[result[i].id]=result[i];var competency=!1;for(i=0;i<result.length;i++)competency=result[i],0===parseInt(competency.parentid,10)&&(children.push(competency),addChildren(competency,result))}}]);return children},loadCompetencies=function(searchtext){var deferred=$.Deferred();return templates.render("local_competency/loading",{}).done((function(loadinghtml,loadingjs){var cars=[{frameworkSelector:"[data-enhance=tree2]",frameworkShortname:"Test111",frameworkId:2},{frameworkSelector:"[data-enhance=tree3]",frameworkShortname:"Test013",frameworkId:3}];for(carindex=0;carindex<cars.length;carindex++){treeSelector=cars[carindex].frameworkSelector,templates.replaceNodeContents($(treeSelector),loadinghtml,loadingjs),competencyFrameworkId=cars[carindex].frameworkId,cars[carindex].frameworkShortname,children=searchCompetency(cars[carindex].frameworkId,searchtext),console.log(children);var context={frameworkid:cars[carindex].frameworkId,shortname:cars[carindex].frameworkShortname,canmanage:false,competencies:children};displayCompetencytree(treeSelector,context)}})),deferred.promise()},displayCompetencytree=function(selectorkey,context){var deferred=$.Deferred();templates.render("local_competency/competencies_tree_root",context).done((function(html,js){treeSelector=selectorkey,console.log(treeSelector),console.log(html),templates.replaceNodeContents($(treeSelector),$(html).html(),js);var tree=new Ariatree(treeSelector,!1);if(currentNodeId){var node=$(treeSelector).find("[data-id="+currentNodeId+"]");node.length&&(tree.selectItem(node),tree.updateFocus(node))}deferred.resolve(competencies)})).fail(deferred.reject)},rememberCurrent=function(evt,params){var node=params.selected;currentNodeId=node.attr("data-id")};return{init:function(frameworks){search="",loadCompetencies("").fail(notification.exception),this.on("selectionchanged",rememberCurrent)},on:function(eventname,handler){$(treeSelector).on(eventname,handler)},getChildren:function(id){var children=[];return $.each(competencies,(function(index,competency){competency.parentid==id&&children.push(competency)})),children},getCompetencyFrameworkId:function(){return competencyFrameworkId},getCompetency:function(id){return competencies[id]},getCompetencyLevel:function(id){return this.getCompetency(id).path.replace(/^\/|\/$/g,"").split("/").length},hasChildren:function(id){return this.getChildren(id).length>0},hasRule:function(id){var comp=this.getCompetency(id);return!!comp&&(comp.ruleoutcome!=CompOutcomes.OUTCOME_NONE&&comp.ruletype)},reloadCompetencies:function(){return loadCompetencies("").fail(notification.exception)},listCompetencies:function(){return competencies}}}));

//# sourceMappingURL=multiplecompetencytree - Copy.min.js.map