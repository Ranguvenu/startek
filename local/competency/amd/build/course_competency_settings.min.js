/**
 * Change the course competency settings in a popup.
 *
 * @module     local_competency/configurecoursecompetencysettings
 * @package    local_competency
 * @copyright  2015 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_competency/course_competency_settings",["jquery","core/notification","local_competency/dialogue","core/str","core/ajax","core/templates"],(function($,notification,Dialogue,str,ajax,templates){var settingsMod=function(selector){$(selector).on("click",this.configureSettings.bind(this))};return settingsMod.prototype._dialogue=null,settingsMod.prototype.configureSettings=function(e){var context={courseid:$(e.target).closest("a").data("courseid"),settings:{pushratingstouserplans:$(e.target).closest("a").data("pushratingstouserplans")}};e.preventDefault(),templates.render("local_competency/course_competency_settings",context).done(function(html){str.get_string("configurecoursecompetencysettings","local_competency").done(function(title){this._dialogue=new Dialogue(title,html,this.addListeners.bind(this))}.bind(this)).fail(notification.exception)}.bind(this)).fail(notification.exception)},settingsMod.prototype.addListeners=function(){this._find('[data-action="save"]').on("click",this.saveSettings.bind(this)),this._find('[data-action="cancel"]').on("click",this.cancelChanges.bind(this))},settingsMod.prototype.cancelChanges=function(e){e.preventDefault(),this._dialogue.close()},settingsMod.prototype._find=function(selector){return $('[data-region="coursecompetencysettings"]').find(selector)},settingsMod.prototype.saveSettings=function(e){e.preventDefault();var newValue=this._find('input[name="pushratingstouserplans"]:checked').val(),courseId=this._find('input[name="courseid"]').val(),settings={pushratingstouserplans:newValue};ajax.call([{methodname:"core_competency_update_course_competency_settings",args:{courseid:courseId,settings:settings}}])[0].done(function(){this.refreshCourseCompetenciesPage()}.bind(this)).fail(notification.exception)},settingsMod.prototype.refreshCourseCompetenciesPage=function(){var courseId=this._find('input[name="courseid"]').val();ajax.call([{methodname:"local_competency_data_for_course_competencies_page",args:{courseid:courseId}}])[0].done(function(context){templates.render("local_competency/course_competencies_page",context).done(function(html,js){$('[data-region="coursecompetenciespage"]').replaceWith(html),templates.runTemplateJS(js),this._dialogue.close()}.bind(this)).fail(notification.exception)}.bind(this)).fail(notification.exception)},settingsMod}));

//# sourceMappingURL=course_competency_settings.min.js.map