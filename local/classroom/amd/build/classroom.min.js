/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package    core_group
 * @copyright  2017 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_classroom/classroom",["core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","jquery","local_costcenter/cardPaginate","jqueryui"],(function(Str,ModalFactory,ModalEvents,Ajax,Templates,$,Cardpaginate){return{init:function(args){this.AssignUsers(args)},completionInfo:function(params){var name=params.name,target="."+name,promise=Ajax.call([{methodname:"local_classroom_classroomview"+name,args:params}]);$("#sessions_tabdataid").empty(),$("#coursesid").empty(),$("#usersid").empty(),$("#feedbacksid").empty(),$("#requestedusersid").empty(),$(".tab-pane").removeClass("active"),$("#"+name).addClass("active"),promise[0].done((function(resp){Templates.render("local_classroom/classroomview"+name,{response:resp}).then((function(response){$(target).html(response)}))})).fail((function(ex){console.log(ex)}))},classroomsData:function(params){if("card"==params)var options={targetID:"all",templateName:"local_classroom/classrooms_list",methodName:"local_classroom_get_classrooms",perPage:6,cardClass:"col-md-6 col-12",viewType:"card"};else options={targetID:"all",templateName:"local_classroom/classrooms_catalog_list",methodName:"local_classroom_get_classrooms",perPage:10,cardClass:"tableformat",viewType:"table"};var dataoptions={status:"-1",view_type:params};Cardpaginate.reload(options,dataoptions)},sessionsData:function(params){var options={targetID:"sessions_tabdata",templateName:"local_classroom/classroomviewsessions",methodName:"local_classroom_classroomviewsessions",perPage:5,cardClass:"col-md-6 col-12",viewType:"card"},dataoptions={tabname:"sessions",classroomid:params};Cardpaginate.reload(options,dataoptions,{})},deleteConfirm:function(args){return console.log(args),Str.get_strings([{key:"confirmation",component:"local_classroom"},{key:"deleteconfirm",component:"local_classroom",param:args.classroomname},{key:"deleteallconfirm",component:"local_classroom",param:args.sessionname},{key:"yes"},{key:"deletecourseconfirm",component:"local_classroom",param:args.name},{key:"unenrollclassroom",component:"local_classroom",param:args.classroomname},{key:"requestprocessing",component:"local_classroom"},{key:"deletefeedbackconfirm",component:"local_classroom",param:args.feedbackname}]).then(function(s){"deleteclassroom"==args.action?s[1]=s[1]:"unenrollclassroom"==args.action?s[1]=s[5]:"deleteclassroomcourse"==args.action?s[1]=s[4]:"deleteclassroomevaluation"==args.action?s[1]=s[7]:s[1]=s[2],ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.save,function(e){this.modal.setBody('<span class="loading-icon icon-no-margin"><img src='+M.cfg.wwwroot+"/local/ajax-loader.svg></span>"),this.modal.hideFooter(),this.modal.setTitle(s[6]),$('[data-action="hide"]').css("display","none"),e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_classroom_"+args.action,args:args}])[0].done((function(resp){"deleteclassroom"==args.action?window.location.href=M.cfg.wwwroot+"/local/classroom/index.php":window.location.href=M.cfg.wwwroot+"/local/classroom/view.php?cid="+args.classroomid})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},AssignUsers:function(args){$(".usersselect").click((function(){var type=$(this).data("id");"removeselect"===type?($("input#remove").prop("disabled",!1),$("input#add").prop("disabled",!0)):"addselect"===type&&($("input#remove").prop("disabled",!0),$("input#add").prop("disabled",!1)),$(this).hasClass("select_all")?$("#"+type+" option").prop("selected",!0):$(this).hasClass("remove_all")&&$("#"+type).val("").trigger("change")}))},classroomStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_classroom"},{key:args.actionstatusmsg,component:"local_classroom"},{key:"yes"},{key:"requestprocessing",component:"local_classroom"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){this.modal.setBody('<span class="loading-icon icon-no-margin"><img src='+M.cfg.wwwroot+"/local/ajax-loader.svg></span>"),this.modal.hideFooter(),this.modal.setTitle(s[3]),$('[data-action="hide"]').css("display","none"),e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_classroom_"+args.action,args:args}])[0].done((function(resp){window.location.href=window.location.href})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},ManageclassroomStatus:function(args){return Str.get_strings([{key:"confirmation",component:"local_classroom"},{key:args.actionstatusmsg,component:"local_classroom",param:args.classroomname},{key:"deleteallconfirm",component:"local_classroom"},{key:"yes"},{key:"requestprocessing",component:"local_classroom"},{key:"information",component:"local_classroom"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[3]),modal.getRoot().on(ModalEvents.save,function(e){this.modal.setBody('<span class="loading-icon icon-no-margin"><img src='+M.cfg.wwwroot+"/local/ajax-loader.svg></span>"),this.modal.hideFooter(),this.modal.setTitle(s[4]),$('[data-action="hide"]').css("display","none"),e.preventDefault(),args.confirm=!0,Ajax.call([{methodname:"local_classroom_manageclassroomStatus",args:args}])[0].done((function(resp){"enrolrequest"==args.action?location.reload():"selfenrol"==args.action?""==resp.return_status?window.location.href=M.cfg.wwwroot+"/local/classroom/view.php?cid="+args.classroomid:(modal.setBody(resp.return_status),modal.setTitle(s[5]),$('[data-action="hide"]').css("display","block")):window.location.href=M.cfg.wwwroot+"/local/classroom/view.php?cid="+args.classroomid,$(".close").click((function(){location.reload()}))})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))},load:function(){}}}));

//# sourceMappingURL=classroom.min.js.map