/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package    core_group
 * @copyright  2017 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_myteam/courseallocation",["core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","jquery"],(function(Str,ModalFactory,ModalEvents,Ajax,Templates,$){return{init:function(){$(".allocate_button").prop("disabled",!0),$(".allocation_course_type_btn").prop("disabled",!0)},teamsearch:function(params){return Str.get_strings([{key:"selectausertoproceed",component:"local_myteam"}]).then(function(s){var searchtype=params.searchtype,search=params.searchvalue;if(void 0===search)return!1;var user=$("input[name='allocateuser']:checked").val();if("myteam"===searchtype){var target=".departmentmyteam";$("#nominate_myteamlist").val();(params={action:"searchdata"}).learningtype=searchtype,params.search=search,params.user="",Ajax.call([{methodname:"local_myteam_teamallocation_view",args:params}])[0].done((function(resp){Templates.render("local_myteam/searchallocateusers",{response:resp}).then((function(response){$(".departmentmyteam").html(response)}))})).fail((function(ex){console.log(ex)}))}else{target=".departmentcourses";var selecteduser=$("#nominate_myteamlist").val(),learningtype=($("#nominate_courseslist").val(),$("#learning_type").val());$('input[name="search_learningtypes"]').val();if(searchtype!=learningtype&&(searchtype=learningtype),null==user||null==user){var data='<div class="alert alert-danger">'+s[0]+"</div>";$(target).html(data)}else{var params;(params={action:"searchdata"}).learningtype=searchtype,params.search=search,params.user=selecteduser,params.allocatecourse=!1,Ajax.call([{methodname:"local_myteam_courseallocation_view",args:params}])[0].done((function(resp){Templates.render("local_myteam/courseallocatemoduledata",{response:resp}).then((function(response){$(".departmentcourses").html(response)}))})).fail((function(ex){console.log(ex)}))}}}.bind(this))},select_type:function(params){var user=params.user,learningtype=params.learningtype,pluginname=params.pluginname;$('input[name="search_learningtypes"]').val(""),$("#learning_type").val(params.learningtype),null!=user&&null!=typeof user&&$("#nominate_myteamlist").val(user);var selected_user=$('input[name="allocateuser"]:checked').val();if(null==user&&null==selected_user)return ModalFactory.create({title:Str.get_string("warning"),type:ModalFactory.types.DEFAULT,body:Str.get_string("team_select_user","local_myteam")}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))})),!1;user=selected_user,type=pluginname,$(".allocation_course_type").html(type),(params={action:"departmentmodules"}).learningtype=learningtype,params.user=user,params.search=!1,params.allocatecourse=!1,Ajax.call([{methodname:"local_myteam_courseallocation_view",args:params}])[0].done((function(resp){Templates.render("local_myteam/courseallocatemoduledata",{response:resp}).then((function(response){$(".departmentcourses").html(response)}))})).fail((function(ex){console.log(ex)}))},select_list:function(params){params.user;var courseid=params.courses,learningtype=params.learningtype,coursecheckedstatus=params.element.checked;$("#nominate_courseslist").val(),$('input[name="allocatecourse"]:checked').val();$('input[name="search_learningtypes"]').val("");var allocate=!1;switch(learningtype){case 1:case 3:case 4:courseid>1&&1==coursecheckedstatus&&(allocate=!0);break;case 2:courseid&&1==coursecheckedstatus&&(allocate=!0);break;default:allocate=!1}1==allocate?($(".allocate_button").prop("disabled",!1),$(".allocation_course_type_btn").prop("disabled",!1)):($(".allocate_button").prop("disabled",!0),$(".allocation_course_type_btn").prop("disabled",!0))},allocator:function(){var allocateuser=$("#nominate_myteamlist").val(),learningtype=$("#learning_type").val(),allocatecourse=[];$('input[name="search_learningtypes"]').val("");$('input[name="allocatecourse[]"]:checked').each((function(){var courseid_selected=$(this).val();allocatecourse.push(courseid_selected)}));return allocateuser.length?allocatecourse.length?void Str.get_strings([{key:"requestprocessing",component:"local_myteam"},{key:"information",component:"local_myteam"},{key:"learningtypeallocated",component:"local_myteam"}]).then(function(s){ModalFactory.create({title:Str.get_string("team_confirm_selected_allocation","local_myteam"),type:ModalFactory.types.SAVE_CANCEL,body:Str.get_string("allocate_confirm_allocate","local_myteam")}).done(function(modal){this.modal=modal,modal.setSaveButtonText(Str.get_string("allocate_yes","local_myteam"));var value=Str.get_string("reject_no","local_myteam"),button=this.modal.getFooter().find('[data-action="cancel"]');this.modal.asyncSet(value,button.text.bind(button)),modal.getRoot().on(ModalEvents.save,function(e){this.modal.setBody('<span class="loading-icon icon-no-margin"><img src='+M.cfg.wwwroot+"/local/ajax-loader.svg></span>"),this.modal.hideFooter(),this.modal.setTitle(s[0]),$('[data-action="hide"]').css("display","none"),e.preventDefault();var params={action:"courseallocate"};params.learningtype=learningtype,params.user=allocateuser,params.search=!1,params.allocatecourse=JSON.stringify(allocatecourse),Ajax.call([{methodname:"local_myteam_modulecourse_allocation",args:params}])[0].done((function(resp){var bobytext="";$.each(resp.records,(function(index,element){if(1==element.enrolledornot&&""!=element.return_status)bobytext+=element.return_status;else if(1==element.enrolledornot&&""==element.return_status){var textbody='<div class="alert alert-info" role="alert"><button type="button" class="close" data-dismiss="alert">Ã—</button>'+s[2]+"</div>";bobytext!=textbody&&(bobytext+=textbody)}})),modal.setBody(bobytext),modal.setTitle(s[1]),$('[data-action="hide"]').css("display","block"),$(".close").click((function(){location.reload()}))})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this)):(ModalFactory.create({title:Str.get_string("warning"),type:ModalFactory.types.DEFAULT,body:Str.get_string("team_select_course_s","local_myteam")}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))})),!1):(ModalFactory.create({title:Str.get_string("warning"),type:ModalFactory.types.DEFAULT,body:Str.get_string("team_select_user","local_myteam")}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))})),!1)},load:function(){}}}));

//# sourceMappingURL=courseallocation.min.js.map