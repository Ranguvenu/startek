{"version":3,"file":"team_approvals.min.js","sources":["../src/team_approvals.js"],"sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     core_group/AjaxForms\n * @class      AjaxForms\n * @package    core_group\n * @copyright  2017 Damyon Wiese <damyon@moodle.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine([\n    'core/str',\n    'core/modal_factory',\n    'core/modal_events',\n    'core/ajax',\n    'core/templates',\n    'jquery',\n], function(Str, ModalFactory, ModalEvents, Ajax, Templates, $) {\n    var team_approvals;\n    return {\n        init: function() {\n\n        },\n        requestsearch: function(params) {\n            var learningtype = params.learningtype;\n\n            var changed_learningtype = $('input[name=\"approval_learning_type\"]').val();\n            if(changed_learningtype){\n                learningtype = changed_learningtype;\n            }\n            var search = params.searchvalue;\n            if(typeof(search) == 'undefined' || search == null){\n                return false;\n            }\n            //if(learningtype == 'elearning'){\n                var target = '#team_requests_list';\n        \n                var params = {};\n                params.action = 'searchdata';\n                params.learningtype = learningtype;\n                params.search = search;\n\n                var promise = Ajax.call([{\n                    methodname: 'local_myteam_teamapprovals_view',\n                    args: params\n                }]);\n                promise[0].done(function(resp) {\n                    var data = Templates.render('local_myteam/requestsearch', {response: resp});\n                    data.then(function(response){\n                         $(target).html(response);\n                    });\n                }).fail(function(ex) {\n                    // do something with the exception\n                    console.log(ex);\n                });\n        },\n        select_learningtype: function(params) {\n            var learningtype = params.learningtype;\n            var pluginname = params.pluginname;\n\n            $('input[name=\"approval_learning_type\"]').val(learningtype);\n            $('input[name=\"search_requests\"]').val('');\n            $('.team_learningtype_dropdown').html(pluginname);\n            var target = '#team_requests_list';\n            var params = {};\n            params.action = 'change_learningtype';\n            params.learningtype = learningtype;\n            params.search = false;\n\n            var promise = Ajax.call([{\n                methodname: 'local_myteam_teamapprovals_view',\n                args: params\n            }]);\n            promise[0].done(function(resp) {\n                var data = Templates.render('local_myteam/requestsearch', {response: resp});\n                data.then(function(response){\n                     $(target).html(response);\n                });\n            }).fail(function(ex) {\n                // do something with the exception\n                console.log(ex);\n            });\n        },\n        select_request: function(params) {\n            var learningtype = params.learningtype;\n            var requestid = params.requestid;\n            var coursecheckedstatus = params.element.checked;\n            var allocate = false;\n\n            if(requestid > 0){\n                if(coursecheckedstatus == true){\n                    allocate = true;\n                }\n            }\n\n            if(allocate == true){\n                $('.request_approval_btn').prop( \"disabled\", false);\n            }else{\n                $('.request_approval_btn').prop( \"disabled\", true);\n            }\n\n        },\n\n        approve_request: function() {\n            var learning_type = $('#approval_learning_type').val();\n            var requeststoapprove = [];\n\n            $('input[name=\"search_learningtypes\"]').val('');\n            $('input[name=\"team_requests[]\"]:checked').each(function () {\n                var requestid_selected = $(this).val();\n                requeststoapprove.push(requestid_selected);\n            });\n\n             console.log(requeststoapprove);\n            if(!learning_type.length){\n                ModalFactory.create({\n                    title: Str.get_string('warning'),\n                    type: ModalFactory.types.DEFAULT,\n                    body: Str.get_string('select_learningtype', 'local_myteam')\n                }).done(function(modal) {\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                    //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(ModalEvents.cancel, function() {\n                        modal.destroy();\n                    });\n                });\n                return false;\n            }\n\n            if(!requeststoapprove.length){\n                ModalFactory.create({\n                    title: Str.get_string('warning'),\n                    type: ModalFactory.types.DEFAULT,\n                    body: Str.get_string('select_requests', 'local_myteam')\n                }).done(function(modal) {\n                    modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                    //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n\n                    modal.show();\n                    modal.getRoot().on(ModalEvents.hidden, function() {\n                        modal.destroy();\n                    });\n                    modal.getRoot().on(ModalEvents.cancel, function() {\n                        modal.destroy();\n                    });\n                });\n                return false;\n            }\n\n            Str.get_strings([{\n                key: 'learningtypeallocated',\n                component: 'local_myteam',\n            }]).then(function(s) {\n            ModalFactory.create({\n                title: Str.get_string('confirm'),\n                type: ModalFactory.types.SAVE_CANCEL,\n                body: Str.get_string('team_request_confirm', 'local_myteam')\n            }).done(function(modal) {\n                modal.setSaveButtonText(Str.get_string('approve', 'local_myteam'));\n\n                //For cancel button string changed//\n                    var value=Str.get_string('reject', 'local_myteam');\n                    var button = modal.getFooter().find('[data-action=\"cancel\"]');\n                    modal.asyncSet(value, button.text.bind(button));\n                modal.show();\n                modal.getRoot().on(ModalEvents.hidden, function() {\n                    modal.destroy();\n                });\n\n                modal.getRoot().on(ModalEvents.save, function() {\n                    var params = {};\n                    params.action = 'requestapproved';\n                    params.requeststoapprove = JSON.stringify(requeststoapprove);\n                    params.learningtype = learning_type;\n\n                    var promise = Ajax.call([{\n                        methodname: 'local_myteam_teamapprovals_actions',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        $('#allocation_notifications').html('<div class=\"alert alert-info\" role=\"alert\"><button type=\"button\" class=\"close\" data-dismiss=\"alert\">Ã—</button>'+s[0]+'</div>');\n                        \n                        modal.hide();\n                        modal.destroy();\n                        window.location.href = window.location.href;\n\n                    }).fail(function(ex) {\n                        // do something with the exception\n                        console.log(ex);\n                    });\n                });\n                modal.getRoot().on(ModalEvents.cancel, function() {\n                    setTimeout(function(){\n                        modal.destroy();\n                    }, 1000);\n                });\n\n\n                 //return modal;\n            });\n        }.bind(this));\n        }\n    };\n});\n"],"names":["define","Str","ModalFactory","ModalEvents","Ajax","Templates","$","init","requestsearch","params","learningtype","changed_learningtype","val","search","searchvalue","call","methodname","args","done","resp","render","response","then","html","fail","ex","console","log","select_learningtype","pluginname","select_request","requestid","coursecheckedstatus","element","checked","allocate","prop","approve_request","learning_type","requeststoapprove","each","requestid_selected","this","push","length","get_strings","key","component","s","create","title","get_string","type","types","SAVE_CANCEL","body","modal","setSaveButtonText","value","button","getFooter","find","asyncSet","text","bind","show","getRoot","on","hidden","destroy","save","JSON","stringify","hide","window","location","href","cancel","setTimeout","DEFAULT"],"mappings":";;;;;;;;;AASAA,qCAAO,CACH,WACA,qBACA,oBACA,YACA,iBACA,WACD,SAASC,IAAKC,aAAcC,YAAaC,KAAMC,UAAWC,SAElD,CACHC,KAAM,aAGNC,cAAe,SAASC,YAChBC,aAAeD,OAAOC,aAEtBC,qBAAuBL,EAAE,wCAAwCM,MAClED,uBACCD,aAAeC,0BAEfE,OAASJ,OAAOK,oBACC,IAAXD,QAAoC,MAAVA,cACzB,GAKHJ,OAAS,CACbA,OAAgB,eACTC,aAAeA,aACtBD,OAAOI,OAASA,OAEFT,KAAKW,KAAK,CAAC,CACrBC,WAAY,kCACZC,KAAMR,UAEF,GAAGS,MAAK,SAASC,MACVd,UAAUe,OAAO,6BAA8B,CAACC,SAAUF,OAChEG,MAAK,SAASD,UACdf,EAdI,uBAcMiB,KAAKF,gBAErBG,MAAK,SAASC,IAEbC,QAAQC,IAAIF,QAGxBG,oBAAqB,SAASnB,YACtBC,aAAeD,OAAOC,aACtBmB,WAAapB,OAAOoB,WAExBvB,EAAE,wCAAwCM,IAAIF,cAC9CJ,EAAE,iCAAiCM,IAAI,IACvCN,EAAE,+BAA+BiB,KAAKM,aAElCpB,OAAS,CACbA,OAAgB,wBACTC,aAAeA,aACtBD,OAAOI,QAAS,EAEFT,KAAKW,KAAK,CAAC,CACrBC,WAAY,kCACZC,KAAMR,UAEF,GAAGS,MAAK,SAASC,MACVd,UAAUe,OAAO,6BAA8B,CAACC,SAAUF,OAChEG,MAAK,SAASD,UACdf,EAbI,uBAaMiB,KAAKF,gBAErBG,MAAK,SAASC,IAEbC,QAAQC,IAAIF,QAGpBK,eAAgB,SAASrB,QACFA,OAAOC,iBACtBqB,UAAYtB,OAAOsB,UACnBC,oBAAsBvB,OAAOwB,QAAQC,QACrCC,UAAW,EAEZJ,UAAY,GACe,GAAvBC,sBACCG,UAAW,GAIJ,GAAZA,SACC7B,EAAE,yBAAyB8B,KAAM,YAAY,GAE7C9B,EAAE,yBAAyB8B,KAAM,YAAY,IAKrDC,gBAAiB,eACTC,cAAgBhC,EAAE,2BAA2BM,MAC7C2B,kBAAoB,UAExBjC,EAAE,sCAAsCM,IAAI,IAC5CN,EAAE,yCAAyCkC,MAAK,eACxCC,mBAAqBnC,EAAEoC,MAAM9B,MACjC2B,kBAAkBI,KAAKF,uBAG1Bf,QAAQC,IAAIY,mBACTD,cAAcM,OAwBdL,kBAAkBK,YAwBtB3C,IAAI4C,YAAY,CAAC,CACbC,IAAK,wBACLC,UAAW,kBACXzB,KAAK,SAAS0B,GAClB9C,aAAa+C,OAAO,CAChBC,MAAOjD,IAAIkD,WAAW,WACtBC,KAAMlD,aAAamD,MAAMC,YACzBC,KAAMtD,IAAIkD,WAAW,uBAAwB,kBAC9CjC,MAAK,SAASsC,OACbA,MAAMC,kBAAkBxD,IAAIkD,WAAW,UAAW,qBAG1CO,MAAMzD,IAAIkD,WAAW,SAAU,gBAC/BQ,OAASH,MAAMI,YAAYC,KAAK,0BACpCL,MAAMM,SAASJ,MAAOC,OAAOI,KAAKC,KAAKL,SAC3CH,MAAMS,OACNT,MAAMU,UAAUC,GAAGhE,YAAYiE,QAAQ,WACnCZ,MAAMa,aAGVb,MAAMU,UAAUC,GAAGhE,YAAYmE,MAAM,eAC7B7D,OAAS,CACbA,OAAgB,mBAChBA,OAAO8B,kBAAoBgC,KAAKC,UAAUjC,mBAC1C9B,OAAOC,aAAe4B,cAERlC,KAAKW,KAAK,CAAC,CACrBC,WAAY,qCACZC,KAAMR,UAEF,GAAGS,MAAK,SAASC,MACrBb,EAAE,6BAA6BiB,KAAK,iHAAiHyB,EAAE,GAAG,UAE1JQ,MAAMiB,OACNjB,MAAMa,UACNK,OAAOC,SAASC,KAAOF,OAAOC,SAASC,QAExCpD,MAAK,SAASC,IAEbC,QAAQC,IAAIF,UAGpB+B,MAAMU,UAAUC,GAAGhE,YAAY0E,QAAQ,WACnCC,YAAW,WACPtB,MAAMa,YACP,YAMbL,KAAKtB,QA1ECxC,aAAa+C,OAAO,CAChBC,MAAOjD,IAAIkD,WAAW,WACtBC,KAAMlD,aAAamD,MAAM0B,QACzBxB,KAAMtD,IAAIkD,WAAW,kBAAmB,kBACzCjC,MAAK,SAASsC,OACbA,MAAMC,kBAAkBxD,IAAIkD,WAAW,UAAW,qBAG9CO,MAAMzD,IAAIkD,WAAW,SAAU,gBAC/BQ,OAASH,MAAMI,YAAYC,KAAK,0BACpCL,MAAMM,SAASJ,MAAOC,OAAOI,KAAKC,KAAKL,SAEvCH,MAAMS,OACNT,MAAMU,UAAUC,GAAGhE,YAAYiE,QAAQ,WACnCZ,MAAMa,aAEVb,MAAMU,UAAUC,GAAGhE,YAAY0E,QAAQ,WACnCrB,MAAMa,iBAGP,IA5CPnE,aAAa+C,OAAO,CAChBC,MAAOjD,IAAIkD,WAAW,WACtBC,KAAMlD,aAAamD,MAAM0B,QACzBxB,KAAMtD,IAAIkD,WAAW,sBAAuB,kBAC7CjC,MAAK,SAASsC,OACbA,MAAMC,kBAAkBxD,IAAIkD,WAAW,UAAW,qBAG9CO,MAAMzD,IAAIkD,WAAW,SAAU,gBAC/BQ,OAASH,MAAMI,YAAYC,KAAK,0BACpCL,MAAMM,SAASJ,MAAOC,OAAOI,KAAKC,KAAKL,SAEvCH,MAAMS,OACNT,MAAMU,UAAUC,GAAGhE,YAAYiE,QAAQ,WACnCZ,MAAMa,aAEVb,MAAMU,UAAUC,GAAGhE,YAAY0E,QAAQ,WACnCrB,MAAMa,iBAGP"}