/**
 * Add a create new group modal to the page.
 *
 * @module     core_group/AjaxForms
 * @class      AjaxForms
 * @package    core_group
 * @copyright  2017 Damyon Wiese <damyon@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_myteam/team_approvals",["core/str","core/modal_factory","core/modal_events","core/ajax","core/templates","jquery"],(function(Str,ModalFactory,ModalEvents,Ajax,Templates,$){return{init:function(){},requestsearch:function(params){var learningtype=params.learningtype,changed_learningtype=$('input[name="approval_learning_type"]').val();changed_learningtype&&(learningtype=changed_learningtype);var search=params.searchvalue;if(void 0===search||null==search)return!1;(params={action:"searchdata"}).learningtype=learningtype,params.search=search,Ajax.call([{methodname:"local_myteam_teamapprovals_view",args:params}])[0].done((function(resp){Templates.render("local_myteam/requestsearch",{response:resp}).then((function(response){$("#team_requests_list").html(response)}))})).fail((function(ex){console.log(ex)}))},select_learningtype:function(params){var learningtype=params.learningtype,pluginname=params.pluginname;$('input[name="approval_learning_type"]').val(learningtype),$('input[name="search_requests"]').val(""),$(".team_learningtype_dropdown").html(pluginname);(params={action:"change_learningtype"}).learningtype=learningtype,params.search=!1,Ajax.call([{methodname:"local_myteam_teamapprovals_view",args:params}])[0].done((function(resp){Templates.render("local_myteam/requestsearch",{response:resp}).then((function(response){$("#team_requests_list").html(response)}))})).fail((function(ex){console.log(ex)}))},select_request:function(params){params.learningtype;var requestid=params.requestid,coursecheckedstatus=params.element.checked,allocate=!1;requestid>0&&1==coursecheckedstatus&&(allocate=!0),1==allocate?$(".request_approval_btn").prop("disabled",!1):$(".request_approval_btn").prop("disabled",!0)},approve_request:function(){var learning_type=$("#approval_learning_type").val(),requeststoapprove=[];return $('input[name="search_learningtypes"]').val(""),$('input[name="team_requests[]"]:checked').each((function(){var requestid_selected=$(this).val();requeststoapprove.push(requestid_selected)})),console.log(requeststoapprove),learning_type.length?requeststoapprove.length?void Str.get_strings([{key:"learningtypeallocated",component:"local_myteam"}]).then(function(s){ModalFactory.create({title:Str.get_string("confirm"),type:ModalFactory.types.SAVE_CANCEL,body:Str.get_string("team_request_confirm","local_myteam")}).done((function(modal){modal.setSaveButtonText(Str.get_string("approve","local_myteam"));var value=Str.get_string("reject","local_myteam"),button=modal.getFooter().find('[data-action="cancel"]');modal.asyncSet(value,button.text.bind(button)),modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.save,(function(){var params={action:"requestapproved"};params.requeststoapprove=JSON.stringify(requeststoapprove),params.learningtype=learning_type,Ajax.call([{methodname:"local_myteam_teamapprovals_actions",args:params}])[0].done((function(resp){$("#allocation_notifications").html('<div class="alert alert-info" role="alert"><button type="button" class="close" data-dismiss="alert">Ã—</button>'+s[0]+"</div>"),modal.hide(),modal.destroy(),window.location.href=window.location.href})).fail((function(ex){console.log(ex)}))})),modal.getRoot().on(ModalEvents.cancel,(function(){setTimeout((function(){modal.destroy()}),1e3)}))}))}.bind(this)):(ModalFactory.create({title:Str.get_string("warning"),type:ModalFactory.types.DEFAULT,body:Str.get_string("select_requests","local_myteam")}).done((function(modal){modal.setSaveButtonText(Str.get_string("approve","local_myteam"));var value=Str.get_string("reject","local_myteam"),button=modal.getFooter().find('[data-action="cancel"]');modal.asyncSet(value,button.text.bind(button)),modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))})),!1):(ModalFactory.create({title:Str.get_string("warning"),type:ModalFactory.types.DEFAULT,body:Str.get_string("select_learningtype","local_myteam")}).done((function(modal){modal.setSaveButtonText(Str.get_string("approve","local_myteam"));var value=Str.get_string("reject","local_myteam"),button=modal.getFooter().find('[data-action="cancel"]');modal.asyncSet(value,button.text.bind(button)),modal.show(),modal.getRoot().on(ModalEvents.hidden,(function(){modal.destroy()})),modal.getRoot().on(ModalEvents.cancel,(function(){modal.destroy()}))})),!1)}}}));

//# sourceMappingURL=team_approvals.min.js.map