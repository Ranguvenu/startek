/**
 * Add a create new group modal to the page.
 *
 * @module     local_location/location
 * @class      NewInstitute
 * @package    local_location
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_skillrepository/newassignlevel",["local_skillrepository/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui"],(function(dataTable,$,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y){var NewAssignlevel=function(args){this.contextid=args.contextid,this.costcenterid=args.costcenterid,this.competencyid=args.competencyid,this.skillid=args.repositoryid;this.init(args.selector)};NewAssignlevel.prototype.modal=null,NewAssignlevel.prototype.contextid=-1,NewAssignlevel.prototype.init=function(args){var self=this;return Str.get_string("assignlevel","local_skillrepository",self).then(function(title){return ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:self.getBody()})}.bind(self)).then(function(modal){return self.modal=modal,self.modal.setLarge(),this.modal.getRoot().on(ModalEvents.hidden,function(){this.modal.getRoot().animate({right:"-85%"},500),setTimeout((function(){modal.destroy()}),1e3)}.bind(this)),self.modal.getRoot().on(ModalEvents.shown,function(){self.modal.getRoot().append("<style>[data-fieldtype=submit] { display: none ! important; }</style>"),this.modal.getFooter().find('[data-action="cancel"]').on("click",(function(){modal.hide(),setTimeout((function(){modal.destroy()}),1e3)}))}.bind(this)),self.modal.getRoot().on(ModalEvents.save,self.submitForm.bind(self)),self.modal.getRoot().on("submit","form",self.submitFormAjax.bind(self)),self.modal.show(),this.modal.getRoot().animate({right:"0%"},500),this.modal}.bind(this))},NewAssignlevel.prototype.getBody=function(formdata){void 0===formdata&&(formdata={});var params={costcenterid:this.costcenterid,competencyid:this.competencyid,skillid:this.skillid,jsonformdata:JSON.stringify(formdata)};return Fragment.loadFragment("local_skillrepository","new_assignlevel",this.contextid,params)},NewAssignlevel.prototype.handleFormSubmissionResponse=function(){this.modal.hide(),Y.use("moodle-core-formchangechecker",(function(){M.core_formchangechecker.reset_form_dirty_state()})),document.location.reload()},NewAssignlevel.prototype.handleFormSubmissionFailure=function(data){this.modal.setBody(this.getBody(data))},NewAssignlevel.prototype.submitFormAjax=function(e){e.preventDefault();var formData=this.modal.getRoot().find("form").serialize();Ajax.call([{methodname:"local_skillrepository_submit_assignlevel_form",args:{contextid:this.contextid,costcenterid:this.costcenterid,skillid:this.skillid,competencyid:this.competencyid,jsonformdata:JSON.stringify(formData)},done:this.handleFormSubmissionResponse.bind(this,formData),fail:this.handleFormSubmissionFailure.bind(this,formData)}])},NewAssignlevel.prototype.submitForm=function(e){e.preventDefault();this.modal.getRoot().find("form").submit()};var dataTableshow=function(tableid){$(tableid).dataTable({bPaginate:!0,ordering:!1,bFilter:!0,pageLength:5,bLengthChange:!1,language:{emptyTable:"No Records Found",paginate:{previous:"<",next:">"}},bProcessing:!1})};return{init:function(args){return new NewAssignlevel(args)},load:function(){$(document).on("click",".levelnameclass.assignlevel",(function(){var element=$(this);if(element.hasClass("skillassigned"))var existEnabled=!0;else existEnabled=!1;var data=element.data(),contextid=data.contextid,costcenterid=data.costcenterid,competencyid=data.competencyid,skillid=data.skillid,positionid=data.positionid,levelid=data.levelid,skilllevel=data.skilllevel,newclass=data.scheme;Ajax.call([{methodname:"skill_level_confirmation",args:{contextid:contextid,costcenterid:costcenterid,competencyid:competencyid,skillid:skillid,positionid:positionid,levelid:levelid,skilllevel:skilllevel}}])[0].done((function(resp){existEnabled?(element.removeClass("skillassigned"),element.parent().removeClass(newclass).addClass("nolevel")):(element.addClass("skillassigned"),element.parent().removeClass("nolevel").addClass(newclass))})).fail((function(){alert("Error occured while processing request")}))})),$(document).on("click",".removelevelSkill",(function(){var data=$(this).data(),costcenterid=data.costcenterid,skillid=data.skillid,levelid=data.levelid,competencyid=data.competencyid;return Str.get_strings([{key:"confirm"},{key:"purgeLevelConfirm",component:"local_skillrepository",param:data}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(Str.get_string("yes_delete","local_skillrepository"));var value=Str.get_string("cancel","local_skillrepository"),button=this.modal.getFooter().find('[data-action="cancel"]');this.modal.asyncSet(value,button.text.bind(button)),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),Ajax.call([{methodname:"local_skillrepository_purge_skill_level",args:{costcenterid:costcenterid,skillid:skillid,levelid:levelid,competencyid:competencyid}}])[0].done((function(resp){window.location.reload()}))}.bind(this)),modal.show()}.bind(this))}.bind(this))})),$(document).on("click",".removeCompetencyLevel",(function(){var data=$(this).data(),costcenterid=data.costcenterid,competencyid=data.competencyid,levelid=data.levelid;return Str.get_strings([{key:"confirm"},{key:"purgeCompetencyLevelConfirm",component:"local_skillrepository",param:data}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[0]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),Ajax.call([{methodname:"local_skillrepository_purge_competency_level",args:{costcenterid:costcenterid,competencyid:competencyid,levelid:levelid}}])[0].done((function(resp){window.location.reload()}))}.bind(this)),modal.show()}.bind(this))}.bind(this))})),$(document).on("click",".removeLevelSkill",(function(){var data=$(this).data(),costcenterid=parseInt(data.costcenterid),competencyid=parseInt(data.competencyid),levelid=parseInt(data.levelid),skillid=parseInt(data.skillid);return Str.get_strings([{key:"confirm"},{key:"purgeLevelSkillConfirm",component:"local_skillrepository",param:data}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(Str.get_string("yes_delete","local_skillrepository"));var value=Str.get_string("cancel","local_skillrepository"),button=this.modal.getFooter().find('[data-action="cancel"]');this.modal.asyncSet(value,button.text.bind(button)),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),Ajax.call([{methodname:"local_skillrepository_purge_level_skill",args:{costcenterid:costcenterid,competencyid:competencyid,levelid:levelid,skillid:skillid}}])[0].done((function(resp){window.location.reload()}))}.bind(this)),modal.show()}.bind(this))}.bind(this))})),$(document).on("click",".removeSkillCourse",(function(){var element=$(this);data=element.data();var courseid=data.courseid,skillid=data.skillid;return Str.get_strings([{key:"confirm"},{key:"purgeSkillCourseConfirm",component:"local_skillrepository",param:data}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[0]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),Ajax.call([{methodname:"local_skillrepository_purge_skill_course",args:{courseid:courseid,skillid:skillid}}])[0].done((function(resp){window.location.reload()}))}.bind(this)),modal.show()}.bind(this))}.bind(this))}))},getDomains:function(){$(document).on("change","#id_costcenterid",(function(){return customstrings=Str.get_strings([{key:"selectdomain",component:"local_skillrepository"}]),customstrings.then(function(strings){var orgID=$(this).val();if(orgID){Ajax.call([{methodname:"local_org_domains",args:{orgid:orgID}}])[0].done((function(resp){var template="<option value=null>"+strings[0]+"</option>";$.each(JSON.parse(resp),(function(index,value){template+="<option value = "+index+" >"+value+"</option>"})),$("#id_domain").html(template)})).fail((function(){alert("Error occured while processing request"),window.location.reload()}))}else{var template="<option value=''>"+strings[0]+"</option>";$("#id_domain").html(template)}}.bind(this))}))},getLevels:function(args){$(document).on("change","#id_leveltype",(function(){return customstrings=Str.get_strings([{key:"selectlevel",component:"local_skillrepository"}]),customstrings.then(function(strings){var costcenterid=$("#id_costcenterid").val();costcenterid=costcenterid>0?costcenterid:$("input[name=costcenterid]").val();var leveltype=$(this).val();if(0!=costcenterid&&0!=leveltype){Ajax.call([{methodname:"get_levels",args:{costcenterid:costcenterid,leveltype:leveltype}}])[0].done((function(resp){var template="<option value=null>"+strings[0]+"</option>";$.each(JSON.parse(resp),(function(index,value){template+="<option value = "+index+" >"+value+"</option>"})),$("#id_levelid").html(template)})).fail((function(){alert("Error occured while processing request"),window.location.reload()}))}else{var template="<option value=''>"+strings[0]+"</option>";$("#id_levelid").html(template)}}.bind(this))}))},displaySkillLevels:function(args){var params={skillid:args.skillid,costcenterid:args.costcenterid},returndata=Fragment.loadFragment("local_skillrepository","skill_level_display",1,params);ModalFactory.create({title:Str.get_string("skilllevelsinfo","local_skillrepository",args.skillname),body:returndata}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.bodyRendered,function(){dataTableshow("#skilllevel_info")}.bind(this)),modal.setLarge(),modal.getRoot().on(ModalEvents.hidden,function(){modal.setBody("")}.bind(this)),modal.getRoot().find('[data-action="hide"]').on("click",(function(){modal.hide(),setTimeout((function(){modal.destroy()}),500)}))}))},displaySkillCourses:function(args){var params={skillid:args.skillid,costcenterid:args.costcenterid},returndata=Fragment.loadFragment("local_skillrepository","skill_courses_display",1,params);ModalFactory.create({title:Str.get_string("skillcoursesinfo","local_skillrepository",args.skillname),body:returndata}).done((function(modal){modal.show(),modal.getRoot().on(ModalEvents.bodyRendered,function(){dataTableshow("#skillcourse_info")}.bind(this)),modal.setLarge(),modal.getRoot().on(ModalEvents.hidden,function(){modal.setBody("")}.bind(this)),modal.getRoot().find('[data-action="hide"]').on("click",(function(){modal.hide(),setTimeout((function(){modal.destroy()}),500)}))}))},getSkillLevels:function(args,event){console.log(event);var costcenterid=args.costcenterid,competencyid=args.competencyid,skillid=args.skillid,positionid=args.positionid,levelid=args.levelid,skilllevel=args.skilllevel;if(0!=costcenterid&&0!=competencyid&&0!=skillid&&0!=positionid&&0!=levelid&&0!=skilllevel){Ajax.call([{methodname:"skill_level_confirmation",args:{contextid:1,costcenterid:costcenterid,competencyid:competencyid,skillid:skillid,positionid:positionid,levelid:levelid,skilllevel:skilllevel}}])[0].done((function(resp){})).fail((function(){alert("Error occured while processing request"),window.location.reload()}))}else{$("#id_levelid").html("<option value=''>--Select Level--</option>")}}}}));

//# sourceMappingURL=newassignlevel.min.js.map