{"version":3,"file":"form-repository-selector.min.js","sources":["../src/form-repository-selector.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * course selector module.\n *\n * @module     tool_lp/form-course-selector\n * @class      form-repository-selector\n * @copyright  2015 Frédéric Massart - FMCorz.net\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates'], function($, Ajax, Templates) {\n\n    return /** @alias module:tool_lp/form-course-selector */ {\n\n        processResults: function(selector, results) {\n            var repos = [];\n            $.each(results, function(index, repository) {\n                repos.push({\n                    value: repository.id,\n                    label: repository._label\n                });\n            });\n            return repos;\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n            var contextid;\n            var organisation;\n            contextid = parseInt($(selector).data('contextid'), 10);\n            organisation = parseInt($('#id_open_costcenterid_select').val());\n            if(isNaN(organisation)){\n                organisation = 0;\n            }\n            promise = Ajax.call([{\n                methodname: 'local_skillrepository_form_repository_selector',\n                args: {\n                    query: query,\n                    context: {contextid: contextid},\n                    organisation: organisation\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                var promises = [],\n                i = 0;\n                // Render the label.\n                $.each(results.repos, function(index, repository) {\n                    promises.push(Templates.render('local_skillrepository/form-repository-selector-suggestion', repository));\n                });\n                // Apply the label to the results.\n                return $.when.apply($.when, promises).then(function() {\n                    var args = arguments;\n                    $.each(results.repos, function(index, repository) {\n                        repository._label = args[i];\n                        i++;\n                    });\n                    success(results.repos);\n                    return;\n                });\n\n            }).catch(failure);\n        }\n    };\n});\n"],"names":["define","$","Ajax","Templates","processResults","selector","results","repos","each","index","repository","push","value","id","label","_label","transport","query","success","failure","contextid","organisation","parseInt","data","val","isNaN","call","methodname","args","context","then","promises","i","render","when","apply","arguments","catch"],"mappings":";;;;;;;;AAwBAA,wDAAO,CAAC,SAAU,YAAa,mBAAmB,SAASC,EAAGC,KAAMC,iBAEP,CAErDC,eAAgB,SAASC,SAAUC,aAC3BC,MAAQ,UACZN,EAAEO,KAAKF,SAAS,SAASG,MAAOC,YAC5BH,MAAMI,KAAK,CACPC,MAAOF,WAAWG,GAClBC,MAAOJ,WAAWK,YAGnBR,OAGXS,UAAW,SAASX,SAAUY,MAAOC,QAASC,aAEtCC,UACAC,aACJD,UAAYE,SAASrB,EAAEI,UAAUkB,KAAK,aAAc,IACpDF,aAAeC,SAASrB,EAAE,gCAAgCuB,OACvDC,MAAMJ,gBACLA,aAAe,GAETnB,KAAKwB,KAAK,CAAC,CACjBC,WAAY,iDACZC,KAAM,CACFX,MAAOA,MACPY,QAAS,CAACT,UAAWA,WACrBC,aAAcA,iBAId,GAAGS,MAAK,SAASxB,aACjByB,SAAW,GACfC,EAAI,SAEJ/B,EAAEO,KAAKF,QAAQC,OAAO,SAASE,MAAOC,YAClCqB,SAASpB,KAAKR,UAAU8B,OAAO,4DAA6DvB,gBAGzFT,EAAEiC,KAAKC,MAAMlC,EAAEiC,KAAMH,UAAUD,MAAK,eACnCF,KAAOQ,UACXnC,EAAEO,KAAKF,QAAQC,OAAO,SAASE,MAAOC,YAClCA,WAAWK,OAASa,KAAKI,GACzBA,OAEJd,QAAQZ,QAAQC,aAIrB8B,MAAMlB"}