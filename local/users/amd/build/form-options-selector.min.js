define("local_users/form-options-selector",["jquery","core/ajax","core/templates","core/str"],(function($,Ajax,Templates,Str){return{processResults:function(selector,results){var options=[];return $.isArray(results)?($.each(results,(function(index,option){options.push({value:option.id,label:option._label})})),options):results},transport:function(selector,query,success,failure){if(contextid=parseInt($(selector).data("contextid"),10),action=$(selector).data("action"),formoptions=$(selector).data("options"),"userprofile_element_selector"===action){$(document).on("change",'[data-action="userprofile_element_selector"]',(function(){var depth=$(this).data("depth");$.each($('[data-action="userprofile_element_selector"]'),(function(index,value){$(value).data("depth")>depth&&($(value).html(""),$(value).parent().find(".form-autocomplete-selection").html($(value).data("selectstring")))}))}));var parentid=$('[data-class="'+$(selector).data("parentclass")+'"]').val();null==parentid&&formoptions.parentid>0||(formoptions.parentid=parentid)}"eval_group_selector"===action&&($(document).on("change",'[data-action="eval_group_selector"]',(function(){var depth=$(this).data("depth");$.each($('[data-action="eval_group_selector"]'),(function(index,value){$(value).data("depth")>depth&&($(value).html(""),$(value).parent().find(".form-autocomplete-selection").html($(value).data("selectstring")))})),organizationclass=formoptions.organizationselect,formoptions.parentid=$("[data-class='"+organizationclass+"']").val()})),formoptions=JSON.stringify(formoptions),Ajax.call([{methodname:"local_users_form_option_selector",args:{query:query,context:{contextid:contextid},action:action,options:formoptions,searchanywhere:!0,page:0,perpage:101}}])[0].then((function(results){results=$.parseJSON(results);var promises=[],i=0;return results.length<=100?($.each(results,(function(index,option){var ctx=option;ctx.hasidentity=!0,ctx.identity=[].join(", "),promises.push(Templates.render("local_users/form-option-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,option){option._label=args[i],i++})),success(results)}))):Str.get_string("toomanyoptionstoshow","local_users",">100").then((function(toomanyoptionstoshow){success(toomanyoptionstoshow)}))})).fail(failure))}}}));

//# sourceMappingURL=form-options-selector.min.js.map