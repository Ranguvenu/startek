{"version":3,"file":"form-options-selector.min.js","sources":["../src/form-options-selector.js"],"sourcesContent":["/*\n* This file is a part of e abyas Info Solutions.\n*\n* Copyright e abyas Info Solutions Pvt Ltd, India.\n*\n* This program is free software; you can redistribute it and/or modify\n* it under the terms of the GNU General Public License as published by\n* the Free Software Foundation; either version 3 of the License, or\n* (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU General Public License for more details.\n*\n* You should have received a copy of the GNU General Public License\n* along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*\n* @author e abyas  <info@eabyas.com>\n*/\n/**\n * Defines form autocomplete (types of form element)\n *\n * @package    local_users\n * @copyright  e abyas  <info@eabyas.com>\n */\n\n define(['jquery', 'core/ajax', 'core/templates', 'core/str'], function($, Ajax, Templates, Str) {\n\n    /** @var {Number} Maximum number of options to show. */\n    var MAXOPTIONS = 100;\n\n    return /** @alias module:enrol_manual/form-potential-option-selector */ {\n\n        processResults: function(selector, results) {\n            var options = [];\n            if ($.isArray(results)) {\n                $.each(results, function(index, option) {\n                    options.push({\n                        value: option.id,\n                        label: option._label\n                    });\n                });\n                return options;\n\n            } else {\n                return results;\n            }\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n            contextid = parseInt($(selector).data('contextid'), 10);\n            action = $(selector).data('action');\n            formoptions = $(selector).data('options');\n\n            if(action === 'userprofile_element_selector'){\n\n                $(document).on('change', '[data-action=\"userprofile_element_selector\"]', function(){\n                        var depth = $(this).data('depth');\n\n                        $.each($('[data-action=\"userprofile_element_selector\"]'), function(index, value){\n\n                            if($(value).data('depth') > depth){\n\n                                $(value).html('');\n                                $(value).parent().find('.form-autocomplete-selection').html($(value).data('selectstring'));\n                            }\n\n                        });\n                });\n\n                var parentid = $('[data-class=\"' + $(selector).data('parentclass') + '\"]').val();\n                if(!(parentid == undefined && formoptions.parentid > 0)){\n                    formoptions.parentid = parentid;\n                }\n\n\n            }\n            if(action === 'eval_group_selector'){\n\n                $(document).on('change', '[data-action=\"eval_group_selector\"]', function(){\n                        var depth = $(this).data('depth');\n\n                        $.each($('[data-action=\"eval_group_selector\"]'), function(index, value){\n\n                            if($(value).data('depth') > depth){\n\n                                $(value).html('');\n                                $(value).parent().find('.form-autocomplete-selection').html($(value).data('selectstring'));\n                            }\n\n                        });\n                        organizationclass = formoptions.organizationselect;\n                        formoptions.parentid = $(\"[data-class='\" + organizationclass + \"']\").val();\n                });\n            formoptions = JSON.stringify(formoptions);\n\n            promise = Ajax.call([{\n                methodname: 'local_users_form_option_selector',\n                args: {\n                    query: query,\n                    context: {contextid: contextid},\n                    action: action,\n                    options: formoptions,\n                    searchanywhere: true,\n                    page: 0,\n                    perpage: MAXOPTIONS + 1\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                results = $.parseJSON(results);\n                var promises = [],\n                    i = 0;\n                var contexttemplate = 'local_users/form-option-selector-suggestion';\n\n                if (results.length <= MAXOPTIONS) {\n                    // Render the label.\n                    $.each(results, function(index, option) {\n                        var ctx = option,\n                            identity = [];\n                            ctx.hasidentity = true;\n                        ctx.identity = identity.join(', ');\n                        promises.push(Templates.render(contexttemplate, ctx));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, option) {\n                            option._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                        return;\n                    });\n\n                } else {\n                    return Str.get_string('toomanyoptionstoshow', 'local_users', '>' + MAXOPTIONS).then(function(toomanyoptionstoshow) {\n                        success(toomanyoptionstoshow);\n                        return;\n                    });\n                }\n\n            }).fail(failure);\n        }\n    }\n}\n});\n"],"names":["define","$","Ajax","Templates","Str","processResults","selector","results","options","isArray","each","index","option","push","value","id","label","_label","transport","query","success","failure","contextid","parseInt","data","action","formoptions","document","on","depth","this","html","parent","find","parentid","val","undefined","organizationclass","organizationselect","JSON","stringify","call","methodname","args","context","searchanywhere","page","perpage","MAXOPTIONS","then","parseJSON","promises","i","length","ctx","hasidentity","identity","join","render","when","apply","arguments","get_string","toomanyoptionstoshow","fail"],"mappings":"AA2BCA,2CAAO,CAAC,SAAU,YAAa,iBAAkB,aAAa,SAASC,EAAGC,KAAMC,UAAWC,WAKhB,CAEpEC,eAAgB,SAASC,SAAUC,aAC3BC,QAAU,UACVP,EAAEQ,QAAQF,UACVN,EAAES,KAAKH,SAAS,SAASI,MAAOC,QAC5BJ,QAAQK,KAAK,CACTC,MAAOF,OAAOG,GACdC,MAAOJ,OAAOK,YAGfT,SAGAD,SAIfW,UAAW,SAASZ,SAAUa,MAAOC,QAASC,YAE1CC,UAAYC,SAAStB,EAAEK,UAAUkB,KAAK,aAAc,IACpDC,OAASxB,EAAEK,UAAUkB,KAAK,UAC1BE,YAAczB,EAAEK,UAAUkB,KAAK,WAEjB,iCAAXC,OAA0C,CAEzCxB,EAAE0B,UAAUC,GAAG,SAAU,gDAAgD,eAC7DC,MAAQ5B,EAAE6B,MAAMN,KAAK,SAEzBvB,EAAES,KAAKT,EAAE,iDAAiD,SAASU,MAAOG,OAEnEb,EAAEa,OAAOU,KAAK,SAAWK,QAExB5B,EAAEa,OAAOiB,KAAK,IACd9B,EAAEa,OAAOkB,SAASC,KAAK,gCAAgCF,KAAK9B,EAAEa,OAAOU,KAAK,4BAMtFU,SAAWjC,EAAE,gBAAkBA,EAAEK,UAAUkB,KAAK,eAAiB,MAAMW,MAC1DC,MAAZF,UAAyBR,YAAYQ,SAAW,IACjDR,YAAYQ,SAAWA,UAKjB,wBAAXT,SAECxB,EAAE0B,UAAUC,GAAG,SAAU,uCAAuC,eACpDC,MAAQ5B,EAAE6B,MAAMN,KAAK,SAEzBvB,EAAES,KAAKT,EAAE,wCAAwC,SAASU,MAAOG,OAE1Db,EAAEa,OAAOU,KAAK,SAAWK,QAExB5B,EAAEa,OAAOiB,KAAK,IACd9B,EAAEa,OAAOkB,SAASC,KAAK,gCAAgCF,KAAK9B,EAAEa,OAAOU,KAAK,qBAIlFa,kBAAoBX,YAAYY,mBAChCZ,YAAYQ,SAAWjC,EAAE,gBAAkBoC,kBAAoB,MAAMF,SAEjFT,YAAca,KAAKC,UAAUd,aAEnBxB,KAAKuC,KAAK,CAAC,CACjBC,WAAY,mCACZC,KAAM,CACFxB,MAAOA,MACPyB,QAAS,CAACtB,UAAWA,WACrBG,OAAQA,OACRjB,QAASkB,YACTmB,gBAAgB,EAChBC,KAAM,EACNC,QAASC,QAIT,GAAGC,MAAK,SAAS1C,SACrBA,QAAUN,EAAEiD,UAAU3C,aAClB4C,SAAW,GACXC,EAAI,SAGJ7C,QAAQ8C,QAvFP,KAyFDpD,EAAES,KAAKH,SAAS,SAASI,MAAOC,YACxB0C,IAAM1C,OAEN0C,IAAIC,aAAc,EACtBD,IAAIE,SAFW,GAESC,KAAK,MAC7BN,SAAStC,KAAKV,UAAUuD,OATV,8CASkCJ,SAI7CrD,EAAE0D,KAAKC,MAAM3D,EAAE0D,KAAMR,UAAUF,MAAK,eACnCN,KAAOkB,UACX5D,EAAES,KAAKH,SAAS,SAASI,MAAOC,QAC5BA,OAAOK,OAAS0B,KAAKS,GACrBA,OAEJhC,QAAQb,aAKLH,IAAI0D,WAAW,uBAAwB,cAAe,QAAkBb,MAAK,SAASc,sBACzF3C,QAAQ2C,4BAKjBC,KAAK3C"}