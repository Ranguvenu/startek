{"version":3,"file":"ratings.min.js","sources":["../src/ratings.js"],"sourcesContent":["/**\n * Add a create new group modal to the page.\n *\n * @module     local_ratings/ratings\n * @class      Ratings\n * @package    local_ratings\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/ajax', 'core/str','core/templates', 'jquery', 'jqueryui'],\n        function(Ajax, Str, templates, $) {\n    var ratePicker = function (target, options){\n        var self = this;\n        if (typeof options === 'undefined'){\n            options = {};\n        }\n        options.max = typeof options.max === 'undefined' ? 5 : options.max;\n        options.rgbOn = typeof options.rgbOn === 'undefined' ? \"#f1c40f\" : options.rgbOn;\n        options.spaceWidth = typeof options.spaceWidth === 'undefined' ? '1px' : options.spaceWidth;\n        options.fontsize = typeof options.fontsize === 'undefined' ? '25px' : options.fontsize;\n        options.rgbOff = typeof options.rgbOff === 'undefined' ? \"#ecf0f1\" : options.rgbOff;\n        options.rgbSelection = typeof options.rgbSelection === 'undefined' ? \"#ffcf10\" : options.rgbSelection;\n        options.cursor = typeof options.cursor === 'undefined' ? \"pointer\" : options.cursor;\n        options.indicator = typeof options.indicator === 'undefined' ? \"fa fa-star\" : \"fa \"+options.indicator;\n        var stars = typeof $(target).data('stars') == 'undefined' ? 0 : $(target).data('stars');\n\n        $(target).css('cursor', options.cursor);\n        $(target).append($(\"<input>\", {type : \"hidden\", name : target.replace(\"#\", \"\"), value : stars}));\n\n        $(target).append($(\"<i>\", {class : options.indicator, style : \"display:none; font-size: \"+options.fontsize+\"; color: transparent;\"}));\n        for (var i = 1; i <= options.max; i++){\n            var icon = $(\"<i>\", {class : options.indicator, style : \"font-size: \"+options.fontsize+\"; margin-left: \"+options.spaceWidth+\"; color:\" + (i <= stars ? options.rgbOn : options.rgbOff)});\n            $(target).append(icon);\n\n        }\n        self.set_target_width(target, options);\n        $(target).append($(\"<i>\", {class : options.indicator, style : \"display:none; font-size: \"+options.fontsize+\"; color: transparent;\"}));\n        $.each($(target + \" > i\"), function (index, item){\n            $(item).click(function (){\n                $(\"[name=\" + target.replace(\"#\", \"\") + \"]\").val(index);\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \"> i\")[i]).css(\"color\", i <= index ? options.rgbOn : options.rgbOff);\n                }\n                if (!(options.rate === 'undefined')){\n                    // options.rate(index > options.max ? options.max :     index);\n                    stars = index;\n                    self.set_user_ratings(target, index);\n                }\n            });\n            $(item).mouseover(function (){\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \" > i\")[i]).css(\"color\", i <= index ? options.rgbSelection : options.rgbOff);\n                }\n            });\n            $(item).mouseleave(function(){\n                $(\"[name=\" + target.replace(\"#\", \"\") + \"]\").val(index);\n                for (var i = 1; i <= options.max; i++){\n                    $($(target + \"> i\")[i]).css(\"color\", i <= stars ? options.rgbOn : options.rgbOff);\n                }\n            });\n        });\n    };\n    ratePicker.prototype.set_target_width = function(target, options){\n        var indicator = options.indicator.replace(/\\ /g, '.');\n        var spaceWidth = options.spaceWidth;\n        var item_width = $('.'+indicator).width();\n        $(target).width(((item_width+spaceWidth) * (options.max+1))+'px');\n    };\n    ratePicker.prototype.set_user_ratings = function(target, stars){\n        var data = $(target).data();\n        $.ajax({\n            url: M.cfg.wwwroot+\"/local/ratings/update.php\",\n            method: \"POST\",\n            data: { itemid : data.itemid, ratearea : data.ratearea, rating : stars },\n            success: function(result){\n                $(\".overall_ratings_\"+data.itemid).html(' '+result+' ');\n                $('.rating_tooltip').html('');\n\n            }\n        });\n        // var promise = Ajax.call([{\n        //     methodname: 'local_ratings_set_module_rating',\n        //     args: params\n        // }]);\n        // promise[0].done(function(resp) {\n        //     self.html(resp);\n        // });\n    }\n    return {\n        init : function(target, options){\n            options = JSON.parse(options);\n            return new ratePicker(target, options);\n        },\n        updatevalues: function (args){\n            var action = args.action;\n            $.ajax({url:M.cfg.wwwroot+\"/local/ratings/index.php?likearea=\"+args.likearea+\"&item=\"+args.itemid+\"&action=\"+args.action,\n                beforeSend: function() {\n                    $(\"#loading_image\").show();\n                },\n                success:function(data){\n                    if (action) {\n                        $(\".fa-thumbs-down\").css('color','#0769ad');\n                        $(\".fa-thumbs-up\").css('color','#6d6f71');\n                    }else{\n                        $(\".fa-thumbs-up\").css('color','#0769ad');\n                        $(\".fa-thumbs-down\").css('color','#6d6f71');\n                    }\n                    $(\".count_unlikearea_\"+args.itemid).html(data.dislike);\n                    $(\".count_likearea_\"+args.itemid).html(data.like);\n                    $(\"#loading_image\").hide();\n                }\n            });\n        },\n    \ttrigger: function(){\n            $(document).ready(function(){\n                var content = $('#ratingList').html();\n    \t\t\tif(content == ''){\n    \t\t\t\t$('#ratingList').html(' ');\n    \t\t\t\tvar self = $('#ratingList');\n\t    \t\t\tvar data = $('#ratingList').data();\n\t    \t\t\tvar params = {};\n\t    \t\t\tparams.itemid = data.itemid;\n\t    \t\t\tparams.ratearea = data.ratearea;\n\t    \t\t\tparams.contextid = 1;\n\n\t    \t\t\tvar promise = Ajax.call([{\n\t                    methodname: 'local_ratings_get_ratings_info',\n\t                    args: params\n\t                }]);\n\t                promise[0].done(function(resp) {\n                        templates.render('local_ratings/detailed_info_loaded', resp).then(function(html,js) {\n\t                        self.html(html);\n                        });\n\t                });\n\t            }\n    \t\t});\n            // $(document).on('mouseover', '.overall_users.mt-10', function(){\n            $('.overall_users.mt-10').hover(function(){\n                var content = $(this).find('.rating_tooltip').html();\n                if(content == ''){\n                    $(this).find('.rating_tooltip').html(' ');\n                    var self = $(this).find('.rating_tooltip');\n                    var data = $(this).find('.rating_tooltip').data();\n                    var params = {};\n                    params.itemid = data.itemid;\n                    params.ratearea = data.ratearea;\n                    params.contextid = 1;\n\n                    var promise = Ajax.call([{\n                        methodname: 'local_ratings_get_ratings_info',\n                        args: params\n                    }]);\n                    promise[0].done(function(resp) {\n                        templates.render('local_ratings/detailed_info', resp).then(function(html,js) {\n                            // console.log(html);\n                            self.html(html);\n                        });\n                        // self.html(resp);\n                    });\n                }\n            });\n    \t},\n    \tcomment_item: function(args) {\n                Str.get_strings([{\n                    key: 'postcomment',\n                    component: 'local_ratings'\n                }]).then(function(s) {\n                var userid = args.userid;\n                var itemid = args.itemid;\n                var commentarea = args.commentarea;\n                var comment = $(\"#post_comment_\" + commentarea + '_' + itemid).data('comment');\n                var formid = \"form_comment_item\" + userid + '_' + itemid + commentarea;\n                var container = $(\"#post_comment_\" + commentarea + '_' + itemid).parents('div');\n                if ($('#ratings_comment_' + commentarea + '_' + itemid).length < 1 ) {\n                    $(\"#post_comment_\" + commentarea + '_' + itemid).append('<div id=\"ratings_comment_' + commentarea + '_' + itemid + '\" class=\"postcomment\"><div class=\"commentloading\"></div><form id=\"' + formid + '\" ><textarea id=\"text_' + formid + '\" type=\"text\" name=\"comment\">' + comment + '</textarea><input type=\"submit\" value=\"Submit\"></form></div>');\n                }\n                var dlg = $('#ratings_comment_' + commentarea + '_' + itemid).dialog({\n                    resizable: true,\n                    autoOpen: false,\n                    width: \"20%\",\n                    title: s[0],\n                    modal: false,\n                    dialogClass: 'commentdialog',\n                    show: {\n                        effect: \"slide\",\n                        duration: 1000\n                    },\n                    position: {\n                        my: \"left\",\n                        at: \"right\",\n                        of: \"#post_comment_\" + commentarea + '_' + itemid,\n                        within: container\n                    },\n                    open: function(event, ui) {\n                        $(this).closest(\".ui-dialog\")\n                            .find(\".ui-dialog-titlebar-close\")\n                            .removeClass(\"ui-dialog-titlebar-close\")\n                            .html(\"<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>\");\n                            var Closebutton = $('.ui-icon-closethick').parent();\n                            $(Closebutton).attr({\n                                \"title\" : \"Close\"\n                            });\n                        $(\".sendmessage\").not(this).each(function() {\n                            $(this).remove();\n                        });\n                    },\n                    close: function(event, ui) {\n                        $(this).dialog('destroy').remove();\n                    }\n                });\n                dlg.dialog(\"open\");\n                $(\"#\" + formid).submit(function(e) {\n                    e.preventDefault();\n                    var newcomment = document.getElementById(\"text_\" + formid).value;\n                    if (!newcomment) {\n                         return Str.get_strings([{\n                                key: 'commentsupplyvalue',\n                                component: 'local_ratings'\n                            }\n                            ]).then(function(s) {\n                                $('.commentloading').html(s[0]);\n                            }.bind(this));\n                    } else {\n                        url = require('core/url');\n                        return Str.get_strings([{\n                                key: 'commentsavings',\n                                component: 'local_ratings'\n                            }\n                            ]).then(function(s) {\n                                $('.commentloading').html('<center><img src=\"' + url.imageUrl(\"loader\", \"local_ratings\") + '\" alt=\"'+s[0]+'\" title=\"'+s[0]+'\"/></center>');\n                            }.bind(this));\n                        $(\"#\" + formid).hide();\n                        // console.log();\n                        // console.log($(\"#\" + formid).serializeObject());\n                        var promise = Ajax.call([{\n                            methodname: 'local_ratings_save_comment',\n                            args: {\n                                userid : userid,\n                                itemid : itemid,\n                                commentarea : commentarea,\n                                comment : newcomment\n                            }\n                        }]);\n                        promise[0].done(function(response) {\n                        \tdlg.dialog(\"close\");\n                        \t$(\"#post_comment_\" + commentarea + '_' + itemid).data('comment', newcomment);\n                            content = newcomment.slice(0,50);\n                            $(\"#comment_value_\" + commentarea + '_' + itemid).html(content);\n                            $(\"#comment_value_\" + commentarea + '_' + itemid).prop('title', newcomment);\n\t                    }).fail(function(ex) {\n\t                         console.log(ex);\n\t                    });\n                    }\n                    \n                })\n            });\n        },\n        // trigger: function(){\n        //         // alert('hi');\n        //     // $('.rating_enable_wrapper').load(function(){\n        //     //     alert('hi1');\n        //     // });\n        //     // $(document).ready(function(){\n        //     //     $(window).on('load', '.rating_enable_wrapper', function(){\n        //     //     });\n        //     // });\n        // },\n    \tload: function(){\n\n    \t}\n    }\n});"],"names":["define","Ajax","Str","templates","$","ratePicker","target","options","self","this","max","rgbOn","spaceWidth","fontsize","rgbOff","rgbSelection","cursor","indicator","stars","data","css","append","type","name","replace","value","class","style","i","icon","set_target_width","each","index","item","click","val","rate","set_user_ratings","mouseover","mouseleave","prototype","item_width","width","ajax","url","M","cfg","wwwroot","method","itemid","ratearea","rating","success","result","html","init","JSON","parse","updatevalues","args","action","likearea","beforeSend","show","dislike","like","hide","trigger","document","ready","params","contextid","call","methodname","done","resp","render","then","js","hover","find","comment_item","get_strings","key","component","s","userid","commentarea","comment","formid","container","parents","length","dlg","dialog","resizable","autoOpen","title","modal","dialogClass","effect","duration","position","my","at","of","within","open","event","ui","closest","removeClass","Closebutton","parent","attr","not","remove","close","submit","e","preventDefault","newcomment","getElementById","require","imageUrl","bind","load"],"mappings":"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"}