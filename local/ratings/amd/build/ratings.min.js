/**
 * Add a create new group modal to the page.
 *
 * @module     local_ratings/ratings
 * @class      Ratings
 * @package    local_ratings
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_ratings/ratings",["core/ajax","core/str","core/templates","jquery","jqueryui"],(function(Ajax,Str,templates,$){var ratePicker=function(target,options){var self=this;void 0===options&&(options={}),options.max=void 0===options.max?5:options.max,options.rgbOn=void 0===options.rgbOn?"#f1c40f":options.rgbOn,options.spaceWidth=void 0===options.spaceWidth?"1px":options.spaceWidth,options.fontsize=void 0===options.fontsize?"25px":options.fontsize,options.rgbOff=void 0===options.rgbOff?"#ecf0f1":options.rgbOff,options.rgbSelection=void 0===options.rgbSelection?"#ffcf10":options.rgbSelection,options.cursor=void 0===options.cursor?"pointer":options.cursor,options.indicator=void 0===options.indicator?"fa fa-star":"fa "+options.indicator;var stars=void 0===$(target).data("stars")?0:$(target).data("stars");$(target).css("cursor",options.cursor),$(target).append($("<input>",{type:"hidden",name:target.replace("#",""),value:stars})),$(target).append($("<i>",{class:options.indicator,style:"display:none; font-size: "+options.fontsize+"; color: transparent;"}));for(var i=1;i<=options.max;i++){var icon=$("<i>",{class:options.indicator,style:"font-size: "+options.fontsize+"; margin-left: "+options.spaceWidth+"; color:"+(i<=stars?options.rgbOn:options.rgbOff)});$(target).append(icon)}self.set_target_width(target,options),$(target).append($("<i>",{class:options.indicator,style:"display:none; font-size: "+options.fontsize+"; color: transparent;"})),$.each($(target+" > i"),(function(index,item){$(item).click((function(){$("[name="+target.replace("#","")+"]").val(index);for(var i=1;i<=options.max;i++)$($(target+"> i")[i]).css("color",i<=index?options.rgbOn:options.rgbOff);"undefined"!==options.rate&&(stars=index,self.set_user_ratings(target,index))})),$(item).mouseover((function(){for(var i=1;i<=options.max;i++)$($(target+" > i")[i]).css("color",i<=index?options.rgbSelection:options.rgbOff)})),$(item).mouseleave((function(){$("[name="+target.replace("#","")+"]").val(index);for(var i=1;i<=options.max;i++)$($(target+"> i")[i]).css("color",i<=stars?options.rgbOn:options.rgbOff)}))}))};return ratePicker.prototype.set_target_width=function(target,options){var indicator=options.indicator.replace(/\ /g,"."),spaceWidth=options.spaceWidth,item_width=$("."+indicator).width();$(target).width((item_width+spaceWidth)*(options.max+1)+"px")},ratePicker.prototype.set_user_ratings=function(target,stars){var data=$(target).data();$.ajax({url:M.cfg.wwwroot+"/local/ratings/update.php",method:"POST",data:{itemid:data.itemid,ratearea:data.ratearea,rating:stars},success:function(result){$(".overall_ratings_"+data.itemid).html(" "+result+" "),$(".rating_tooltip").html("")}})},{init:function(target,options){return options=JSON.parse(options),new ratePicker(target,options)},updatevalues:function(args){var action=args.action;$.ajax({url:M.cfg.wwwroot+"/local/ratings/index.php?likearea="+args.likearea+"&item="+args.itemid+"&action="+args.action,beforeSend:function(){$("#loading_image").show()},success:function(data){action?($(".fa-thumbs-down").css("color","#0769ad"),$(".fa-thumbs-up").css("color","#6d6f71")):($(".fa-thumbs-up").css("color","#0769ad"),$(".fa-thumbs-down").css("color","#6d6f71")),$(".count_unlikearea_"+args.itemid).html(data.dislike),$(".count_likearea_"+args.itemid).html(data.like),$("#loading_image").hide()}})},trigger:function(){$(document).ready((function(){if(""==$("#ratingList").html()){$("#ratingList").html(" ");var self=$("#ratingList"),data=$("#ratingList").data(),params={};params.itemid=data.itemid,params.ratearea=data.ratearea,params.contextid=1,Ajax.call([{methodname:"local_ratings_get_ratings_info",args:params}])[0].done((function(resp){templates.render("local_ratings/detailed_info_loaded",resp).then((function(html,js){self.html(html)}))}))}})),$(".overall_users.mt-10").hover((function(){if(""==$(this).find(".rating_tooltip").html()){$(this).find(".rating_tooltip").html(" ");var self=$(this).find(".rating_tooltip"),data=$(this).find(".rating_tooltip").data(),params={};params.itemid=data.itemid,params.ratearea=data.ratearea,params.contextid=1,Ajax.call([{methodname:"local_ratings_get_ratings_info",args:params}])[0].done((function(resp){templates.render("local_ratings/detailed_info",resp).then((function(html,js){self.html(html)}))}))}}))},comment_item:function(args){Str.get_strings([{key:"postcomment",component:"local_ratings"}]).then((function(s){var userid=args.userid,itemid=args.itemid,commentarea=args.commentarea,comment=$("#post_comment_"+commentarea+"_"+itemid).data("comment"),formid="form_comment_item"+userid+"_"+itemid+commentarea,container=$("#post_comment_"+commentarea+"_"+itemid).parents("div");$("#ratings_comment_"+commentarea+"_"+itemid).length<1&&$("#post_comment_"+commentarea+"_"+itemid).append('<div id="ratings_comment_'+commentarea+"_"+itemid+'" class="postcomment"><div class="commentloading"></div><form id="'+formid+'" ><textarea id="text_'+formid+'" type="text" name="comment">'+comment+'</textarea><input type="submit" value="Submit"></form></div>');var dlg=$("#ratings_comment_"+commentarea+"_"+itemid).dialog({resizable:!0,autoOpen:!1,width:"20%",title:s[0],modal:!1,dialogClass:"commentdialog",show:{effect:"slide",duration:1e3},position:{my:"left",at:"right",of:"#post_comment_"+commentarea+"_"+itemid,within:container},open:function(event,ui){$(this).closest(".ui-dialog").find(".ui-dialog-titlebar-close").removeClass("ui-dialog-titlebar-close").html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");var Closebutton=$(".ui-icon-closethick").parent();$(Closebutton).attr({title:"Close"}),$(".sendmessage").not(this).each((function(){$(this).remove()}))},close:function(event,ui){$(this).dialog("destroy").remove()}});dlg.dialog("open"),$("#"+formid).submit((function(e){e.preventDefault();var newcomment=document.getElementById("text_"+formid).value;return newcomment?(url=require("core/url"),Str.get_strings([{key:"commentsavings",component:"local_ratings"}]).then(function(s){$(".commentloading").html('<center><img src="'+url.imageUrl("loader","local_ratings")+'" alt="'+s[0]+'" title="'+s[0]+'"/></center>')}.bind(this))):Str.get_strings([{key:"commentsupplyvalue",component:"local_ratings"}]).then(function(s){$(".commentloading").html(s[0])}.bind(this))}))}))},load:function(){}}}));

//# sourceMappingURL=ratings.min.js.map