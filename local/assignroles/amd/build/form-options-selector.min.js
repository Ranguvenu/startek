/**
 * option selector module.
 *
 * @module     tool_lp/form-option-selector
 * @class      form-option-selector
 * @package    tool_lp
 * @copyright  2015 Frédéric Massart - FMCorz.net
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_assignroles/form-options-selector",["jquery","core/ajax","core/templates"],(function($,Ajax,Templates){return{processResults:function(selector,results){var options=[];return $.each(results,(function(index,option){options.push({value:option.id,label:option._label})})),options},transport:function(selector,query,success,failure){action=$(selector).data("action"),formoptions=$(selector).data("options"),$("#id_roleid").on("change",(function(){$("#id_users").empty(),$("#fitem_id_users .form-autocomplete-selection").empty()})),"role_costcenterusers"===action&&(formoptions.roleid=$("#id_roleid").val(),formoptions.formtype=$("#id_formtype").val()),"role_users"===action&&(formoptions.roleid=formoptions.roleid,formoptions.costcenterid?formoptions.organisationid=formoptions.costcenterid:formoptions.organisationid=$("#id_open_costcenterid").val()),formoptions=JSON.stringify(formoptions),Ajax.call([{methodname:"local_assignroles_form_option_selector",args:{query:query,action:action,options:formoptions,searchanywhere:!0,page:0,perpage:25}}])[0].then((function(results){results=$.parseJSON(results);var promises=[],i=0;return"local_assignroles/form-option-selector-suggestion",$.each(results,(function(index,option){var ctx=option;ctx.hasidentity=!0,ctx.identity=[].join(", "),promises.push(Templates.render("local_assignroles/form-option-selector-suggestion",ctx))})),$.when.apply($.when,promises).then((function(){var args=arguments;$.each(results,(function(index,option){option._label=args[i],i++})),success(results)}))})).catch(failure)}}}));

//# sourceMappingURL=form-options-selector.min.js.map