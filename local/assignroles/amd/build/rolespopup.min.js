/**
 * Add a create new group modal to the page.
 *
 * @module     local_courses/newcourse
 * @class      NewCourse
 * @package    local_courses
 * @copyright  2017 Shivani
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_assignroles/rolespopup",["local_assignroles/jquery.dataTables","jquery","core/str","core/modal_factory","core/modal_events","core/fragment","core/ajax","core/yui","jqueryui"],(function(DataTable,$,Str,ModalFactory,ModalEvents,Fragment,Ajax,Y){var NewPopup=function(args){this.contextid=args.contextid;this.init(args.selector)};NewPopup.prototype.modal=null,NewPopup.prototype.contextid=-1,NewPopup.prototype.init=function(selector){var self=this;$(selector).click((function(){self.costcenterid=$(this).data("costcenterid"),self.costcentername=$(this).data("costcentername"),self.hierarchyid=$(this).data("hierarchyid"),Str.get_string("costcenterassignedrole","local_costcenter",self).then((function(title){ModalFactory.create({type:ModalFactory.types.CANCEL,title:title,body:self.getBody()}).done((function(modal){self.modal=modal,self.modal.setLarge(),self.modal.getRoot().on(ModalEvents.hidden,function(){self.modal.hide(),self.modal.destroy()}.bind(this)),self.modal.getRoot().on(ModalEvents.cancel,function(){self.modal.hide(),self.modal.destroy()}.bind(this)),self.modal.show(),self.modal.getRoot().on(ModalEvents.bodyRendered,function(){self.dataTableshow(self.costcenterid)}.bind(this))}))}))}))},NewPopup.prototype.dataTableshow=function(costcenterid){Str.get_strings([{key:"nodata_available",component:"local_assignroles"},{key:"search",component:"local_assignroles"}]).then(function(s){$("#popup_user").DataTable({bPaginate:!0,bFilter:!0,bLengthChange:!0,lengthMenu:[[5,10,25,50,100,-1],[5,10,25,50,100,"All"]],language:{emptyTable:s[0],infoEmpty:s[0],zeroRecords:s[0],paginate:{previous:"<",next:">"}},oLanguage:{sSearch:s[1]},bProcessing:!0})}.bind(this))},NewPopup.prototype.getBody=function(formdata){if(void 0===formdata&&(formdata={}),void 0!==this.costcenterid)var params={costcenterid:this.costcenterid,hierarchyid:this.hierarchyid,jsonformdata:JSON.stringify(formdata)};else params={};return Fragment.loadFragment("local_assignroles","costcenterroleusers_display",this.contextid,params)};return{init:function(args){return this.Datatable(),new NewPopup(args)},Datatable:function(){},unassignConfirm:function(args){return function(args){return Str.get_strings([{key:"confirmation",component:"local_assignroles"},{key:"unassignconfirm",component:"local_assignroles",param:args},{key:"unassign",component:"local_assignroles"}]).then(function(s){ModalFactory.create({title:s[0],type:ModalFactory.types.SAVE_CANCEL,body:s[1]}).done(function(modal){this.modal=modal,modal.setSaveButtonText(s[2]),modal.getRoot().on(ModalEvents.save,function(e){e.preventDefault(),args.confirm=!0,console.log(args);var params={};params.contextid=args.contextid,params.roleid=args.roleid,params.userid=args.userid,Ajax.call([{methodname:"local_assignroles_unassign_role",args:params}])[0].done((function(resp){window.location.href=window.location.href})).fail((function(ex){console.log(ex)}))}.bind(this)),modal.show()}.bind(this))}.bind(this))}(args)}}}));

//# sourceMappingURL=rolespopup.min.js.map