{"version":3,"file":"form-options-selector.min.js","sources":["../src/form-options-selector.js"],"sourcesContent":["/*\n* This file is a part of e abyas Info Solutions.\n*\n* Copyright e abyas Info Solutions Pvt Ltd, India.\n*\n* This program is free software; you can redistribute it and/or modify\n* it under the terms of the GNU General Public License as published by\n* the Free Software Foundation; either version 3 of the License, or\n* (at your option) any later version.\n*\n* This program is distributed in the hope that it will be useful,\n* but WITHOUT ANY WARRANTY; without even the implied warranty of\n* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n* GNU General Public License for more details.\n*\n* You should have received a copy of the GNU General Public License\n* along with this program.  If not, see <http://www.gnu.org/licenses/>.\n*\n* @author e abyas  <info@eabyas.com>\n*/\n/**\n * Defines form autocomplete (types of form element)\n *\n * @package    local_kpichallenge\n * @copyright  e abyas  <info@eabyas.com>\n */\n\n define(['jquery', 'core/ajax', 'core/templates', 'core/str'], function($, Ajax, Templates, Str) {\n\n    /** @var {Number} Maximum number of options to show. */\n    var MAXOPTIONS = 100;\n\n    return /** @alias module:enrol_manual/form-potential-option-selector */ {\n\n        processResults: function(selector, results) {\n            var options = [];\n            if ($.isArray(results)) {\n                $.each(results, function(index, option) {\n                    options.push({\n                        value: option.id,\n                        label: option._label\n                    });\n                });\n                return options;\n\n            } else {\n                return results;\n            }\n        },\n\n        transport: function(selector, query, success, failure) {\n            var promise;\n            contextid = parseInt($(selector).data('contextid'), 10);\n            action = $(selector).data('action');\n            formoptions = $(selector).data('options');\n            var defaultstrings = Str.get_strings([\n                {\n                    key:'selectdept',\n                    component: 'local_courses',\n                },\n                {\n                    key:'selectsubdept',\n                    component: 'local_courses',\n                },\n                {\n                    key:'selectcat',\n                    component: 'local_courses',\n                },\n                {\n                    key:'selectcoursetype',\n                    component: 'local_courses',\n                }\n            ]);\n            defaultstrings.then(function(s){\n                var departmentselect = '<span><span>'+s[0]+'</span></span>';\n                var subdeptartmentselect = '<span><span>'+s[1]+'</span></span>';\n                var categoryselect = '<span><span>'+s[2]+'</span></span>';\n                var course_typeselect = '<span><span>'+s[3]+'</span></span>';\n                if (action === 'costcenter_organisation_selector' || action === 'costcenter_element_selector') {\n                    $(\"#id_open_costcenterid_select\").on('change', function() {\n                        var department = $('#id_open_departmentid').val();\n                        if(parseInt(department) >= 0){\n                            $('#id_open_departmentid').html('');\n                            $('.departmentselect .form-autocomplete-selection').html(departmentselect);\n                        }\n                        var subdept = $('#id_open_subdepartment').val();\n                        if(parseInt(subdept) >= 0){\n                            $('#id_open_subdepartment').html('');\n                            $('.subdepartmentselect .form-autocomplete-selection').html(subdeptartmentselect);\n                        }\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                        var category = $('#id_open_categoryid').val();\n                        if(parseInt(category) > 0){\n                            $('#id_open_categoryid').html('');\n                            $('.idparentselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                        var identifiedas = $('#id_identifiedtype').val();\n                        if(parseInt(identifiedas) > 0){\n                            $('#id_identifiedtype').html('');\n                            $('.identifiedasselect .form-autocomplete-selection').html(course_typeselect);\n                        }\n\n                    });\n                }else if(action === 'costcenter_department_selector' || action === 'costcenter_subdepartment_selector'){\n                    $('#id_open_departmentid').on('change', function(){\n                        var subdept = $('#id_open_subdepartment').val();\n                        if(parseInt(subdept) >= 0){\n                            $('#id_open_subdepartment').html('');\n                            $('.subdepartmentselect .form-autocomplete-selection').html(subdeptartmentselect);\n                        }\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                    });\n                    $('#id_open_subdepartment').on('change', function(){\n                        var category = $('#id_category').val();\n                        if(parseInt(category) > 0){\n                            $('#id_category').html('');\n                            $('.categoryselect .form-autocomplete-selection').html(categoryselect);\n                        }\n                    });\n                }else if(action === 'costecenter_coursetype_selector'){\n                    $('#id_open_identifiedtype').on('change', function(){\n                        var category = $('#id_open_identifiedtype').val();\n                        if(parseInt(category) > 0){\n                            $('#id_open_identifiedtype').html('');\n                            $('.identifiedasselect .form-autocomplete-selection').html(course_typeselect);\n                        }\n                    });\n                }else if(action === 'costcenter_element_selector'){\n                    $(document).on('change', '[data-action=\"costcenter_element_selector\"]', function(){\n                        var elemvalue = $(this).val();\n                        if(parseInt(elemvalue) > 0){\n                            var depth = $(this).data('depth');\n                            $.each($('[data-action=\"costcenter_element_selector\"]'), function(index, value){\n                                if($(value).data('depth') > depth){\n                                    $(value).html('');\n                                    $(value).parent().find('.form-autocomplete-selection').html($(value).data('selectstring'));\n                                }\n                            });\n                            if(depth == 1){\n                                var value = $('[data-class=\"supervisor_select\"]');\n                                value.html('');\n                                value.parent().find('.form-autocomplete-selection').html(value.data('selectstring'));;\n                            }\n                        }\n                    });\n                }\n            });\n            if(action === 'costcenter_department_selector' || action === 'costcenter_subdepartment_selector' || action === 'costecenter_coursetype_selector' || action === 'costcenter_element_selector' || action === 'custom_category_selector' || action === 'user_supervisor_selector' || action === 'user_position_selector' || action === 'user_domain_selector'\n                || action === 'custom_matrix_selector'){\n                var parentid = $('[data-class=\"' + $(selector).data('parentclass') + '\"]').val();\n                if(!(parentid == undefined && formoptions.parentid > 0)){\n                    formoptions.parentid = parentid;\n                }\n                if(action === 'user_position_selector'){\n                    formoptions.domainid = $(\"#id_open_domainid\").val();\n                }\n            }else if(action === 'costcenter_category_selector'){\n                formoptions.organisationid = $(\"#id_open_costcenterid\").val();\n                formoptions.departmentid = $(\"#id_open_departmentid\").val();\n                formoptions.subdepartment = $(\"#id_open_subdepartment\").val();\n                formoptions.name = $(\"#id_open_identifiedtype\").val();\n\n            }else if(action === 'perforance_parameter_selector')\n            {\n                formoptions.typeparent = $('#id_open_performancetype').val();\n            }\n            formoptions = JSON.stringify(formoptions);\n\n            promise = Ajax.call([{\n                methodname: 'local_costcenter_form_option_selector',\n                args: {\n                    query: query,\n                    context: {contextid: contextid},\n                    action: action,\n                    options: formoptions,\n                    searchanywhere: true,\n                    page: 0,\n                    perpage: MAXOPTIONS + 1\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                results = $.parseJSON(results);\n                var promises = [],\n                    i = 0;\n                var contexttemplate;\n                // if (action === 'kpichallenge_kpi_selector') {\n                //     contexttemplate = 'local_kpichallenge/form-option-kpiselector-suggestion';\n                // }else if (action === 'kpichallenge_challengee_selector' || action === 'challenge_challengee_selector' || action === 'challenge_challenger_selector') {\n                    contexttemplate = 'local_costcenter/form-option-selector-suggestion';\n                // } else {\n                //     contexttemplate = 'local_kpichallenge/form-option-selector-suggestion';\n                // }    \n                if (results.length <= MAXOPTIONS) {\n                    // Render the label.\n                    $.each(results, function(index, option) {\n                        var ctx = option,\n                            identity = [];\n                            ctx.hasidentity = true;\n                        ctx.identity = identity.join(', ');\n                        promises.push(Templates.render(contexttemplate, ctx));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        var args = arguments;\n                        $.each(results, function(index, option) {\n                            option._label = args[i];\n                            i++;\n                        });\n                        success(results);\n                        return;\n                    });\n\n                } else {\n                    return Str.get_string('toomanyoptionstoshow', 'local_costcenter', '>' + MAXOPTIONS).then(function(toomanyoptionstoshow) {\n                        success(toomanyoptionstoshow);\n                        return;\n                    });\n                }\n\n            }).fail(failure);\n        }\n    }\n});\n"],"names":["define","$","Ajax","Templates","Str","processResults","selector","results","options","isArray","each","index","option","push","value","id","label","_label","transport","query","success","failure","contextid","parseInt","data","action","formoptions","get_strings","key","component","then","s","departmentselect","subdeptartmentselect","categoryselect","course_typeselect","on","department","val","html","subdept","category","identifiedas","document","elemvalue","this","depth","parent","find","parentid","undefined","domainid","organisationid","departmentid","subdepartment","name","typeparent","JSON","stringify","call","methodname","args","context","searchanywhere","page","perpage","MAXOPTIONS","parseJSON","promises","i","length","ctx","hasidentity","identity","join","render","when","apply","arguments","get_string","toomanyoptionstoshow","fail"],"mappings":"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"}